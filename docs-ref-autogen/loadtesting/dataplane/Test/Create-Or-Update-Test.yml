### YamlMime:RESTOperation
uid: loadtesting.dataplane.test.createorupdatetest
name: Create Or Update Test
service: Azure Load Testing
groupName: Test
apiVersion: 2022-06-01-preview
summary: Create a new test or Update an existing test.
consumes:
- application/merge-patch+json
produces:
- application/json
paths:
- content: PATCH https://{Endpoint}/loadtests/{testId}?api-version=2022-06-01-preview
uriParameters:
- name: Endpoint
  in: path
  isRequired: true
  skipUrlEncoding: true
  description: URL to perform data plane API operations on the resource.
  types:
  - uid: string
  format: uri
- name: testId
  in: path
  isRequired: true
  description: Unique name for load test, must be a valid URL character ^[a-z0-9_-]*$.
  types:
  - uid: string
  pattern: ^[a-z0-9_-]*$
- name: api-version
  in: query
  isRequired: true
  description: API version
  types:
  - uid: string
responses:
- name: 200 OK
  description: The test is updated.
  types:
  - uid: TestModel
- name: 201 Created
  description: The test is created.
  types:
  - uid: TestModel
- name: Other Status Codes
  headers:
  - name: x-ms-error-code
    value: string
  description: Load Testing service error response.
  types:
  - uid: ErrorResponseBody
requestBody:
- name: default
  parameters:
  - name: description
    in: body
    description: The test description.
    types:
    - uid: string
  - name: displayName
    in: body
    description: Display name of a test.
    types:
    - uid: string
  - name: loadTestConfig
    in: body
    description: The load test configuration.
    types:
    - uid: LoadTestConfig
  - name: passFailCriteria
    in: body
    description: Pass fail criteria for a test.
    types:
    - uid: PassFailCriteria
  - name: secrets
    in: body
    description: Secrets can be stored in an Azure Key Vault or any other secret store. If the secret is stored in an Azure Key Vault, the value should be the secret identifier and the type should be AKV_SECRET_URI. If the secret is stored elsewhere, the secret value should be provided directly and the type should be SECRET_VALUE.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: SecretMetadata
  - name: environmentVariables
    in: body
    description: Environment variables which are defined as a set of <name,value> pairs.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
  - name: subnetId
    in: body
    description: Subnet ID on which the load test instances should run.
    types:
    - uid: string
  - name: keyvaultReferenceIdentityType
    in: body
    description: Type of the managed identity referencing the Key vault.
    types:
    - uid: string
  - name: keyvaultReferenceIdentityId
    in: body
    description: Resource Id of the managed identity referencing the Key vault.
    types:
    - uid: string
requestHeader: []
definitions:
- name: LoadTestConfig
  description: The load test configuration.
  kind: object
  properties:
  - name: engineInstances
    description: The number of engine instances to execute load test. Supported values are in range of 1-45. Required for creating a new test.
    types:
    - uid: integer
  - name: splitAllCSVs
    description: Whether all the input CSV files should be split evenly across all engines.
    types:
    - uid: boolean
- name: PassFailCriteria
  description: Pass fail criteria for a test.
  kind: object
  properties:
  - name: passFailMetrics
    description: 'Map of id and pass fail metrics { id  : pass fail metrics }.'
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: PassFailMetric
- name: InputTestArtifacts
  description: The input artifacts for the test.
  kind: object
  properties:
  - name: configUrl
    description: FileUrl Model.
    types:
    - uid: FileUrl
  - name: testScriptUrl
    description: FileUrl Model.
    types:
    - uid: FileUrl
  - name: userPropUrl
    description: FileUrl Model.
    types:
    - uid: FileUrl
  - name: inputArtifactsZipFileurl
    description: FileUrl Model.
    types:
    - uid: FileUrl
  - name: additionalUrls
    isReadyOnly: true
    description: 'The input artifacts file { name : url } map for the test run.'
    types:
    - uid: FileUrl
      isArray: true
- name: SecretMetadata
  kind: object
  properties:
  - name: value
    description: The value of the secret, of type AKV_SECRET_URI or SECRET_VALUE
    types:
    - uid: string
  - name: type
    description: Type of secret. eg. AKV_SECRET_URI/SECRET_VALUE
    types:
    - uid: string
- name: TestModel
  description: Load test model
  kind: object
  properties:
  - name: testId
    isReadyOnly: true
    description: Unique test name as identifier.
    types:
    - uid: string
  - name: description
    description: The test description.
    types:
    - uid: string
  - name: displayName
    description: Display name of a test.
    types:
    - uid: string
  - name: resourceId
    isReadyOnly: true
    description: Fully qualified resource Id e.g /subscriptions/{subId}/resourceGroups/{rg}/providers/Microsoft.LoadTestService/loadtests/{resName}.
    types:
    - uid: string
  - name: loadTestConfig
    description: The load test configuration.
    types:
    - uid: LoadTestConfig
  - name: passFailCriteria
    description: Pass fail criteria for a test.
    types:
    - uid: PassFailCriteria
  - name: createdDateTime
    isReadyOnly: true
    description: The created DateTime(ISO 8601 literal format) of the test model.
    types:
    - uid: string
  - name: createdBy
    isReadyOnly: true
    description: The user that created the test model.
    types:
    - uid: string
  - name: lastModifiedDateTime
    isReadyOnly: true
    description: The last Modified DateTime(ISO 8601 literal format) of the test model.
    types:
    - uid: string
  - name: lastModifiedBy
    isReadyOnly: true
    description: The user that last modified the test model.
    types:
    - uid: string
  - name: inputArtifacts
    isReadyOnly: true
    description: The input artifacts for the test.
    types:
    - uid: InputTestArtifacts
  - name: secrets
    description: Secrets can be stored in an Azure Key Vault or any other secret store. If the secret is stored in an Azure Key Vault, the value should be the secret identifier and the type should be AKV_SECRET_URI. If the secret is stored elsewhere, the secret value should be provided directly and the type should be SECRET_VALUE.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: SecretMetadata
  - name: environmentVariables
    description: Environment variables which are defined as a set of <name,value> pairs.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
  - name: subnetId
    description: Subnet ID on which the load test instances should run.
    types:
    - uid: string
  - name: keyvaultReferenceIdentityType
    description: Type of the managed identity referencing the Key vault.
    types:
    - uid: string
  - name: keyvaultReferenceIdentityId
    description: Resource Id of the managed identity referencing the Key vault.
    types:
    - uid: string
- name: ErrorResponseBody
  description: The definition of an error object.
  kind: object
  properties:
  - name: error
    description: Error from a REST request.
    types:
    - uid: Error
- name: PassFailMetric
  kind: object
  properties:
  - name: clientmetric
    description: The client metric on which the criteria should be applied. Allowed values - ‘response_time_ms’ , ‘latency’, ‘error’, ‘requests’, ‘requests_per_sec’.
    types:
    - uid: string
  - name: aggregate
    description: The aggregation function to be applied on the client metric. Allowed functions - ‘percentage’ - for error metric ,‘avg’, ‘p50’, ‘p90’, ‘p95’, ‘p99’, ‘min’, ‘max’ - for response_time_ms and latency metric, ‘avg’ - for requests_per_sec, ‘count’ - for requests.
    types:
    - uid: string
  - name: condition
    description: 'The comparison operator. Supported types ‘>’ '
    types:
    - uid: string
  - name: requestName
    description: Request name for which the Pass fail criteria has to be applied.
    types:
    - uid: string
  - name: value
    description: 'The value to compare with the client metric. Allowed values - ‘error : [0.0 , 100.0] unit- % ’, response_time_ms and latency : any integer value unit- ms.'
    types:
    - uid: number
  - name: action
    description: Either ‘stop’ or ‘continue’ after the threshold is met. Default is ‘continue’.
    types:
    - uid: string
  - name: actualValue
    isReadyOnly: true
    description: The actual value of the client metric for the test run.
    types:
    - uid: number
  - name: result
    isReadyOnly: true
    description: Outcome of the test run. possible outcome - ‘passed’ , ‘failed’ , ‘undetermined’.
    types:
    - uid: string
- name: FileUrl
  description: FileUrl Model.
  kind: object
  properties:
  - name: url
    description: File URL.
    types:
    - uid: string
  - name: fileId
    description: File unique identifier.
    types:
    - uid: string
  - name: filename
    description: Name of the file.
    types:
    - uid: string
  - name: fileType
    description: Integer representation of the file type (0 = JMX_FILE, 1 = USER_PROPERTIES, 2 = ADDITIONAL_ARTIFACTS)
    types:
    - uid: FileType
  - name: expireTime
    description: Expiry time of the file
    types:
    - uid: string
  - name: validationStatus
    description: Validation status of the file
    types:
    - uid: string
- name: Error
  description: Error from a REST request.
  kind: object
  properties:
  - name: code
    description: The error code.
    types:
    - uid: string
  - name: message
    description: The error message.
    types:
    - uid: string
  - name: target
    description: The error target.
    types:
    - uid: string
  - name: details
    description: Additional details and inner errors.
    types:
    - uid: Error
      isArray: true
- name: FileType
  description: Integer representation of the file type (0 = JMX_FILE, 1 = USER_PROPERTIES, 2 = ADDITIONAL_ARTIFACTS)
  kind: enum
  properties:
  - name: "0"
    types:
    - uid: Integer
  - name: "1"
    types:
    - uid: Integer
  - name: "2"
    types:
    - uid: Integer
examples:
- name: CreateOrUpdateTest
  request:
    uri: PATCH https://{Endpoint}/loadtests/12345678-1234-1234-1234-123456789012?api-version=2022-06-01-preview
    body: >-
      {
        "description": "sample description",
        "displayName": "Performance_LoadTest",
        "loadTestConfig": {
          "engineInstances": 6,
          "splitAllCSVs": true
        },
        "passFailCriteria": {
          "passFailMetrics": {
            "fefd759d-7fe8-4f83-8b6d-aeebe0f491fe": {
              "clientmetric": "response_time_ms",
              "aggregate": "percentage",
              "condition": ">",
              "value": 20,
              "action": "continue"
            }
          }
        },
        "secrets": {
          "secret1": {
            "value": "https://samplevault.vault.azure.net/secrets/samplesecret/f113f91fd4c44a368049849c164db827",
            "type": "AKV_SECRET_URI"
          }
        },
        "environmentVariables": {
          "envvar1": "sampletext"
        },
        "subnetId": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/samplerg/providers/Microsoft.Network/virtualNetworks/samplenetworkresource/subnets/AAAAA0A0A0",
        "keyvaultReferenceIdentityType": "UserAssigned",
        "keyvaultReferenceIdentityId": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/samplerg/providers/sampleprovider/sampleresourcetype/sampleresourcename"
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "testId": "12345678-1234-1234-1234-123456789012",
        "description": "sample description",
        "displayName": "Performance_LoadTest",
        "resourceId": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/samplerg/providers/microsoft.loadtestservice/sampleresourcetype/sampleresourcename",
        "loadTestConfig": {
          "engineInstances": 6,
          "splitAllCSVs": true
        },
        "passFailCriteria": {
          "passFailMetrics": {
            "fefd759d-7fe8-4f83-8b6d-aeebe0f491fe": {
              "clientmetric": "response_time_ms",
              "aggregate": "percentage",
              "condition": ">",
              "value": 20,
              "action": "continue",
              "actualValue": 10,
              "result": "passed"
            }
          }
        },
        "createdDateTime": "2021-12-05T16:43:46.072Z",
        "createdBy": "elon-musk@microsoft.com",
        "lastModifiedDateTime": "2021-12-05T16:43:46.072Z",
        "lastModifiedBy": "elon-musk@microsoft.com",
        "inputArtifacts": {
          "configUrl": {
            "url": "https://dummyurl.com/configresource",
            "fileId": "92345678-1234-1111-1234-123456789012",
            "filename": "config.yaml",
            "fileType": 2,
            "expireTime": "2021-12-05T16:43:46.072Z",
            "validationStatus": ""
          },
          "testScriptUrl": {
            "url": "https://dummyurl.com/testscriptresource",
            "fileId": "92345678-1234-1111-1234-123456789011",
            "filename": "sample.jmx",
            "fileType": 0,
            "expireTime": "2021-12-05T16:43:46.072Z",
            "validationStatus": "VALIDATION_SUCCESS"
          },
          "userPropUrl": {
            "url": "https://dummyurl.com/userpropresource",
            "fileId": "92345678-1234-1111-1234-123456789013",
            "filename": "user.properties",
            "fileType": 1,
            "expireTime": "2021-12-05T16:43:46.072Z",
            "validationStatus": ""
          },
          "inputArtifactsZipFileurl": {
            "url": "https://dummyurl.com/inputartifactzipresource",
            "fileId": "92345678-1234-1111-1234-123456789012",
            "filename": "inputartifacts.zip",
            "fileType": 2,
            "expireTime": "2021-12-05T16:43:46.072Z",
            "validationStatus": ""
          },
          "additionalUrls": []
        },
        "secrets": {
          "secret1": {
            "value": "https://samplevault.vault.azure.net/secrets/samplesecret/f113f91fd4c44a368049849c164db827",
            "type": "AKV_SECRET_URI"
          }
        },
        "environmentVariables": {
          "envvar1": "sampletext"
        },
        "subnetId": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/samplerg/providers/Microsoft.Network/virtualNetworks/samplenetworkresource/subnets/AAAAA0A0A0",
        "keyvaultReferenceIdentityType": "UserAssigned",
        "keyvaultReferenceIdentityId": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/samplerg/providers/Microsoft.ManagedIdentity/userAssignedIdentities/identity1"
      }
  - statusCode: "201"
    body: >-
      {
        "testId": "12345678-1234-1234-1234-123456789012",
        "description": "sample description",
        "displayName": "Performance_LoadTest",
        "resourceId": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/samplerg/providers/microsoft.loadtestservice/sampleresourcetype/sampleresourcename",
        "loadTestConfig": {
          "engineInstances": 6,
          "splitAllCSVs": true
        },
        "passFailCriteria": {
          "passFailMetrics": {
            "fefd759d-7fe8-4f83-8b6d-aeebe0f491fe": {
              "clientmetric": "response_time_ms",
              "aggregate": "percentage",
              "condition": ">",
              "value": 20,
              "action": "continue",
              "actualValue": 10,
              "result": "passed"
            }
          }
        },
        "createdDateTime": "2021-12-05T16:43:46.072Z",
        "createdBy": "elon-musk@microsoft.com",
        "lastModifiedDateTime": "2021-12-05T16:43:46.072Z",
        "lastModifiedBy": "elon-musk@microsoft.com",
        "inputArtifacts": {
          "configUrl": {
            "url": "https://dummyurl.com/configresource",
            "fileId": "92345678-1234-1111-1234-123456789012",
            "filename": "config.yaml",
            "fileType": 2,
            "expireTime": "2021-12-05T16:43:46.072Z",
            "validationStatus": ""
          },
          "testScriptUrl": {
            "url": "https://dummyurl.com/testscriptresource",
            "fileId": "92345678-1234-1111-1234-123456789011",
            "filename": "sample.jmx",
            "fileType": 0,
            "expireTime": "2021-12-05T16:43:46.072Z",
            "validationStatus": "VALIDATION_SUCCESS"
          },
          "userPropUrl": {
            "url": "https://dummyurl.com/userpropresource",
            "fileId": "92345678-1234-1111-1234-123456789013",
            "filename": "user.properties",
            "fileType": 1,
            "expireTime": "2021-12-05T16:43:46.072Z",
            "validationStatus": ""
          },
          "inputArtifactsZipFileurl": {
            "url": "https://dummyurl.com/inputartifactzipresource",
            "fileId": "92345678-1234-1111-1234-123456789012",
            "filename": "inputartifacts.zip",
            "fileType": 2,
            "expireTime": "2021-12-05T16:43:46.072Z",
            "validationStatus": ""
          },
          "additionalUrls": []
        },
        "secrets": {
          "secret1": {
            "value": "https://samplevault.vault.azure.net/secrets/samplesecret/f113f91fd4c44a368049849c164db827",
            "type": "AKV_SECRET_URI"
          }
        },
        "environmentVariables": {
          "envvar1": "sampletext"
        },
        "subnetId": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/samplerg/providers/Microsoft.Network/virtualNetworks/samplenetworkresource/subnets/AAAAA0A0A0",
        "keyvaultReferenceIdentityType": "UserAssigned",
        "keyvaultReferenceIdentityId": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/samplerg/providers/Microsoft.ManagedIdentity/userAssignedIdentities/identity1"
      }
security: []
metadata:
  description: Learn more about Azure Load Testing service - Create a new test or Update an existing test.
errorCodes: []
