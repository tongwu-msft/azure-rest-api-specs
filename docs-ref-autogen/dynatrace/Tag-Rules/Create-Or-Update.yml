### YamlMime:RESTOperation
uid: management.azure.com.dynatrace.tagrules.createorupdate
name: Create Or Update
service: Dynatrace
groupName: Tag Rules
apiVersion: 2021-09-01-preview
summary: Create a TagRule
consumes:
- application/json
produces:
- application/json
paths:
- content: PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Dynatrace.Observability/monitors/{monitorName}/tagRules/{ruleSetName}?api-version=2021-09-01-preview
uriParameters:
- name: subscriptionId
  in: path
  isRequired: true
  description: The ID of the target subscription.
  types:
  - uid: string
- name: resourceGroupName
  in: path
  isRequired: true
  description: The name of the resource group. The name is case insensitive.
  types:
  - uid: string
- name: monitorName
  in: path
  isRequired: true
  description: Monitor resource name
  types:
  - uid: string
- name: ruleSetName
  in: path
  isRequired: true
  description: Monitor resource name
  types:
  - uid: string
- name: api-version
  in: query
  isRequired: true
  description: The API version to use for this operation.
  types:
  - uid: string
responses:
- name: 200 OK
  description: ARM operation completed successfully.
  types:
  - uid: TagRule
- name: 201 Created
  description: ARM create operation completed successfully.
  types:
  - uid: TagRule
- name: Other Status Codes
  description: Common error response for all Azure Resource Manager APIs to return error details for failed operations.
  types:
  - uid: ErrorResponse
requestBody:
- name: default
  parameters:
  - name: properties.logRules
    in: body
    description: Set of rules for sending logs for the Monitor resource.
    types:
    - uid: LogRules
  - name: properties.metricRules
    in: body
    description: Set of rules for sending metrics for the Monitor resource.
    types:
    - uid: MetricRules
requestHeader: []
definitions:
- name: systemData
  description: Metadata pertaining to creation and last modification of the resource.
  kind: object
  properties:
  - name: createdBy
    description: The identity that created the resource.
    types:
    - uid: string
  - name: createdByType
    description: The type of identity that created the resource.
    types:
    - uid: createdByType
  - name: createdAt
    description: The timestamp of resource creation (UTC).
    types:
    - uid: string
  - name: lastModifiedBy
    description: The identity that last modified the resource.
    types:
    - uid: string
  - name: lastModifiedByType
    description: The type of identity that last modified the resource.
    types:
    - uid: createdByType
  - name: lastModifiedAt
    description: The timestamp of resource last modification (UTC)
    types:
    - uid: string
- name: LogRules
  description: Set of rules for sending logs for the Monitor resource.
  kind: object
  properties:
  - name: sendAadLogs
    description: Flag specifying if AAD logs should be sent for the Monitor resource.
    types:
    - uid: SendAadLogsStatus
  - name: sendSubscriptionLogs
    description: Flag specifying if subscription logs should be sent for the Monitor resource.
    types:
    - uid: SendSubscriptionLogsStatus
  - name: sendActivityLogs
    description: Flag specifying if activity logs from Azure resources should be sent for the Monitor resource.
    types:
    - uid: SendActivityLogsStatus
  - name: filteringTags
    description: >-
      List of filtering tags to be used for capturing logs. This only takes effect if SendActivityLogs flag is enabled. If empty, all resources will be captured.

      If only Exclude action is specified, the rules will apply to the list of all available resources. If Include actions are specified, the rules will only include resources with the associated tags.
    types:
    - uid: FilteringTag
      isArray: true
- name: MetricRules
  description: Set of rules for sending metrics for the Monitor resource.
  kind: object
  properties:
  - name: filteringTags
    description: List of filtering tags to be used for capturing metrics. If empty, all resources will be captured. If only Exclude action is specified, the rules will apply to the list of all available resources. If Include actions are specified, the rules will only include resources with the associated tags.
    types:
    - uid: FilteringTag
      isArray: true
- name: TagRule
  description: Tag rules for a monitor resource
  kind: object
  properties:
  - name: systemData
    isReadyOnly: true
    description: System metadata for this resource.
    types:
    - uid: systemData
  - name: properties.logRules
    description: Set of rules for sending logs for the Monitor resource.
    types:
    - uid: LogRules
  - name: properties.metricRules
    description: Set of rules for sending metrics for the Monitor resource.
    types:
    - uid: MetricRules
  - name: properties.provisioningState
    isReadyOnly: true
    description: Provisioning state of the resource.
    types:
    - uid: ProvisioningState
  - name: id
    isReadyOnly: true
    description: Fully qualified resource ID for the resource. Ex - /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/{resourceProviderNamespace}/{resourceType}/{resourceName}
    types:
    - uid: string
  - name: name
    isReadyOnly: true
    description: The name of the resource
    types:
    - uid: string
  - name: type
    isReadyOnly: true
    description: The type of the resource. E.g. "Microsoft.Compute/virtualMachines" or "Microsoft.Storage/storageAccounts"
    types:
    - uid: string
- name: ErrorResponse
  description: Error response
  kind: object
  properties:
  - name: error
    description: The error object.
    types:
    - uid: ErrorDetail
- name: createdByType
  description: The type of identity that created the resource.
  kind: enum
  properties:
  - name: User
    types:
    - uid: string
  - name: Application
    types:
    - uid: string
  - name: ManagedIdentity
    types:
    - uid: string
  - name: Key
    types:
    - uid: string
- name: SendAadLogsStatus
  description: Indicates whether AAD logs are being sent.
  kind: enum
  properties:
  - name: Enabled
    types:
    - uid: string
  - name: Disabled
    types:
    - uid: string
- name: SendSubscriptionLogsStatus
  description: Indicates whether subscription logs are being sent.
  kind: enum
  properties:
  - name: Enabled
    types:
    - uid: string
  - name: Disabled
    types:
    - uid: string
- name: SendActivityLogsStatus
  description: Indicates whether activity logs are being sent.
  kind: enum
  properties:
  - name: Enabled
    types:
    - uid: string
  - name: Disabled
    types:
    - uid: string
- name: FilteringTag
  description: The definition of a filtering tag. Filtering tags are used for capturing resources and include/exclude them from being monitored.
  kind: object
  properties:
  - name: name
    description: The name (also known as the key) of the tag.
    types:
    - uid: string
  - name: value
    description: The value of the tag.
    types:
    - uid: string
  - name: action
    description: Valid actions for a filtering tag. Exclusion takes priority over inclusion.
    types:
    - uid: TagAction
- name: ProvisioningState
  description: Provisioning state of the monitoring resource
  kind: enum
  properties:
  - name: Accepted
    types:
    - uid: string
  - name: Creating
    types:
    - uid: string
  - name: Updating
    types:
    - uid: string
  - name: Deleting
    types:
    - uid: string
  - name: Succeeded
    types:
    - uid: string
  - name: Failed
    types:
    - uid: string
  - name: Canceled
    types:
    - uid: string
  - name: Deleted
    types:
    - uid: string
  - name: NotSpecified
    types:
    - uid: string
- name: ErrorDetail
  description: The error detail.
  kind: object
  properties:
  - name: code
    isReadyOnly: true
    description: The error code.
    types:
    - uid: string
  - name: message
    isReadyOnly: true
    description: The error message.
    types:
    - uid: string
  - name: target
    isReadyOnly: true
    description: The error target.
    types:
    - uid: string
  - name: details
    isReadyOnly: true
    description: The error details.
    types:
    - uid: ErrorDetail
      isArray: true
  - name: additionalInfo
    isReadyOnly: true
    description: The error additional info.
    types:
    - uid: ErrorAdditionalInfo
      isArray: true
- name: TagAction
  description: Valid actions for a filtering tag. Exclusion takes priority over inclusion.
  kind: enum
  properties:
  - name: Include
    types:
    - uid: string
  - name: Exclude
    types:
    - uid: string
- name: ErrorAdditionalInfo
  description: The resource management error additional info.
  kind: object
  properties:
  - name: type
    isReadyOnly: true
    description: The additional info type.
    types:
    - uid: string
  - name: info
    isReadyOnly: true
    description: The additional info.
    types:
    - uid: object
examples:
- name: TagRules_CreateOrUpdate_MaximumSet_Gen
  request:
    uri: PUT https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myResourceGroup/providers/Dynatrace.Observability/monitors/myMonitor/tagRules/default?api-version=2021-09-01-preview
    body: >-
      {
        "properties": {
          "logRules": {
            "sendAadLogs": "Enabled",
            "sendSubscriptionLogs": "Enabled",
            "sendActivityLogs": "Enabled",
            "filteringTags": [
              {
                "name": "Environment",
                "value": "Prod",
                "action": "Include"
              },
              {
                "name": "Environment",
                "value": "Dev",
                "action": "Exclude"
              }
            ]
          },
          "metricRules": {
            "filteringTags": [
              {
                "name": "Environment",
                "value": "Prod",
                "action": "Include"
              }
            ]
          },
          "provisioningState": "Accepted"
        }
      }
    codeTab: |+
      # [HTTP](#tab/HTTP)
      ``` http
      PUT https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myResourceGroup/providers/Dynatrace.Observability/monitors/myMonitor/tagRules/default?api-version=2021-09-01-preview

      {
        "properties": {
          "logRules": {
            "sendAadLogs": "Enabled",
            "sendSubscriptionLogs": "Enabled",
            "sendActivityLogs": "Enabled",
            "filteringTags": [
              {
                "name": "Environment",
                "value": "Prod",
                "action": "Include"
              },
              {
                "name": "Environment",
                "value": "Dev",
                "action": "Exclude"
              }
            ]
          },
          "metricRules": {
            "filteringTags": [
              {
                "name": "Environment",
                "value": "Prod",
                "action": "Include"
              }
            ]
          },
          "provisioningState": "Accepted"
        }
      }

      ```

      # [Java](#tab/Java)
      ``` java
      import com.azure.resourcemanager.dynatrace.models.FilteringTag;
      import com.azure.resourcemanager.dynatrace.models.LogRules;
      import com.azure.resourcemanager.dynatrace.models.MetricRules;
      import com.azure.resourcemanager.dynatrace.models.SendAadLogsStatus;
      import com.azure.resourcemanager.dynatrace.models.SendActivityLogsStatus;
      import com.azure.resourcemanager.dynatrace.models.SendSubscriptionLogsStatus;
      import com.azure.resourcemanager.dynatrace.models.TagAction;
      import java.util.Arrays;

      /** Samples for TagRules CreateOrUpdate. */
      public final class Main {
          /*
           * x-ms-original-file: specification/dynatrace/resource-manager/Dynatrace.Observability/preview/2021-09-01-preview/examples/TagRules_CreateOrUpdate_MaximumSet_Gen.json
           */
          /**
           * Sample code: TagRules_CreateOrUpdate_MaximumSet_Gen.
           *
           * @param manager Entry point to DynatraceManager.
           */
          public static void tagRulesCreateOrUpdateMaximumSetGen(
              com.azure.resourcemanager.dynatrace.DynatraceManager manager) {
              manager
                  .tagRules()
                  .define("default")
                  .withExistingMonitor("myResourceGroup", "myMonitor")
                  .withLogRules(
                      new LogRules()
                          .withSendAadLogs(SendAadLogsStatus.ENABLED)
                          .withSendSubscriptionLogs(SendSubscriptionLogsStatus.ENABLED)
                          .withSendActivityLogs(SendActivityLogsStatus.ENABLED)
                          .withFilteringTags(
                              Arrays
                                  .asList(
                                      new FilteringTag()
                                          .withName("Environment")
                                          .withValue("Prod")
                                          .withAction(TagAction.INCLUDE),
                                      new FilteringTag()
                                          .withName("Environment")
                                          .withValue("Dev")
                                          .withAction(TagAction.EXCLUDE))))
                  .withMetricRules(
                      new MetricRules()
                          .withFilteringTags(
                              Arrays
                                  .asList(
                                      new FilteringTag()
                                          .withName("Environment")
                                          .withValue("Prod")
                                          .withAction(TagAction.INCLUDE))))
                  .create();
          }
      }

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-java/blob/azure-resourcemanager-dynatrace_1.0.0-beta.1/sdk/dynatrace/azure-resourcemanager-dynatrace/README.md) on how to add the SDK to your project and authenticate.
      # [Go](#tab/Go)
      ``` go
      package armdynatrace_test

      import (
      	"context"
      	"log"

      	"github.com/Azure/azure-sdk-for-go/sdk/azcore/to"
      	"github.com/Azure/azure-sdk-for-go/sdk/azidentity"
      	"github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/dynatrace/armdynatrace"
      )

      // Generated from example definition: https://github.com/Azure/azure-rest-api-specs/tree/main/specification/dynatrace/resource-manager/Dynatrace.Observability/preview/2021-09-01-preview/examples/TagRules_CreateOrUpdate_MaximumSet_Gen.json
      func ExampleTagRulesClient_BeginCreateOrUpdate() {
      	cred, err := azidentity.NewDefaultAzureCredential(nil)
      	if err != nil {
      		log.Fatalf("failed to obtain a credential: %v", err)
      	}
      	ctx := context.Background()
      	client, err := armdynatrace.NewTagRulesClient("00000000-0000-0000-0000-000000000000", cred, nil)
      	if err != nil {
      		log.Fatalf("failed to create client: %v", err)
      	}
      	poller, err := client.BeginCreateOrUpdate(ctx,
      		"myResourceGroup",
      		"myMonitor",
      		"default",
      		armdynatrace.TagRule{
      			Properties: &armdynatrace.MonitoringTagRulesProperties{
      				LogRules: &armdynatrace.LogRules{
      					FilteringTags: []*armdynatrace.FilteringTag{
      						{
      							Name:   to.Ptr("Environment"),
      							Action: to.Ptr(armdynatrace.TagActionInclude),
      							Value:  to.Ptr("Prod"),
      						},
      						{
      							Name:   to.Ptr("Environment"),
      							Action: to.Ptr(armdynatrace.TagActionExclude),
      							Value:  to.Ptr("Dev"),
      						}},
      					SendAADLogs:          to.Ptr(armdynatrace.SendAADLogsStatusEnabled),
      					SendActivityLogs:     to.Ptr(armdynatrace.SendActivityLogsStatusEnabled),
      					SendSubscriptionLogs: to.Ptr(armdynatrace.SendSubscriptionLogsStatusEnabled),
      				},
      				MetricRules: &armdynatrace.MetricRules{
      					FilteringTags: []*armdynatrace.FilteringTag{
      						{
      							Name:   to.Ptr("Environment"),
      							Action: to.Ptr(armdynatrace.TagActionInclude),
      							Value:  to.Ptr("Prod"),
      						}},
      				},
      				ProvisioningState: to.Ptr(armdynatrace.ProvisioningStateAccepted),
      			},
      		},
      		nil)
      	if err != nil {
      		log.Fatalf("failed to finish the request: %v", err)
      	}
      	res, err := poller.PollUntilDone(ctx, nil)
      	if err != nil {
      		log.Fatalf("failed to pull the result: %v", err)
      	}
      	// TODO: use response item
      	_ = res
      }

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-go/blob/sdk%2Fresourcemanager%2Fdynatrace%2Farmdynatrace%2Fv0.1.0/sdk/resourcemanager/dynatrace/armdynatrace/README.md) on how to add the SDK to your project and authenticate.
  responses:
  - statusCode: "200"
    body: >-
      {
        "properties": {
          "logRules": {
            "sendAadLogs": "Enabled",
            "sendSubscriptionLogs": "Enabled",
            "sendActivityLogs": "Enabled",
            "filteringTags": [
              {
                "name": "Environment",
                "value": "Prod",
                "action": "Include"
              },
              {
                "name": "Environment",
                "value": "Dev",
                "action": "Exclude"
              }
            ]
          },
          "metricRules": {
            "filteringTags": [
              {
                "name": "Environment",
                "value": "Prod",
                "action": "Include"
              }
            ]
          },
          "provisioningState": "Accepted"
        },
        "systemData": {
          "createdBy": "alice@microsoft.com",
          "createdByType": "User",
          "createdAt": "2021-07-16T04:25:21.040Z",
          "lastModifiedBy": "alice@microsoft.com",
          "lastModifiedByType": "User",
          "lastModifiedAt": "2021-07-16T04:25:21.040Z"
        },
        "id": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myResourceGroup/providers/Dynatrace.Observability/monitors/myMonitor/tagRules/default",
        "name": "default",
        "type": "Dynatrace.Observability/monitors/tagRules"
      }
  - statusCode: "201"
    headers:
    - name: Azure-AsyncOperation
      value: https://foo.com/operationstatus
    body: >-
      {
        "properties": {
          "logRules": {
            "sendAadLogs": "Enabled",
            "sendSubscriptionLogs": "Enabled",
            "sendActivityLogs": "Enabled",
            "filteringTags": [
              {
                "name": "Environment",
                "value": "Prod",
                "action": "Include"
              },
              {
                "name": "Environment",
                "value": "Dev",
                "action": "Exclude"
              }
            ]
          },
          "metricRules": {
            "filteringTags": [
              {
                "name": "Environment",
                "value": "Prod",
                "action": "Include"
              }
            ]
          },
          "provisioningState": "Accepted"
        },
        "systemData": {
          "createdBy": "alice@microsoft.com",
          "createdByType": "User",
          "createdAt": "2021-07-16T04:25:21.040Z",
          "lastModifiedBy": "alice@microsoft.com",
          "lastModifiedByType": "User",
          "lastModifiedAt": "2021-07-16T04:25:21.040Z"
        },
        "id": "/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myResourceGroup/providers/Dynatrace.Observability/monitors/myMonitor/tagRules/default",
        "name": "default",
        "type": "Dynatrace.Observability/monitors/tagRules"
      }
- name: TagRules_CreateOrUpdate_MinimumSet_Gen
  request:
    uri: PUT https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myResourceGroup/providers/Dynatrace.Observability/monitors/myMonitor/tagRules/default?api-version=2021-09-01-preview
    body: >-
      {
        "properties": {}
      }
    codeTab: |+
      # [HTTP](#tab/HTTP)
      ``` http
      PUT https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000000/resourceGroups/myResourceGroup/providers/Dynatrace.Observability/monitors/myMonitor/tagRules/default?api-version=2021-09-01-preview

      {
        "properties": {}
      }

      ```

      # [Java](#tab/Java)
      ``` java
      /** Samples for TagRules CreateOrUpdate. */
      public final class Main {
          /*
           * x-ms-original-file: specification/dynatrace/resource-manager/Dynatrace.Observability/preview/2021-09-01-preview/examples/TagRules_CreateOrUpdate_MinimumSet_Gen.json
           */
          /**
           * Sample code: TagRules_CreateOrUpdate_MinimumSet_Gen.
           *
           * @param manager Entry point to DynatraceManager.
           */
          public static void tagRulesCreateOrUpdateMinimumSetGen(
              com.azure.resourcemanager.dynatrace.DynatraceManager manager) {
              manager.tagRules().define("default").withExistingMonitor("myResourceGroup", "myMonitor").create();
          }
      }

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-java/blob/azure-resourcemanager-dynatrace_1.0.0-beta.1/sdk/dynatrace/azure-resourcemanager-dynatrace/README.md) on how to add the SDK to your project and authenticate.
  responses:
  - statusCode: "200"
    body: >-
      {
        "properties": {}
      }
  - statusCode: "201"
    headers:
    - name: Azure-AsyncOperation
      value: https://foo.com/operationstatus
    body: >-
      {
        "properties": {}
      }
security:
- name: azure_auth
  type: oauth2
  description: Azure Active Directory OAuth2 Flow.
  flow: implicit
  authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
  scopes:
  - name: user_impersonation
    description: impersonate your user account
metadata:
  description: Learn more about Dynatrace service - Create a TagRule
errorCodes: []
