### YamlMime:RESTOperation
uid: your-dps.azure-devices-provisioning.net.iot-dps.service.individualenrollment.createorupdate
name: Create Or Update
service: IoT Hub Device Provisioning Service
groupName: Individual Enrollment
apiVersion: 2021-06-01
summary: Create or update a device enrollment record.
consumes:
- application/json
produces:
- application/json
paths:
- content: PUT https://your-dps.azure-devices-provisioning.net/enrollments/{id}?api-version=2021-06-01
uriParameters:
- name: id
  in: path
  isRequired: true
  description: The registration ID is alphanumeric, lowercase, and may contain hyphens.
  types:
  - uid: string
- name: api-version
  in: query
  isRequired: true
  description: 'The API version to use for the request. Supported versions include: 2021-06-01'
  types:
  - uid: string
responses:
- name: 200 OK
  description: Success
  types:
  - uid: IndividualEnrollment
- name: Other Status Codes
  description: Error response
  types:
  - uid: ProvisioningServiceErrorDetails
requestBody:
- name: default
  parameters:
  - name: registrationId
    in: body
    isRequired: true
    description: The registration ID is alphanumeric, lowercase, and may contain hyphens.
    types:
    - uid: string
  - name: deviceId
    in: body
    description: Desired IoT Hub device ID (optional).
    types:
    - uid: string
  - name: optionalDeviceInformation
    in: body
    description: Optional Device Information.
    types:
    - uid: TwinCollection
  - name: attestation
    in: body
    isRequired: true
    description: Attestation method used by the device.
    types:
    - uid: AttestationMechanism
  - name: capabilities
    in: body
    description: Capabilities of the device.
    types:
    - uid: DeviceCapabilities
  - name: iotHubHostName
    in: body
    description: The Iot Hub host name.
    types:
    - uid: string
  - name: initialTwin
    in: body
    description: Initial device twin.
    types:
    - uid: InitialTwin
  - name: etag
    in: body
    description: The entity tag associated with the resource.
    types:
    - uid: string
  - name: provisioningStatus
    in: body
    description: The provisioning status.
    types:
    - uid: enabled
    - uid: disabled
    typesTitle: enum
  - name: reprovisionPolicy
    in: body
    description: The behavior when a device is re-provisioned to an IoT hub.
    types:
    - uid: ReprovisionPolicy
  - name: allocationPolicy
    in: body
    description: "The allocation policy of this resource. This policy overrides the tenant level allocation policy for this individual enrollment or enrollment group. Possible values include 'hashed': Linked IoT hubs are equally likely to have devices provisioned to them, 'geoLatency':  Devices are provisioned to an IoT hub with the lowest latency to the device.If multiple linked IoT hubs would provide the same lowest latency, the provisioning service hashes devices across those hubs, 'static' : Specification of the desired IoT hub in the enrollment list takes priority over the service-level allocation policy, 'custom': Devices are provisioned to an IoT hub based on your own custom logic. The provisioning service passes information about the device to the logic, and the logic returns the desired IoT hub as well as the desired initial configuration. We recommend using Azure Functions to host your logic."
    types:
    - uid: hashed
    - uid: geoLatency
    - uid: static
    - uid: custom
    typesTitle: enum
  - name: iotHubs
    in: body
    description: The list of IoT Hub hostnames the device(s) in this resource can be allocated to. Must be a subset of tenant level list of IoT hubs.
    types:
    - uid: string
      isArray: true
  - name: customAllocationDefinition
    in: body
    description: This tells DPS which webhook to call when using custom allocation.
    types:
    - uid: CustomAllocationDefinition
requestHeader:
- name: If-Match
  in: header
  description: The ETag of the enrollment record.
  types:
  - uid: string
definitions:
- name: DeviceRegistrationState
  description: Device registration state.
  kind: object
  properties:
  - name: registrationId
    isReadyOnly: true
    description: The registration ID is alphanumeric, lowercase, and may contain hyphens.
    types:
    - uid: string
  - name: createdDateTimeUtc
    isReadyOnly: true
    description: Registration create date time (in UTC).
    types:
    - uid: string
  - name: assignedHub
    isReadyOnly: true
    description: Assigned Azure IoT Hub.
    types:
    - uid: string
  - name: deviceId
    isReadyOnly: true
    description: Device ID.
    types:
    - uid: string
  - name: status
    isReadyOnly: true
    description: Enrollment status.
    types:
    - uid: unassigned
    - uid: assigning
    - uid: assigned
    - uid: failed
    - uid: disabled
    typesTitle: enum
  - name: substatus
    isReadyOnly: true
    description: "Substatus for 'Assigned' devices. Possible values include - 'initialAssignment': Device has been assigned to an IoT hub for the first time, 'deviceDataMigrated': Device has been assigned to a different IoT hub and its device data was migrated from the previously assigned IoT hub. Device data was removed from the previously assigned IoT hub, 'deviceDataReset':  Device has been assigned to a different IoT hub and its device data was populated from the initial state stored in the enrollment. Device data was removed from the previously assigned IoT hub, 'reprovisionedToInitialAssignment': Device has been re-provisioned to a previously assigned IoT hub."
    types:
    - uid: initialAssignment
    - uid: deviceDataMigrated
    - uid: deviceDataReset
    - uid: reprovisionedToInitialAssignment
    typesTitle: enum
  - name: errorCode
    isReadyOnly: true
    description: Error code.
    types:
    - uid: integer
  - name: errorMessage
    isReadyOnly: true
    description: Error message.
    types:
    - uid: string
  - name: lastUpdatedDateTimeUtc
    isReadyOnly: true
    description: Last updated date time (in UTC).
    types:
    - uid: string
  - name: etag
    isReadyOnly: true
    description: The entity tag associated with the resource.
    types:
    - uid: string
  - name: payload
    isReadyOnly: true
    description: Custom allocation payload returned from the webhook to the device.
    types:
    - uid: object
- name: TwinCollection
  description: Represents a collection of properties within a Twin
  kind: object
  properties:
  - name: version
    description: Version of the TwinCollection
    types:
    - uid: integer
  - name: count
    description: Number of properties in the TwinCollection
    types:
    - uid: integer
  - name: metadata
    description: Metadata for the TwinCollection
    types:
    - uid: Metadata
- name: AttestationMechanism
  description: Attestation mechanism for individualEnrollment as well as enrollmentGroup.
  kind: object
  properties:
  - name: type
    description: Attestation Type.
    types:
    - uid: none
    - uid: tpm
    - uid: x509
    - uid: symmetricKey
    typesTitle: enum
  - name: tpm
    description: TPM attestation method.
    types:
    - uid: TpmAttestation
  - name: x509
    description: X509 attestation method.
    types:
    - uid: X509Attestation
  - name: symmetricKey
    description: Symmetric Key attestation method.
    types:
    - uid: SymmetricKeyAttestation
- name: DeviceCapabilities
  description: Device capabilities.
  kind: object
  properties:
  - name: iotEdge
    description: If set to true, this device is an IoTEdge device.
    types:
    - uid: boolean
    defaultValue: "false"
- name: InitialTwin
  description: Initial device twin. Contains a subset of the properties of Twin.
  kind: object
  properties:
  - name: tags
    description: Twin tags.
    types:
    - uid: TwinCollection
  - name: properties
    description: Twin desired properties.
    types:
    - uid: InitialTwinProperties
- name: ReprovisionPolicy
  description: The behavior of the service when a device is re-provisioned to an IoT hub.
  kind: object
  properties:
  - name: updateHubAssignment
    description: When set to true (default), the Device Provisioning Service will evaluate the device's IoT Hub assignment and update it if necessary for any provisioning requests beyond the first from a given device. If set to false, the device will stay assigned to its current IoT hub.
    types:
    - uid: boolean
    defaultValue: "true"
  - name: migrateDeviceData
    description: When set to true (default), the Device Provisioning Service will migrate the device's data (twin, device capabilities, and device ID) from one IoT hub to another during an IoT hub assignment update. If set to false, the Device Provisioning Service will reset the device's data to the initial desired configuration stored in the corresponding enrollment list.
    types:
    - uid: boolean
    defaultValue: "true"
- name: CustomAllocationDefinition
  description: This tells DPS which webhook to call when using custom allocation.
  kind: object
  properties:
  - name: webhookUrl
    description: The webhook URL used for allocation requests.
    types:
    - uid: string
  - name: apiVersion
    description: 'The API version of the provisioning service types (such as IndividualEnrollment) sent in the custom allocation request. Minimum supported version: "2018-09-01-preview".'
    types:
    - uid: string
- name: IndividualEnrollment
  description: The device enrollment record.
  kind: object
  properties:
  - name: registrationId
    description: The registration ID is alphanumeric, lowercase, and may contain hyphens.
    types:
    - uid: string
  - name: deviceId
    description: Desired IoT Hub device ID (optional).
    types:
    - uid: string
  - name: registrationState
    isReadyOnly: true
    description: Current registration status.
    types:
    - uid: DeviceRegistrationState
  - name: optionalDeviceInformation
    description: Optional Device Information.
    types:
    - uid: TwinCollection
  - name: attestation
    description: Attestation method used by the device.
    types:
    - uid: AttestationMechanism
  - name: capabilities
    description: Capabilities of the device.
    types:
    - uid: DeviceCapabilities
  - name: iotHubHostName
    description: The Iot Hub host name.
    types:
    - uid: string
  - name: initialTwin
    description: Initial device twin.
    types:
    - uid: InitialTwin
  - name: etag
    description: The entity tag associated with the resource.
    types:
    - uid: string
  - name: provisioningStatus
    description: The provisioning status.
    types:
    - uid: enabled
    - uid: disabled
    typesTitle: enum
    defaultValue: enabled
  - name: reprovisionPolicy
    description: The behavior when a device is re-provisioned to an IoT hub.
    types:
    - uid: ReprovisionPolicy
  - name: createdDateTimeUtc
    isReadyOnly: true
    description: The DateTime this resource was created.
    types:
    - uid: string
  - name: lastUpdatedDateTimeUtc
    isReadyOnly: true
    description: The DateTime this resource was last updated.
    types:
    - uid: string
  - name: allocationPolicy
    description: "The allocation policy of this resource. This policy overrides the tenant level allocation policy for this individual enrollment or enrollment group. Possible values include 'hashed': Linked IoT hubs are equally likely to have devices provisioned to them, 'geoLatency':  Devices are provisioned to an IoT hub with the lowest latency to the device.If multiple linked IoT hubs would provide the same lowest latency, the provisioning service hashes devices across those hubs, 'static' : Specification of the desired IoT hub in the enrollment list takes priority over the service-level allocation policy, 'custom': Devices are provisioned to an IoT hub based on your own custom logic. The provisioning service passes information about the device to the logic, and the logic returns the desired IoT hub as well as the desired initial configuration. We recommend using Azure Functions to host your logic."
    types:
    - uid: hashed
    - uid: geoLatency
    - uid: static
    - uid: custom
    typesTitle: enum
  - name: iotHubs
    description: The list of IoT Hub hostnames the device(s) in this resource can be allocated to. Must be a subset of tenant level list of IoT hubs.
    types:
    - uid: string
      isArray: true
  - name: customAllocationDefinition
    description: This tells DPS which webhook to call when using custom allocation.
    types:
    - uid: CustomAllocationDefinition
- name: ProvisioningServiceErrorDetails
  description: Contains the properties of an error returned by the Azure IoT Hub Provisioning Service.
  kind: object
  properties:
  - name: errorCode
    description: ''
    types:
    - uid: integer
  - name: trackingId
    description: ''
    types:
    - uid: string
  - name: message
    description: ''
    types:
    - uid: string
  - name: info
    description: ''
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
  - name: timestampUtc
    description: ''
    types:
    - uid: string
- name: Metadata
  description: Metadata for the TwinCollection
  kind: object
  properties:
  - name: lastUpdated
    description: Last time the TwinCollection was updated
    types:
    - uid: string
  - name: lastUpdatedVersion
    description: This is null for reported properties metadata and is not null for desired properties metadata.
    types:
    - uid: integer
- name: TpmAttestation
  description: Attestation via TPM.
  kind: object
  properties:
  - name: endorsementKey
    description: ''
    types:
    - uid: string
  - name: storageRootKey
    description: ''
    types:
    - uid: string
- name: X509Attestation
  description: Attestation via X509.
  kind: object
  properties:
  - name: clientCertificates
    description: Primary and secondary certificates
    types:
    - uid: X509Certificates
  - name: signingCertificates
    description: Primary and secondary certificates
    types:
    - uid: X509Certificates
  - name: caReferences
    description: Primary and secondary CA references.
    types:
    - uid: X509CAReferences
- name: SymmetricKeyAttestation
  description: Attestation via SymmetricKey.
  kind: object
  properties:
  - name: primaryKey
    description: Primary symmetric key.
    types:
    - uid: string
  - name: secondaryKey
    description: Secondary symmetric key.
    types:
    - uid: string
- name: InitialTwinProperties
  description: Represents the initial properties that will be set on the device twin.
  kind: object
  properties:
  - name: desired
    description: Gets and sets the InitialTwin desired properties.
    types:
    - uid: TwinCollection
- name: X509Certificates
  description: Primary and secondary certificates
  kind: object
  properties:
  - name: primary
    description: Certificate and Certificate info
    types:
    - uid: X509CertificateWithInfo
  - name: secondary
    description: Certificate and Certificate info
    types:
    - uid: X509CertificateWithInfo
- name: X509CAReferences
  description: Primary and secondary CA references.
  kind: object
  properties:
  - name: primary
    description: ''
    types:
    - uid: string
  - name: secondary
    description: ''
    types:
    - uid: string
- name: X509CertificateWithInfo
  description: Certificate and Certificate info
  kind: object
  properties:
  - name: certificate
    description: ''
    types:
    - uid: string
  - name: info
    description: X509 certificate info.
    types:
    - uid: X509CertificateInfo
- name: X509CertificateInfo
  description: X509 certificate info.
  kind: object
  properties:
  - name: subjectName
    description: ''
    types:
    - uid: string
  - name: sha1Thumbprint
    description: ''
    types:
    - uid: string
  - name: sha256Thumbprint
    description: ''
    types:
    - uid: string
  - name: issuerName
    description: ''
    types:
    - uid: string
  - name: notBeforeUtc
    description: ''
    types:
    - uid: string
  - name: notAfterUtc
    description: ''
    types:
    - uid: string
  - name: serialNumber
    description: ''
    types:
    - uid: string
  - name: version
    description: ''
    types:
    - uid: integer
examples: []
security: []
metadata:
  description: Learn more about IoT Hub Device Provisioning Service service - Create or update a device enrollment record.
errorCodes: []
