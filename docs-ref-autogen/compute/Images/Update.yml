### YamlMime:RESTOperation
uid: management.azure.com.compute.images.update
name: Update
service: Compute
groupName: Images
apiVersion: 2022-03-01
summary: Update an image.
consumes:
- application/json
produces:
- application/json
paths:
- content: PATCH https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Compute/images/{imageName}?api-version=2022-03-01
uriParameters:
- name: subscriptionId
  in: path
  isRequired: true
  description: Subscription credentials which uniquely identify Microsoft Azure subscription. The subscription ID forms part of the URI for every service call.
  types:
  - uid: string
- name: resourceGroupName
  in: path
  isRequired: true
  description: The name of the resource group.
  types:
  - uid: string
- name: imageName
  in: path
  isRequired: true
  description: The name of the image.
  types:
  - uid: string
- name: api-version
  in: query
  isRequired: true
  description: Client Api Version.
  types:
  - uid: string
responses:
- name: 200 OK
  description: OK
  types:
  - uid: Image
- name: 201 Created
  description: Created
  types:
  - uid: Image
- name: Other Status Codes
  description: Error response describing why the operation failed.
  types:
  - uid: CloudError
requestBody:
- name: default
  parameters:
  - name: properties.sourceVirtualMachine
    in: body
    description: The source virtual machine from which Image is created.
    types:
    - uid: SubResource
  - name: properties.storageProfile
    in: body
    description: Specifies the storage settings for the virtual machine disks.
    types:
    - uid: ImageStorageProfile
  - name: properties.hyperVGeneration
    in: body
    description: Specifies the HyperVGenerationType of the VirtualMachine created from the image. From API Version 2019-03-01 if the image source is a blob, then we need the user to specify the value, if the source is managed resource like disk or snapshot, we may require the user to specify the property if we cannot deduce it from the source managed resource.
    types:
    - uid: HyperVGenerationTypes
  - name: tags
    in: body
    description: Resource tags
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
requestHeader: []
definitions:
- name: SubResource
  kind: object
  properties:
  - name: id
    description: Resource Id
    types:
    - uid: string
- name: ImageStorageProfile
  description: Describes a storage profile.
  kind: object
  properties:
  - name: osDisk
    description: Specifies information about the operating system disk used by the virtual machine. <br><br> For more information about disks, see [About disks and VHDs for Azure virtual machines](https://docs.microsoft.com/azure/virtual-machines/managed-disks-overview).
    types:
    - uid: ImageOSDisk
  - name: dataDisks
    description: Specifies the parameters that are used to add a data disk to a virtual machine. <br><br> For more information about disks, see [About disks and VHDs for Azure virtual machines](https://docs.microsoft.com/azure/virtual-machines/managed-disks-overview).
    types:
    - uid: ImageDataDisk
      isArray: true
  - name: zoneResilient
    description: Specifies whether an image is zone resilient or not. Default is false. Zone resilient images can be created only in regions that provide Zone Redundant Storage (ZRS).
    types:
    - uid: boolean
- name: Image
  description: The source user image virtual hard disk. The virtual hard disk will be copied before being attached to the virtual machine. If SourceImage is provided, the destination virtual hard drive must not exist.
  kind: object
  properties:
  - name: extendedLocation
    description: The extended location of the Image.
    types:
    - uid: ExtendedLocation
  - name: properties.sourceVirtualMachine
    description: The source virtual machine from which Image is created.
    types:
    - uid: SubResource
  - name: properties.storageProfile
    description: Specifies the storage settings for the virtual machine disks.
    types:
    - uid: ImageStorageProfile
  - name: properties.provisioningState
    isReadyOnly: true
    description: The provisioning state.
    types:
    - uid: string
  - name: properties.hyperVGeneration
    description: Specifies the HyperVGenerationType of the VirtualMachine created from the image. From API Version 2019-03-01 if the image source is a blob, then we need the user to specify the value, if the source is managed resource like disk or snapshot, we may require the user to specify the property if we cannot deduce it from the source managed resource.
    types:
    - uid: HyperVGenerationTypes
  - name: id
    isReadyOnly: true
    description: Resource Id
    types:
    - uid: string
  - name: name
    isReadyOnly: true
    description: Resource name
    types:
    - uid: string
  - name: type
    isReadyOnly: true
    description: Resource type
    types:
    - uid: string
  - name: location
    description: Resource location
    types:
    - uid: string
  - name: tags
    description: Resource tags
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
- name: CloudError
  description: An error response from the Compute service.
  kind: object
  properties:
  - name: error
    description: Api error.
    types:
    - uid: ApiError
- name: ImageUpdate
  description: The source user image virtual hard disk. Only tags may be updated.
  kind: object
  properties:
  - name: properties.sourceVirtualMachine
    description: The source virtual machine from which Image is created.
    types:
    - uid: SubResource
  - name: properties.storageProfile
    description: Specifies the storage settings for the virtual machine disks.
    types:
    - uid: ImageStorageProfile
  - name: properties.provisioningState
    isReadyOnly: true
    description: The provisioning state.
    types:
    - uid: string
  - name: properties.hyperVGeneration
    description: Specifies the HyperVGenerationType of the VirtualMachine created from the image. From API Version 2019-03-01 if the image source is a blob, then we need the user to specify the value, if the source is managed resource like disk or snapshot, we may require the user to specify the property if we cannot deduce it from the source managed resource.
    types:
    - uid: HyperVGenerationTypes
  - name: tags
    description: Resource tags
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
- name: ImageOSDisk
  description: Describes an Operating System disk.
  kind: object
  properties:
  - name: osType
    description: 'This property allows you to specify the type of the OS that is included in the disk if creating a VM from a custom image. <br><br> Possible values are: <br><br> **Windows** <br><br> **Linux**'
    types:
    - uid: OperatingSystemTypes
  - name: osState
    description: The OS State. For managed images, use Generalized.
    types:
    - uid: OperatingSystemStateTypes
  - name: snapshot
    description: The snapshot.
    types:
    - uid: SubResource
  - name: managedDisk
    description: The managedDisk.
    types:
    - uid: SubResource
  - name: blobUri
    description: The Virtual Hard Disk.
    types:
    - uid: string
  - name: caching
    description: 'Specifies the caching requirements. <br><br> Possible values are: <br><br> **None** <br><br> **ReadOnly** <br><br> **ReadWrite** <br><br> Default: **None for Standard storage. ReadOnly for Premium storage**'
    types:
    - uid: CachingTypes
  - name: diskSizeGB
    description: Specifies the size of empty data disks in gigabytes. This element can be used to overwrite the name of the disk in a virtual machine image. <br><br> This value cannot be larger than 1023 GB
    types:
    - uid: integer
  - name: storageAccountType
    description: 'Specifies the storage account type for the managed disk. NOTE: UltraSSD_LRS can only be used with data disks, it cannot be used with OS Disk.'
    types:
    - uid: StorageAccountTypes
  - name: diskEncryptionSet
    description: Specifies the customer managed disk encryption set resource id for the managed image disk.
    types:
    - uid: DiskEncryptionSetParameters
- name: ImageDataDisk
  description: Describes a data disk.
  kind: object
  properties:
  - name: lun
    description: Specifies the logical unit number of the data disk. This value is used to identify data disks within the VM and therefore must be unique for each data disk attached to a VM.
    types:
    - uid: integer
  - name: snapshot
    description: The snapshot.
    types:
    - uid: SubResource
  - name: managedDisk
    description: The managedDisk.
    types:
    - uid: SubResource
  - name: blobUri
    description: The Virtual Hard Disk.
    types:
    - uid: string
  - name: caching
    description: 'Specifies the caching requirements. <br><br> Possible values are: <br><br> **None** <br><br> **ReadOnly** <br><br> **ReadWrite** <br><br> Default: **None for Standard storage. ReadOnly for Premium storage**'
    types:
    - uid: CachingTypes
  - name: diskSizeGB
    description: Specifies the size of empty data disks in gigabytes. This element can be used to overwrite the name of the disk in a virtual machine image. <br><br> This value cannot be larger than 1023 GB
    types:
    - uid: integer
  - name: storageAccountType
    description: 'Specifies the storage account type for the managed disk. NOTE: UltraSSD_LRS can only be used with data disks, it cannot be used with OS Disk.'
    types:
    - uid: StorageAccountTypes
  - name: diskEncryptionSet
    description: Specifies the customer managed disk encryption set resource id for the managed image disk.
    types:
    - uid: DiskEncryptionSetParameters
- name: ExtendedLocation
  description: The complex type of the extended location.
  kind: object
  properties:
  - name: name
    description: The name of the extended location.
    types:
    - uid: string
  - name: type
    description: The type of the extended location.
    types:
    - uid: ExtendedLocationTypes
- name: HyperVGenerationTypes
  description: Specifies the HyperVGenerationType of the VirtualMachine created from the image. From API Version 2019-03-01 if the image source is a blob, then we need the user to specify the value, if the source is managed resource like disk or snapshot, we may require the user to specify the property if we cannot deduce it from the source managed resource.
  kind: enum
  properties:
  - name: V1
    types:
    - uid: string
  - name: V2
    types:
    - uid: string
- name: ApiError
  description: Api error.
  kind: object
  properties:
  - name: details
    description: The Api error details
    types:
    - uid: ApiErrorBase
      isArray: true
  - name: innererror
    description: The Api inner error
    types:
    - uid: InnerError
  - name: code
    description: The error code.
    types:
    - uid: string
  - name: target
    description: The target of the particular error.
    types:
    - uid: string
  - name: message
    description: The error message.
    types:
    - uid: string
- name: OperatingSystemTypes
  description: 'This property allows you to specify the type of the OS that is included in the disk if creating a VM from a custom image. <br><br> Possible values are: <br><br> **Windows** <br><br> **Linux**'
  kind: enum
  properties:
  - name: Windows
    types:
    - uid: string
  - name: Linux
    types:
    - uid: string
- name: OperatingSystemStateTypes
  description: The OS State. For managed images, use Generalized.
  kind: enum
  properties:
  - name: Generalized
    description: Generalized image. Needs to be provisioned during deployment time.
    types:
    - uid: string
  - name: Specialized
    description: Specialized image. Contains already provisioned OS Disk.
    types:
    - uid: string
- name: CachingTypes
  description: 'Specifies the caching requirements. <br><br> Possible values are: <br><br> **None** <br><br> **ReadOnly** <br><br> **ReadWrite** <br><br> Default: **None for Standard storage. ReadOnly for Premium storage**'
  kind: enum
  properties:
  - name: None
    types:
    - uid: string
  - name: ReadOnly
    types:
    - uid: string
  - name: ReadWrite
    types:
    - uid: string
- name: StorageAccountTypes
  description: 'Specifies the storage account type for the managed disk. NOTE: UltraSSD_LRS can only be used with data disks, it cannot be used with OS Disk.'
  kind: enum
  properties:
  - name: Standard_LRS
    types:
    - uid: string
  - name: Premium_LRS
    types:
    - uid: string
  - name: StandardSSD_LRS
    types:
    - uid: string
  - name: UltraSSD_LRS
    types:
    - uid: string
  - name: Premium_ZRS
    types:
    - uid: string
  - name: StandardSSD_ZRS
    types:
    - uid: string
  - name: PremiumV2_LRS
    types:
    - uid: string
- name: DiskEncryptionSetParameters
  description: 'Describes the parameter of customer managed disk encryption set resource id that can be specified for disk. <br><br> NOTE: The disk encryption set resource id can only be specified for managed disk. Please refer https://aka.ms/mdssewithcmkoverview for more details.'
  kind: object
  properties:
  - name: id
    description: Resource Id
    types:
    - uid: string
- name: ExtendedLocationTypes
  description: The type of the extended location.
  kind: enum
  properties:
  - name: EdgeZone
    types:
    - uid: string
- name: ApiErrorBase
  description: Api error base.
  kind: object
  properties:
  - name: code
    description: The error code.
    types:
    - uid: string
  - name: target
    description: The target of the particular error.
    types:
    - uid: string
  - name: message
    description: The error message.
    types:
    - uid: string
- name: InnerError
  description: Inner error details.
  kind: object
  properties:
  - name: exceptiontype
    description: The exception type.
    types:
    - uid: string
  - name: errordetail
    description: The internal error message or exception dump.
    types:
    - uid: string
examples:
- name: Updates tags of an Image.
  request:
    uri: PATCH https://management.azure.com/subscriptions/{subscription-id}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/images/myImage?api-version=2022-03-01
    body: >-
      {
        "properties": {
          "sourceVirtualMachine": {
            "id": "/subscriptions/{subscription-id}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVM"
          },
          "hyperVGeneration": "V1"
        },
        "tags": {
          "department": "HR"
        }
      }
    codeTab: |+
      # [HTTP](#tab/HTTP)
      ``` http
      PATCH https://management.azure.com/subscriptions/{subscription-id}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/images/myImage?api-version=2022-03-01

      {
        "properties": {
          "sourceVirtualMachine": {
            "id": "/subscriptions/{subscription-id}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVM"
          },
          "hyperVGeneration": "V1"
        },
        "tags": {
          "department": "HR"
        }
      }

      ```

      # [Java](#tab/Java)
      ``` java
      import com.azure.core.management.SubResource;
      import com.azure.core.util.Context;
      import com.azure.resourcemanager.compute.models.HyperVGenerationTypes;
      import com.azure.resourcemanager.compute.models.ImageUpdate;
      import java.util.HashMap;
      import java.util.Map;

      /** Samples for Images Update. */
      public final class Main {
          /*
           * x-ms-original-file: specification/compute/resource-manager/Microsoft.Compute/stable/2022-03-01/ComputeRP/examples/imageExamples/Image_Update.json
           */
          /**
           * Sample code: Updates tags of an Image.
           *
           * @param azure The entry point for accessing resource management APIs in Azure.
           */
          public static void updatesTagsOfAnImage(com.azure.resourcemanager.AzureResourceManager azure) {
              azure
                  .virtualMachines()
                  .manager()
                  .serviceClient()
                  .getImages()
                  .update(
                      "myResourceGroup",
                      "myImage",
                      new ImageUpdate()
                          .withTags(mapOf("department", "HR"))
                          .withSourceVirtualMachine(
                              new SubResource()
                                  .withId(
                                      "/subscriptions/{subscription-id}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVM"))
                          .withHyperVGeneration(HyperVGenerationTypes.V1),
                      Context.NONE);
          }

          @SuppressWarnings("unchecked")
          private static <T> Map<String, T> mapOf(Object... inputs) {
              Map<String, T> map = new HashMap<>();
              for (int i = 0; i < inputs.length; i += 2) {
                  String key = (String) inputs[i];
                  T value = (T) inputs[i + 1];
                  map.put(key, value);
              }
              return map;
          }
      }

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-java/blob/azure-resourcemanager_2.17.0/sdk/resourcemanager/azure-resourcemanager/README.md) on how to add the SDK to your project and authenticate.
      # [Go](#tab/Go)
      ``` go
      package armcompute_test

      import (
      	"context"
      	"log"

      	"github.com/Azure/azure-sdk-for-go/sdk/azcore/to"
      	"github.com/Azure/azure-sdk-for-go/sdk/azidentity"
      	"github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/compute/armcompute/v3"
      )

      // Generated from example definition: https://github.com/Azure/azure-rest-api-specs/tree/main/specification/compute/resource-manager/Microsoft.Compute/stable/2022-03-01/ComputeRP/examples/imageExamples/Image_Update.json
      func ExampleImagesClient_BeginUpdate() {
      	cred, err := azidentity.NewDefaultAzureCredential(nil)
      	if err != nil {
      		log.Fatalf("failed to obtain a credential: %v", err)
      	}
      	ctx := context.Background()
      	client, err := armcompute.NewImagesClient("{subscription-id}", cred, nil)
      	if err != nil {
      		log.Fatalf("failed to create client: %v", err)
      	}
      	poller, err := client.BeginUpdate(ctx,
      		"myResourceGroup",
      		"myImage",
      		armcompute.ImageUpdate{
      			Tags: map[string]*string{
      				"department": to.Ptr("HR"),
      			},
      			Properties: &armcompute.ImageProperties{
      				HyperVGeneration: to.Ptr(armcompute.HyperVGenerationTypesV1),
      				SourceVirtualMachine: &armcompute.SubResource{
      					ID: to.Ptr("/subscriptions/{subscription-id}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVM"),
      				},
      			},
      		},
      		nil)
      	if err != nil {
      		log.Fatalf("failed to finish the request: %v", err)
      	}
      	res, err := poller.PollUntilDone(ctx, nil)
      	if err != nil {
      		log.Fatalf("failed to pull the result: %v", err)
      	}
      	// TODO: use response item
      	_ = res
      }

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-go/blob/sdk%2Fresourcemanager%2Fcompute%2Farmcompute%2Fv3.0.0/sdk/resourcemanager/compute/armcompute/README.md) on how to add the SDK to your project and authenticate.
      # [JavaScript](#tab/JavaScript)
      ``` js
      const { ComputeManagementClient } = require("@azure/arm-compute");
      const { DefaultAzureCredential } = require("@azure/identity");

      /**
       * This sample demonstrates how to Update an image.
       *
       * @summary Update an image.
       * x-ms-original-file: specification/compute/resource-manager/Microsoft.Compute/stable/2022-03-01/ComputeRP/examples/imageExamples/Image_Update.json
       */
      async function updatesTagsOfAnImage() {
        const subscriptionId = "{subscription-id}";
        const resourceGroupName = "myResourceGroup";
        const imageName = "myImage";
        const parameters = {
          hyperVGeneration: "V1",
          sourceVirtualMachine: {
            id: "/subscriptions/{subscription-id}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/virtualMachines/myVM",
          },
          tags: { department: "HR" },
        };
        const credential = new DefaultAzureCredential();
        const client = new ComputeManagementClient(credential, subscriptionId);
        const result = await client.images.beginUpdateAndWait(resourceGroupName, imageName, parameters);
        console.log(result);
      }

      updatesTagsOfAnImage().catch(console.error);

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-js/blob/%40azure%2Farm-compute_19.1.0/sdk/compute/arm-compute/README.md) on how to add the SDK to your project and authenticate.
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/images/myImage",
        "name": "myImage",
        "type": "Microsoft.Compute/images",
        "location": "West US",
        "tags": {
          "department": "HR"
        },
        "properties": {
          "storageProfile": {
            "osDisk": {
              "osType": "Windows",
              "blobUri": "https://mystorageaccount.blob.core.windows.net/osimages/osimage.vhd",
              "snapshot": {
                "id": "subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/snapshots/mySnapshot1"
              },
              "managedDisk": {
                "id": "subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/disks/myManagedDisk1"
              },
              "osState": "Generalized",
              "storageAccountType": "Standard_LRS",
              "diskSizeGB": 20
            },
            "dataDisks": [
              {
                "lun": 1,
                "blobUri": "https://mystorageaccount.blob.core.windows.net/dataimages/dataimage.vhd",
                "snapshot": {
                  "id": "subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/snapshots/mySnapshot2"
                },
                "managedDisk": {
                  "id": "subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/disks/myManagedDisk2"
                },
                "storageAccountType": "Standard_LRS"
              }
            ],
            "zoneResilient": true
          },
          "provisioningState": "created"
        }
      }
  - statusCode: "201"
    body: >-
      {
        "id": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/images/myImage",
        "name": "myImage",
        "type": "Microsoft.Compute/images",
        "location": "West US",
        "tags": {
          "department": "HR"
        },
        "properties": {
          "storageProfile": {
            "osDisk": {
              "osType": "Windows",
              "blobUri": "https://mystorageaccount.blob.core.windows.net/osimages/osimage.vhd",
              "snapshot": {
                "id": "subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/snapshots/mySnapshot1"
              },
              "managedDisk": {
                "id": "subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/disks/myManagedDisk1"
              },
              "osState": "Generalized",
              "storageAccountType": "Standard_LRS",
              "diskSizeGB": 20
            },
            "dataDisks": [
              {
                "lun": 1,
                "blobUri": "https://mystorageaccount.blob.core.windows.net/dataimages/dataimage.vhd",
                "snapshot": {
                  "id": "subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/snapshots/mySnapshot2"
                },
                "managedDisk": {
                  "id": "subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/disks/myManagedDisk2"
                },
                "storageAccountType": "Standard_LRS"
              }
            ],
            "zoneResilient": true
          },
          "provisioningState": "created"
        }
      }
security:
- name: azure_auth
  type: oauth2
  description: Azure Active Directory OAuth2 Flow
  flow: implicit
  authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
  scopes:
  - name: user_impersonation
    description: impersonate your user account
metadata:
  description: Learn more about Compute service - Update an image.
errorCodes: []
