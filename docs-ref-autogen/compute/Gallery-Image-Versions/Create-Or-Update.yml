### YamlMime:RESTOperation
uid: management.azure.com.compute.galleryimageversions.createorupdate
name: Create Or Update
service: Compute
groupName: Gallery Image Versions
apiVersion: 2020-09-30
summary: Create or update a gallery image version.
consumes:
- application/json
produces:
- application/json
paths:
- content: PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Compute/galleries/{galleryName}/images/{galleryImageName}/versions/{galleryImageVersionName}?api-version=2020-09-30
uriParameters:
- name: subscriptionId
  in: path
  isRequired: true
  description: Subscription credentials which uniquely identify Microsoft Azure subscription. The subscription ID forms part of the URI for every service call.
  types:
  - uid: string
- name: resourceGroupName
  in: path
  isRequired: true
  description: The name of the resource group.
  types:
  - uid: string
- name: galleryName
  in: path
  isRequired: true
  description: The name of the Shared Image Gallery in which the Image Definition resides.
  types:
  - uid: string
- name: galleryImageName
  in: path
  isRequired: true
  description: The name of the gallery image definition in which the Image Version is to be created.
  types:
  - uid: string
- name: galleryImageVersionName
  in: path
  isRequired: true
  description: 'The name of the gallery image version to be created. Needs to follow semantic version name pattern: The allowed characters are digit and period. Digits must be within the range of a 32-bit integer. Format: <MajorVersion>.<MinorVersion>.<Patch>'
  types:
  - uid: string
- name: api-version
  in: query
  isRequired: true
  description: Client Api Version.
  types:
  - uid: string
responses:
- name: 200 OK
  description: OK
  types:
  - uid: GalleryImageVersion
- name: 201 Created
  description: Created
  types:
  - uid: GalleryImageVersion
- name: 202 Accepted
  description: Accepted
  types:
  - uid: GalleryImageVersion
- name: Other Status Codes
  description: Error response describing why the operation failed.
  types:
  - uid: CloudError
requestBody:
- name: default
  parameters:
  - name: properties.publishingProfile
    in: body
    description: The publishing profile of a gallery image Version.
    types:
    - uid: GalleryImageVersionPublishingProfile
  - name: properties.storageProfile
    in: body
    isRequired: true
    description: This is the storage profile of a Gallery Image Version.
    types:
    - uid: GalleryImageVersionStorageProfile
  - name: location
    in: body
    isRequired: true
    description: Resource location
    types:
    - uid: string
  - name: tags
    in: body
    description: Resource tags
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
requestHeader: []
definitions:
- name: GalleryImageVersionPublishingProfile
  description: The publishing profile of a gallery image Version.
  kind: object
  properties:
  - name: targetRegions
    description: The target regions where the Image Version is going to be replicated to. This property is updatable.
    types:
    - uid: TargetRegion
      isArray: true
  - name: replicaCount
    description: The number of replicas of the Image Version to be created per region. This property would take effect for a region when regionalReplicaCount is not specified. This property is updatable.
    types:
    - uid: integer
  - name: excludeFromLatest
    description: If set to true, Virtual Machines deployed from the latest version of the Image Definition won't use this Image Version.
    types:
    - uid: boolean
  - name: publishedDate
    isReadyOnly: true
    description: The timestamp for when the gallery image version is published.
    types:
    - uid: string
  - name: endOfLifeDate
    description: The end of life date of the gallery image version. This property can be used for decommissioning purposes. This property is updatable.
    types:
    - uid: string
  - name: storageAccountType
    description: Specifies the storage account type to be used to store the image. This property is not updatable.
    types:
    - uid: StorageAccountType
- name: GalleryImageVersionStorageProfile
  description: This is the storage profile of a Gallery Image Version.
  kind: object
  properties:
  - name: source
    description: The gallery artifact version source.
    types:
    - uid: GalleryArtifactVersionSource
  - name: osDiskImage
    description: This is the OS disk image.
    types:
    - uid: GalleryOSDiskImage
  - name: dataDiskImages
    description: A list of data disk images.
    types:
    - uid: GalleryDataDiskImage
      isArray: true
- name: ReplicationStatus
  description: This is the replication status of the gallery image version.
  kind: object
  properties:
  - name: aggregatedState
    isReadyOnly: true
    description: This is the aggregated replication status based on all the regional replication status flags.
    types:
    - uid: AggregatedReplicationState
  - name: summary
    isReadyOnly: true
    description: This is a summary of replication status for each region.
    types:
    - uid: RegionalReplicationStatus
      isArray: true
- name: GalleryImageVersion
  description: Specifies information about the gallery image version that you want to create or update.
  kind: object
  properties:
  - name: properties.publishingProfile
    description: The publishing profile of a gallery image Version.
    types:
    - uid: GalleryImageVersionPublishingProfile
  - name: properties.provisioningState
    isReadyOnly: true
    description: "The current state of the gallery image version.  \nThe provisioning state, which only appears in the response."
    types:
    - uid: Creating
    - uid: Updating
    - uid: Failed
    - uid: Succeeded
    - uid: Deleting
    - uid: Migrating
    typesTitle: enum
  - name: properties.storageProfile
    description: This is the storage profile of a Gallery Image Version.
    types:
    - uid: GalleryImageVersionStorageProfile
  - name: properties.replicationStatus
    isReadyOnly: true
    description: This is the replication status of the gallery image version.
    types:
    - uid: ReplicationStatus
  - name: id
    isReadyOnly: true
    description: Resource Id
    types:
    - uid: string
  - name: name
    isReadyOnly: true
    description: Resource name
    types:
    - uid: string
  - name: type
    isReadyOnly: true
    description: Resource type
    types:
    - uid: string
  - name: location
    description: Resource location
    types:
    - uid: string
  - name: tags
    description: Resource tags
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
- name: CloudError
  description: An error response from the Compute service.
  kind: object
  properties:
  - name: error
    description: Api error.
    types:
    - uid: ApiError
- name: TargetRegion
  description: Describes the target region information.
  kind: object
  properties:
  - name: name
    description: The name of the region.
    types:
    - uid: string
  - name: regionalReplicaCount
    description: The number of replicas of the Image Version to be created per region. This property is updatable.
    types:
    - uid: integer
  - name: storageAccountType
    description: Specifies the storage account type to be used to store the image. This property is not updatable.
    types:
    - uid: StorageAccountType
  - name: encryption
    description: Optional. Allows users to provide customer managed keys for encrypting the OS and data disks in the gallery artifact.
    types:
    - uid: EncryptionImages
- name: StorageAccountType
  description: Specifies the storage account type to be used to store the image. This property is not updatable.
  kind: enum
  properties:
  - name: Standard_LRS
    types:
    - uid: string
  - name: Standard_ZRS
    types:
    - uid: string
  - name: Premium_LRS
    types:
    - uid: string
- name: GalleryArtifactVersionSource
  description: The gallery artifact version source.
  kind: object
  properties:
  - name: id
    description: The id of the gallery artifact version source. Can specify a disk uri, snapshot uri, user image or storage account resource.
    types:
    - uid: string
  - name: uri
    description: The uri of the gallery artifact version source. Currently used to specify vhd/blob source.
    types:
    - uid: string
- name: GalleryOSDiskImage
  description: This is the OS disk image.
  kind: object
  properties:
  - name: sizeInGB
    isReadyOnly: true
    description: This property indicates the size of the VHD to be created.
    types:
    - uid: integer
  - name: hostCaching
    description: The host caching of the disk. Valid values are 'None', 'ReadOnly', and 'ReadWrite'
    types:
    - uid: HostCaching
  - name: source
    description: The gallery artifact version source.
    types:
    - uid: GalleryArtifactVersionSource
- name: GalleryDataDiskImage
  description: This is the data disk image.
  kind: object
  properties:
  - name: lun
    description: This property specifies the logical unit number of the data disk. This value is used to identify data disks within the Virtual Machine and therefore must be unique for each data disk attached to the Virtual Machine.
    types:
    - uid: integer
  - name: sizeInGB
    isReadyOnly: true
    description: This property indicates the size of the VHD to be created.
    types:
    - uid: integer
  - name: hostCaching
    description: The host caching of the disk. Valid values are 'None', 'ReadOnly', and 'ReadWrite'
    types:
    - uid: HostCaching
  - name: source
    description: The gallery artifact version source.
    types:
    - uid: GalleryArtifactVersionSource
- name: AggregatedReplicationState
  description: This is the aggregated replication status based on all the regional replication status flags.
  kind: enum
  properties:
  - name: Unknown
    types:
    - uid: string
  - name: InProgress
    types:
    - uid: string
  - name: Completed
    types:
    - uid: string
  - name: Failed
    types:
    - uid: string
- name: RegionalReplicationStatus
  description: This is the regional replication status.
  kind: object
  properties:
  - name: region
    isReadyOnly: true
    description: The region to which the gallery image version is being replicated to.
    types:
    - uid: string
  - name: state
    isReadyOnly: true
    description: This is the regional replication state.
    types:
    - uid: ReplicationState
  - name: details
    isReadyOnly: true
    description: The details of the replication status.
    types:
    - uid: string
  - name: progress
    isReadyOnly: true
    description: It indicates progress of the replication job.
    types:
    - uid: integer
- name: ApiError
  description: Api error.
  kind: object
  properties:
  - name: details
    description: The Api error details
    types:
    - uid: ApiErrorBase
      isArray: true
  - name: innererror
    description: The Api inner error
    types:
    - uid: InnerError
  - name: code
    description: The error code.
    types:
    - uid: string
  - name: target
    description: The target of the particular error.
    types:
    - uid: string
  - name: message
    description: The error message.
    types:
    - uid: string
- name: EncryptionImages
  description: Optional. Allows users to provide customer managed keys for encrypting the OS and data disks in the gallery artifact.
  kind: object
  properties:
  - name: osDiskImage
    description: Contains encryption settings for an OS disk image.
    types:
    - uid: OSDiskImageEncryption
  - name: dataDiskImages
    description: A list of encryption specifications for data disk images.
    types:
    - uid: DataDiskImageEncryption
      isArray: true
- name: HostCaching
  description: The host caching of the disk. Valid values are 'None', 'ReadOnly', and 'ReadWrite'
  kind: enum
  properties:
  - name: None
    types:
    - uid: string
  - name: ReadOnly
    types:
    - uid: string
  - name: ReadWrite
    types:
    - uid: string
- name: ReplicationState
  description: This is the regional replication state.
  kind: enum
  properties:
  - name: Unknown
    types:
    - uid: string
  - name: Replicating
    types:
    - uid: string
  - name: Completed
    types:
    - uid: string
  - name: Failed
    types:
    - uid: string
- name: ApiErrorBase
  description: Api error base.
  kind: object
  properties:
  - name: code
    description: The error code.
    types:
    - uid: string
  - name: target
    description: The target of the particular error.
    types:
    - uid: string
  - name: message
    description: The error message.
    types:
    - uid: string
- name: InnerError
  description: Inner error details.
  kind: object
  properties:
  - name: exceptiontype
    description: The exception type.
    types:
    - uid: string
  - name: errordetail
    description: The internal error message or exception dump.
    types:
    - uid: string
- name: OSDiskImageEncryption
  description: Contains encryption settings for an OS disk image.
  kind: object
  properties:
  - name: diskEncryptionSetId
    description: A relative URI containing the resource ID of the disk encryption set.
    types:
    - uid: string
- name: DataDiskImageEncryption
  description: Contains encryption settings for a data disk image.
  kind: object
  properties:
  - name: lun
    description: This property specifies the logical unit number of the data disk. This value is used to identify data disks within the Virtual Machine and therefore must be unique for each data disk attached to the Virtual Machine.
    types:
    - uid: integer
  - name: diskEncryptionSetId
    description: A relative URI containing the resource ID of the disk encryption set.
    types:
    - uid: string
examples:
- name: Create or update a simple Gallery Image Version using managed image as source.
  request:
    uri: PUT https://management.azure.com/subscriptions/{subscription-id}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/galleries/myGalleryName/images/myGalleryImageName/versions/1.0.0?api-version=2020-09-30
    body: >-
      {
        "location": "West US",
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherWestUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherEastUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ]
          },
          "storageProfile": {
            "source": {
              "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/images/{imageName}"
            }
          }
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherWestUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherEastUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "source": {
              "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/images/{imageName}"
            },
            "osDiskImage": {
              "sizeInGB": 10,
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "lun": 1,
                "sizeInGB": 10,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Updating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
  - statusCode: "201"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherWestUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherEastUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "source": {
              "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/images/{imageName}"
            },
            "osDiskImage": {
              "sizeInGB": 10,
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "lun": 1,
                "sizeInGB": 10,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Creating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
  - statusCode: "202"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherWestUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherEastUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "source": {
              "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/images/{imageName}"
            },
            "osDiskImage": {
              "sizeInGB": 10,
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "lun": 1,
                "sizeInGB": 10,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Updating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
- name: Create or update a simple Gallery Image Version using snapshots as a source.
  request:
    uri: PUT https://management.azure.com/subscriptions/{subscription-id}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/galleries/myGalleryName/images/myGalleryImageName/versions/1.0.0?api-version=2020-09-30
    body: >-
      {
        "location": "West US",
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ]
          },
          "storageProfile": {
            "osDiskImage": {
              "source": {
                "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/snapshots/{osSnapshotName}"
              },
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "source": {
                  "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/disks/{dataDiskName}"
                },
                "lun": 1,
                "hostCaching": "None"
              }
            ]
          }
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "osDiskImage": {
              "source": {
                "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/snapshots/{osSnapshotName}"
              },
              "sizeInGB": 10,
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "source": {
                  "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/disks/{dataDiskName}"
                },
                "lun": 1,
                "sizeInGB": 10,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Updating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
  - statusCode: "201"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "osDiskImage": {
              "source": {
                "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/snapshots/{osSnapshotName}"
              },
              "sizeInGB": 10,
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "source": {
                  "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/disks/{dataDiskName}"
                },
                "lun": 1,
                "sizeInGB": 10,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Creating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
  - statusCode: "202"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "osDiskImage": {
              "source": {
                "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/snapshots/{osSnapshotName}"
              },
              "sizeInGB": 10,
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "source": {
                  "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/disks/{dataDiskName}"
                },
                "lun": 1,
                "sizeInGB": 10,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Updating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
- name: Create or update a simple Gallery Image Version using VM as source.
  request:
    uri: PUT https://management.azure.com/subscriptions/{subscription-id}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/galleries/myGalleryName/images/myGalleryImageName/versions/1.0.0?api-version=2020-09-30
    body: >-
      {
        "location": "West US",
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherWestUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherEastUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ]
          },
          "storageProfile": {
            "source": {
              "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/virtualMachines/{vmName}"
            }
          }
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherWestUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherEastUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "source": {
              "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/virtualMachines/{vmName}"
            },
            "osDiskImage": {
              "sizeInGB": 10,
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "lun": 1,
                "sizeInGB": 10,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Updating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
  - statusCode: "201"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherWestUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherEastUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "source": {
              "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/virtualMachines/{vmName}"
            },
            "osDiskImage": {
              "sizeInGB": 10,
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "lun": 1,
                "sizeInGB": 10,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Creating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
  - statusCode: "202"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherWestUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherEastUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "source": {
              "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/virtualMachines/{vmName}"
            },
            "osDiskImage": {
              "sizeInGB": 10,
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "lun": 1,
                "sizeInGB": 10,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Updating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
- name: Create or update a simple Gallery Image Version using shared image as source.
  request:
    uri: PUT https://management.azure.com/subscriptions/{subscription-id}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/galleries/myGalleryName/images/myGalleryImageName/versions/1.0.0?api-version=2020-09-30
    body: >-
      {
        "location": "West US",
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherWestUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherEastUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ]
          },
          "storageProfile": {
            "source": {
              "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/galleries/{galleryName}/images/{imageDefinitionName}/versions/{versionName}"
            }
          }
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherWestUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherEastUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "source": {
              "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/galleries/{galleryName}/images/{imageDefinitionName}/versions/{versionName}"
            },
            "osDiskImage": {
              "sizeInGB": 10,
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "lun": 1,
                "sizeInGB": 10,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Updating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
  - statusCode: "201"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherWestUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherEastUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "source": {
              "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/galleries/{galleryName}/images/{imageDefinitionName}/versions/{versionName}"
            },
            "osDiskImage": {
              "sizeInGB": 10,
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "lun": 1,
                "sizeInGB": 10,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Creating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
  - statusCode: "202"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherWestUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 0,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherEastUSDiskEncryptionSet"
                    },
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "source": {
              "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/galleries/{galleryName}/images/{imageDefinitionName}/versions/{versionName}"
            },
            "osDiskImage": {
              "sizeInGB": 10,
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "lun": 1,
                "sizeInGB": 10,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Updating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
- name: Create or update a simple Gallery Image Version using mix of disks and snapshots as a source.
  request:
    uri: PUT https://management.azure.com/subscriptions/{subscription-id}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/galleries/myGalleryName/images/myGalleryImageName/versions/1.0.0?api-version=2020-09-30
    body: >-
      {
        "location": "West US",
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ]
          },
          "storageProfile": {
            "osDiskImage": {
              "source": {
                "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/snapshots/{osSnapshotName}"
              },
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "source": {
                  "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/disks/{dataDiskName}"
                },
                "lun": 1,
                "hostCaching": "None"
              }
            ]
          }
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "osDiskImage": {
              "source": {
                "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/snapshots/{osSnapshotName}"
              },
              "sizeInGB": 10,
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "source": {
                  "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/disks/{dataDiskName}"
                },
                "lun": 1,
                "sizeInGB": 10,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Updating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
  - statusCode: "201"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "osDiskImage": {
              "source": {
                "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/snapshots/{osSnapshotName}"
              },
              "sizeInGB": 10,
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "source": {
                  "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/disks/{dataDiskName}"
                },
                "lun": 1,
                "sizeInGB": 10,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Creating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
  - statusCode: "202"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myWestUSDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myEastUSDiskEncryptionSet"
                    }
                  ]
                }
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "osDiskImage": {
              "source": {
                "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/snapshots/{osSnapshotName}"
              },
              "sizeInGB": 10,
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "source": {
                  "id": "/subscriptions/{subscriptionId}/resourceGroups/{resourceGroup}/providers/Microsoft.Compute/disks/{dataDiskName}"
                },
                "lun": 1,
                "sizeInGB": 10,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Updating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
- name: Create or update a simple Gallery Image Version using vhd as a source.
  request:
    uri: PUT https://management.azure.com/subscriptions/{subscription-id}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/galleries/myGalleryName/images/myGalleryImageName/versions/1.0.0?api-version=2020-09-30
    body: >-
      {
        "location": "West US",
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherDiskEncryptionSet",
                      "lun": 1
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS"
              }
            ]
          },
          "storageProfile": {
            "osDiskImage": {
              "source": {
                "id": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Storage/storageAccounts/{storageAccount}",
                "uri": "https://gallerysourcencus.blob.core.windows.net/myvhds/Windows-Server-2012-R2-20171216-en.us-128GB.vhd"
              },
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "source": {
                  "id": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Storage/storageAccounts/{storageAccount}",
                  "uri": "https://gallerysourcencus.blob.core.windows.net/myvhds/Windows-Server-2012-R2-20171216-en.us-128GB.vhd"
                },
                "lun": 1,
                "hostCaching": "None"
              }
            ]
          }
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS"
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "osDiskImage": {
              "source": {
                "id": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Storage/storageAccounts/{storageAccount}",
                "uri": "https://gallerysourcencus.blob.core.windows.net/myvhds/Windows-Server-2012-R2-20171216-en.us-128GB.vhd"
              },
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "source": {
                  "id": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Storage/storageAccounts/{storageAccount}",
                  "uri": "https://gallerysourcencus.blob.core.windows.net/myvhds/Windows-Server-2012-R2-20171216-en.us-128GB.vhd"
                },
                "lun": 1,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Updating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
  - statusCode: "201"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS"
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "osDiskImage": {
              "source": {
                "id": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Storage/storageAccounts/{storageAccount}",
                "uri": "https://gallerysourcencus.blob.core.windows.net/myvhds/Windows-Server-2012-R2-20171216-en.us-128GB.vhd"
              },
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "source": {
                  "id": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Storage/storageAccounts/{storageAccount}",
                  "uri": "https://gallerysourcencus.blob.core.windows.net/myvhds/Windows-Server-2012-R2-20171216-en.us-128GB.vhd"
                },
                "lun": 1,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Creating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
  - statusCode: "202"
    body: >-
      {
        "properties": {
          "publishingProfile": {
            "targetRegions": [
              {
                "name": "West US",
                "regionalReplicaCount": 1,
                "storageAccountType": "Standard_LRS",
                "encryption": {
                  "osDiskImage": {
                    "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myDiskEncryptionSet"
                  },
                  "dataDiskImages": [
                    {
                      "lun": 1,
                      "diskEncryptionSetId": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Compute/diskEncryptionSet/myOtherDiskEncryptionSet"
                    }
                  ]
                }
              },
              {
                "name": "East US",
                "regionalReplicaCount": 2,
                "storageAccountType": "Standard_ZRS"
              }
            ],
            "replicaCount": 1,
            "publishedDate": "2018-01-01T00:00:00Z",
            "storageAccountType": "Standard_LRS"
          },
          "storageProfile": {
            "osDiskImage": {
              "source": {
                "id": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Storage/storageAccounts/{storageAccount}",
                "uri": "https://gallerysourcencus.blob.core.windows.net/myvhds/Windows-Server-2012-R2-20171216-en.us-128GB.vhd"
              },
              "hostCaching": "ReadOnly"
            },
            "dataDiskImages": [
              {
                "source": {
                  "id": "/subscriptions/{subscriptionId}/resourceGroups/myResourceGroup/providers/Microsoft.Storage/storageAccounts/{storageAccount}",
                  "uri": "https://gallerysourcencus.blob.core.windows.net/myvhds/Windows-Server-2012-R2-20171216-en.us-128GB.vhd"
                },
                "lun": 1,
                "hostCaching": "None"
              }
            ]
          },
          "provisioningState": "Updating"
        },
        "location": "West US",
        "name": "1.0.0"
      }
security:
- name: azure_auth
  type: oauth2
  description: Azure Active Directory OAuth2 Flow
  flow: implicit
  authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
  scopes:
  - name: user_impersonation
    description: impersonate your user account
metadata:
  description: Learn more about Compute service - Create or update a gallery image version.
errorCodes: []
