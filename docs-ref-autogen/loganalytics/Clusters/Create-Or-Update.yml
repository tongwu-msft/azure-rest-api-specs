### YamlMime:RESTOperation
uid: management.azure.com.loganalytics.clusters.createorupdate
name: Create Or Update
service: Log Analytics
groupName: Clusters
apiVersion: 2021-06-01
summary: Create or update a Log Analytics cluster.
consumes:
- application/json
produces:
- application/json
paths:
- content: PUT https://management.azure.com/subscriptions/{subscriptionId}/resourcegroups/{resourceGroupName}/providers/Microsoft.OperationalInsights/clusters/{clusterName}?api-version=2021-06-01
uriParameters:
- name: subscriptionId
  in: path
  isRequired: true
  description: The ID of the target subscription.
  types:
  - uid: string
- name: resourceGroupName
  in: path
  isRequired: true
  description: The name of the resource group. The name is case insensitive.
  types:
  - uid: string
- name: clusterName
  in: path
  isRequired: true
  description: The name of the Log Analytics cluster.
  types:
  - uid: string
  pattern: ^[A-Za-z0-9][A-Za-z0-9-]+[A-Za-z0-9]$
- name: api-version
  in: query
  isRequired: true
  description: The API version to use for this operation.
  types:
  - uid: string
responses:
- name: 202 Accepted
  description: Accepted response definition.
- name: 200 OK
  description: OK response definition.
  types:
  - uid: Cluster
- name: 201 Created
  description: Created response definition.
  types:
  - uid: Cluster
- name: Other Status Codes
  description: Error response describing why the operation failed.
  types:
  - uid: ErrorResponse
requestBody:
- name: default
  parameters:
  - name: identity
    in: body
    description: The identity of the resource.
    types:
    - uid: Identity
  - name: sku
    in: body
    description: The sku properties.
    types:
    - uid: ClusterSku
  - name: properties.isDoubleEncryptionEnabled
    in: body
    description: Configures whether cluster will use double encryption. This Property can not be modified after cluster creation. Default value is 'true'
    types:
    - uid: boolean
  - name: properties.isAvailabilityZonesEnabled
    in: body
    description: Sets whether the cluster will support availability zones. This can be set as true only in regions where Azure Data Explorer support Availability Zones. This Property can not be modified after cluster creation. Default value is 'true' if region supports Availability Zones.
    types:
    - uid: boolean
  - name: properties.billingType
    in: body
    description: The cluster's billing type.
    types:
    - uid: BillingType
  - name: properties.keyVaultProperties
    in: body
    description: The associated key properties.
    types:
    - uid: keyVaultProperties
  - name: properties.associatedWorkspaces
    in: body
    description: The list of Log Analytics workspaces associated with the cluster
    types:
    - uid: AssociatedWorkspace
      isArray: true
  - name: properties.capacityReservationProperties
    in: body
    description: Additional properties for capacity reservation
    types:
    - uid: CapacityReservationProperties
  - name: tags
    in: body
    description: Resource tags.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
  - name: location
    in: body
    isRequired: true
    description: The geo-location where the resource lives
    types:
    - uid: string
requestHeader: []
definitions:
- name: Identity
  description: Identity for the resource.
  kind: object
  properties:
  - name: principalId
    isReadyOnly: true
    description: The principal ID of resource identity.
    types:
    - uid: string
  - name: tenantId
    isReadyOnly: true
    description: The tenant ID of resource.
    types:
    - uid: string
  - name: type
    description: Type of managed service identity.
    types:
    - uid: IdentityType
  - name: userAssignedIdentities
    description: "The list of user identities associated with the resource. The user identity dictionary key references will be ARM resource ids in the form: '/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.ManagedIdentity/userAssignedIdentities/{identityName}'."
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: UserIdentityProperties
- name: ClusterSku
  description: The cluster sku definition.
  kind: object
  properties:
  - name: capacity
    description: The capacity value
    types:
    - uid: Capacity
  - name: name
    description: The name of the SKU.
    types:
    - uid: ClusterSkuNameEnum
- name: keyVaultProperties
  description: The key vault properties.
  kind: object
  properties:
  - name: keyVaultUri
    description: The Key Vault uri which holds they key associated with the Log Analytics cluster.
    types:
    - uid: string
  - name: keyName
    description: The name of the key associated with the Log Analytics cluster.
    types:
    - uid: string
  - name: keyVersion
    description: The version of the key associated with the Log Analytics cluster.
    types:
    - uid: string
  - name: keyRsaSize
    description: Selected key minimum required size.
    types:
    - uid: integer
- name: AssociatedWorkspace
  description: The list of Log Analytics workspaces associated with the cluster.
  kind: object
  properties:
  - name: workspaceId
    isReadyOnly: true
    description: The id of the assigned workspace.
    types:
    - uid: string
  - name: workspaceName
    isReadyOnly: true
    description: The name id the assigned workspace.
    types:
    - uid: string
  - name: resourceId
    isReadyOnly: true
    description: The ResourceId id the assigned workspace.
    types:
    - uid: string
  - name: associateDate
    isReadyOnly: true
    description: The time of workspace association.
    types:
    - uid: string
- name: CapacityReservationProperties
  description: The Capacity Reservation properties.
  kind: object
  properties:
  - name: lastSkuUpdate
    isReadyOnly: true
    description: The last time Sku was updated.
    types:
    - uid: string
  - name: minCapacity
    isReadyOnly: true
    description: Minimum CapacityReservation value in GB.
    types:
    - uid: integer
- name: Cluster
  description: The top level Log Analytics cluster resource container.
  kind: object
  properties:
  - name: identity
    description: The identity of the resource.
    types:
    - uid: Identity
  - name: sku
    description: The sku properties.
    types:
    - uid: ClusterSku
  - name: properties.clusterId
    isReadyOnly: true
    description: The ID associated with the cluster.
    types:
    - uid: string
  - name: properties.provisioningState
    isReadyOnly: true
    description: The provisioning state of the cluster.
    types:
    - uid: ClusterEntityStatus
  - name: properties.isDoubleEncryptionEnabled
    description: Configures whether cluster will use double encryption. This Property can not be modified after cluster creation. Default value is 'true'
    types:
    - uid: boolean
  - name: properties.isAvailabilityZonesEnabled
    description: Sets whether the cluster will support availability zones. This can be set as true only in regions where Azure Data Explorer support Availability Zones. This Property can not be modified after cluster creation. Default value is 'true' if region supports Availability Zones.
    types:
    - uid: boolean
  - name: properties.billingType
    description: The cluster's billing type.
    types:
    - uid: BillingType
  - name: properties.keyVaultProperties
    description: The associated key properties.
    types:
    - uid: keyVaultProperties
  - name: properties.lastModifiedDate
    isReadyOnly: true
    description: The last time the cluster was updated.
    types:
    - uid: string
  - name: properties.createdDate
    isReadyOnly: true
    description: The cluster creation time
    types:
    - uid: string
  - name: properties.associatedWorkspaces
    description: The list of Log Analytics workspaces associated with the cluster
    types:
    - uid: AssociatedWorkspace
      isArray: true
  - name: properties.capacityReservationProperties
    description: Additional properties for capacity reservation
    types:
    - uid: CapacityReservationProperties
  - name: tags
    description: Resource tags.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
  - name: location
    description: The geo-location where the resource lives
    types:
    - uid: string
  - name: id
    isReadyOnly: true
    description: Fully qualified resource ID for the resource. Ex - /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/{resourceProviderNamespace}/{resourceType}/{resourceName}
    types:
    - uid: string
  - name: name
    isReadyOnly: true
    description: The name of the resource
    types:
    - uid: string
  - name: type
    isReadyOnly: true
    description: The type of the resource. E.g. "Microsoft.Compute/virtualMachines" or "Microsoft.Storage/storageAccounts"
    types:
    - uid: string
- name: ErrorResponse
  description: Error response
  kind: object
  properties:
  - name: error
    description: The error object.
    types:
    - uid: ErrorDetail
- name: IdentityType
  description: Type of managed service identity.
  kind: enum
  properties:
  - name: SystemAssigned
    types:
    - uid: string
  - name: UserAssigned
    types:
    - uid: string
  - name: None
    types:
    - uid: string
- name: UserIdentityProperties
  description: User assigned identity properties.
  kind: object
  properties:
  - name: principalId
    isReadyOnly: true
    description: The principal id of user assigned identity.
    types:
    - uid: string
  - name: clientId
    isReadyOnly: true
    description: The client id of user assigned identity.
    types:
    - uid: string
- name: Capacity
  description: The capacity value
  kind: enum
  properties:
  - name: "500"
    types:
    - uid: Integer
  - name: "1000"
    types:
    - uid: Integer
  - name: "2000"
    types:
    - uid: Integer
  - name: "5000"
    types:
    - uid: Integer
- name: ClusterSkuNameEnum
  description: The name of the SKU.
  kind: enum
  properties:
  - name: CapacityReservation
    types:
    - uid: string
- name: ClusterEntityStatus
  description: The provisioning state of the cluster.
  kind: enum
  properties:
  - name: Creating
    types:
    - uid: string
  - name: Succeeded
    types:
    - uid: string
  - name: Failed
    types:
    - uid: string
  - name: Canceled
    types:
    - uid: string
  - name: Deleting
    types:
    - uid: string
  - name: ProvisioningAccount
    types:
    - uid: string
  - name: Updating
    types:
    - uid: string
- name: BillingType
  description: The cluster's billing type.
  kind: enum
  properties:
  - name: Cluster
    types:
    - uid: string
  - name: Workspaces
    types:
    - uid: string
- name: ErrorDetail
  description: The error detail.
  kind: object
  properties:
  - name: code
    isReadyOnly: true
    description: The error code.
    types:
    - uid: string
  - name: message
    isReadyOnly: true
    description: The error message.
    types:
    - uid: string
  - name: target
    isReadyOnly: true
    description: The error target.
    types:
    - uid: string
  - name: details
    isReadyOnly: true
    description: The error details.
    types:
    - uid: ErrorDetail
      isArray: true
  - name: additionalInfo
    isReadyOnly: true
    description: The error additional info.
    types:
    - uid: ErrorAdditionalInfo
      isArray: true
- name: ErrorAdditionalInfo
  description: The resource management error additional info.
  kind: object
  properties:
  - name: type
    isReadyOnly: true
    description: The additional info type.
    types:
    - uid: string
  - name: info
    isReadyOnly: true
    description: The additional info.
    types:
    - uid: object
examples:
- name: ClustersCreate
  request:
    uri: PUT https://management.azure.com/subscriptions/00000000-0000-0000-0000-00000000000/resourcegroups/oiautorest6685/providers/Microsoft.OperationalInsights/clusters/oiautorest6685?api-version=2021-06-01
    body: >-
      {
        "sku": {
          "name": "CapacityReservation",
          "capacity": 1000
        },
        "location": "australiasoutheast",
        "tags": {
          "tag1": "val1"
        }
      }
    codeTab: |+
      # [HTTP](#tab/HTTP)
      ``` http
      PUT https://management.azure.com/subscriptions/00000000-0000-0000-0000-00000000000/resourcegroups/oiautorest6685/providers/Microsoft.OperationalInsights/clusters/oiautorest6685?api-version=2021-06-01

      {
        "sku": {
          "name": "CapacityReservation",
          "capacity": 1000
        },
        "location": "australiasoutheast",
        "tags": {
          "tag1": "val1"
        }
      }

      ```

      # [Java](#tab/Java)
      ``` java
      import com.azure.resourcemanager.loganalytics.models.Capacity;
      import com.azure.resourcemanager.loganalytics.models.ClusterSku;
      import com.azure.resourcemanager.loganalytics.models.ClusterSkuNameEnum;
      import java.util.HashMap;
      import java.util.Map;

      /** Samples for Clusters CreateOrUpdate. */
      public final class Main {
          /*
           * x-ms-original-file: specification/operationalinsights/resource-manager/Microsoft.OperationalInsights/stable/2021-06-01/examples/ClustersCreate.json
           */
          /**
           * Sample code: ClustersCreate.
           *
           * @param manager Entry point to LogAnalyticsManager.
           */
          public static void clustersCreate(com.azure.resourcemanager.loganalytics.LogAnalyticsManager manager) {
              manager
                  .clusters()
                  .define("oiautorest6685")
                  .withRegion("australiasoutheast")
                  .withExistingResourceGroup("oiautorest6685")
                  .withTags(mapOf("tag1", "val1"))
                  .withSku(
                      new ClusterSku()
                          .withCapacity(Capacity.ONE_ZERO_ZERO_ZERO)
                          .withName(ClusterSkuNameEnum.CAPACITY_RESERVATION))
                  .create();
          }

          @SuppressWarnings("unchecked")
          private static <T> Map<String, T> mapOf(Object... inputs) {
              Map<String, T> map = new HashMap<>();
              for (int i = 0; i < inputs.length; i += 2) {
                  String key = (String) inputs[i];
                  T value = (T) inputs[i + 1];
                  map.put(key, value);
              }
              return map;
          }
      }

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-java/blob/azure-resourcemanager-loganalytics_1.0.0-beta.3/sdk/loganalytics/azure-resourcemanager-loganalytics/README.md) on how to add the SDK to your project and authenticate.
      # [Go](#tab/Go)
      ``` go
      package armoperationalinsights_test

      import (
      	"context"
      	"log"

      	"github.com/Azure/azure-sdk-for-go/sdk/azcore/to"
      	"github.com/Azure/azure-sdk-for-go/sdk/azidentity"
      	"github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/operationalinsights/armoperationalinsights/v2"
      )

      // Generated from example definition: https://github.com/Azure/azure-rest-api-specs/tree/main/specification/operationalinsights/resource-manager/Microsoft.OperationalInsights/stable/2021-06-01/examples/ClustersCreate.json
      func ExampleClustersClient_BeginCreateOrUpdate() {
      	cred, err := azidentity.NewDefaultAzureCredential(nil)
      	if err != nil {
      		log.Fatalf("failed to obtain a credential: %v", err)
      	}
      	ctx := context.Background()
      	client, err := armoperationalinsights.NewClustersClient("00000000-0000-0000-0000-00000000000", cred, nil)
      	if err != nil {
      		log.Fatalf("failed to create client: %v", err)
      	}
      	poller, err := client.BeginCreateOrUpdate(ctx,
      		"oiautorest6685",
      		"oiautorest6685",
      		armoperationalinsights.Cluster{
      			Location: to.Ptr("australiasoutheast"),
      			Tags: map[string]*string{
      				"tag1": to.Ptr("val1"),
      			},
      			SKU: &armoperationalinsights.ClusterSKU{
      				Name:     to.Ptr(armoperationalinsights.ClusterSKUNameEnumCapacityReservation),
      				Capacity: to.Ptr(armoperationalinsights.CapacityTenHundred),
      			},
      		},
      		nil)
      	if err != nil {
      		log.Fatalf("failed to finish the request: %v", err)
      	}
      	res, err := poller.PollUntilDone(ctx, nil)
      	if err != nil {
      		log.Fatalf("failed to pull the result: %v", err)
      	}
      	// TODO: use response item
      	_ = res
      }

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-go/blob/sdk%2Fresourcemanager%2Foperationalinsights%2Farmoperationalinsights%2Fv2.0.0-beta.2/sdk/resourcemanager/operationalinsights/armoperationalinsights/README.md) on how to add the SDK to your project and authenticate.
      # [JavsScirpt](#tab/JavsScirpt)
      ``` js
      const { OperationalInsightsManagementClient } = require("@azure/arm-operationalinsights");
      const { DefaultAzureCredential } = require("@azure/identity");

      /**
       * This sample demonstrates how to Create or update a Log Analytics cluster.
       *
       * @summary Create or update a Log Analytics cluster.
       * x-ms-original-file: specification/operationalinsights/resource-manager/Microsoft.OperationalInsights/stable/2021-06-01/examples/ClustersCreate.json
       */
      async function clustersCreate() {
        const subscriptionId = "00000000-0000-0000-0000-00000000000";
        const resourceGroupName = "oiautorest6685";
        const clusterName = "oiautorest6685";
        const parameters = {
          location: "australiasoutheast",
          sku: { name: "CapacityReservation", capacity: 1000 },
          tags: { tag1: "val1" },
        };
        const credential = new DefaultAzureCredential();
        const client = new OperationalInsightsManagementClient(credential, subscriptionId);
        const result = await client.clusters.beginCreateOrUpdateAndWait(
          resourceGroupName,
          clusterName,
          parameters
        );
        console.log(result);
      }

      clustersCreate().catch(console.error);

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-js/blob/%40azure%2Farm-operationalinsights_8.0.1/sdk/operationalinsights/arm-operationalinsights/README.md) on how to add the SDK to your project and authenticate.
  responses:
  - statusCode: "202"
  - statusCode: "200"
    body: >-
      {
        "properties": {
          "keyVaultProperties": {
            "keyVaultUri": "https://aztest2170.vault.azure.net",
            "keyName": "aztest2170cert",
            "keyVersion": "654ft6c4e63845cbb50fd6fg51540429"
          },
          "provisioningState": "ProvisioningAccount",
          "clusterId": "1c3f2afc-9ec1-4e74-bfe8-022b83bcd7b1",
          "billingType": "Cluster",
          "lastModifiedDate": "Sun, 04 Jan 2020 17:10:56 GMT",
          "createdDate": "Mon, 13 Jan 2020 14:40:33 GMT",
          "associatedWorkspaces": [],
          "capacityReservationProperties": {
            "lastSkuUpdate": "Thu, 01 Jan 1970 00:00:00 GMT",
            "minCapacity": 500
          }
        },
        "id": "/subscriptions/594038b5-1093-476e-a366-482775671c11/resourcegroups/oiautorest6685/providers/microsoft.operationalinsights/clusters/oiautorest6685",
        "identity": {
          "principalId": "356d057d-cba5-44dd-8a30-b2e547bc416b",
          "tenantId": "72f988bf-86f1-41af-91ab-2d7cd011db47",
          "type": "SystemAssigned"
        },
        "sku": {
          "name": "CapacityReservation",
          "capacity": 1000
        },
        "name": "oiautorest6685",
        "type": "Microsoft.OperationalInsights/clusters",
        "location": "australiasoutheast"
      }
  - statusCode: "201"
    body: >-
      {
        "properties": {
          "keyVaultProperties": {
            "keyVaultUri": "https://aztest2170.vault.azure.net",
            "keyName": "aztest2170cert",
            "keyVersion": "654ft6c4e63845cbb50fd6fg51540429"
          },
          "provisioningState": "ProvisioningAccount",
          "clusterId": "1c3f2afc-9ec1-4e74-bfe8-022b83bcd7b1",
          "billingType": "Cluster",
          "lastModifiedDate": "Sun, 04 Jan 2020 17:10:56 GMT",
          "createdDate": "Mon, 13 Jan 2020 14:40:33 GMT",
          "associatedWorkspaces": [],
          "capacityReservationProperties": {
            "lastSkuUpdate": "Thu, 01 Jan 1970 00:00:00 GMT",
            "minCapacity": 500
          }
        },
        "id": "/subscriptions/594038b5-1093-476e-a366-482775671c11/resourcegroups/oiautorest6685/providers/microsoft.operationalinsights/clusters/oiautorest6685",
        "identity": {
          "principalId": "356d057d-cba5-44dd-8a30-b2e547bc416b",
          "tenantId": "72f988bf-86f1-41af-91ab-2d7cd011db47",
          "type": "SystemAssigned"
        },
        "sku": {
          "name": "CapacityReservation",
          "capacity": 1000
        },
        "name": "oiautorest6685",
        "type": "Microsoft.OperationalInsights/clusters",
        "location": "australiasoutheast"
      }
security:
- name: azure_auth
  type: oauth2
  description: Azure Active Directory OAuth2 Flow
  flow: implicit
  authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
  scopes:
  - name: user_impersonation
    description: impersonate your user account
metadata:
  description: Learn more about Log Analytics service - Create or update a Log Analytics cluster.
errorCodes: []
