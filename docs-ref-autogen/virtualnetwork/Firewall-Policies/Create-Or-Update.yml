### YamlMime:RESTOperation
uid: management.azure.com.virtualnetwork.firewallpolicies.createorupdate
name: Create Or Update
service: Virtual Networks
groupName: Firewall Policies
apiVersion: 2021-08-01
summary: Creates or updates the specified Firewall Policy.
consumes:
- application/json
produces:
- application/json
paths:
- content: PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/firewallPolicies/{firewallPolicyName}?api-version=2021-08-01
uriParameters:
- name: subscriptionId
  in: path
  isRequired: true
  description: The subscription credentials which uniquely identify the Microsoft Azure subscription. The subscription ID forms part of the URI for every service call.
  types:
  - uid: string
- name: resourceGroupName
  in: path
  isRequired: true
  description: The name of the resource group.
  types:
  - uid: string
- name: firewallPolicyName
  in: path
  isRequired: true
  description: The name of the Firewall Policy.
  types:
  - uid: string
- name: api-version
  in: query
  isRequired: true
  description: Client API version.
  types:
  - uid: string
responses:
- name: 201 Created
  description: Request received successfully. The operation returns the resulting FirewallPolicy resource.
  types:
  - uid: FirewallPolicy
- name: 200 OK
  description: Request successful. The operation returns the resulting FirewallPolicy resource.
  types:
  - uid: FirewallPolicy
- name: Other Status Codes
  description: Error response describing why the operation failed.
  types:
  - uid: CloudError
requestBody:
- name: default
  parameters:
  - name: identity
    in: body
    description: The identity of the firewall policy.
    types:
    - uid: ManagedServiceIdentity
  - name: properties.basePolicy
    in: body
    description: The parent firewall policy from which rules are inherited.
    types:
    - uid: SubResource
  - name: properties.threatIntelMode
    in: body
    description: The operation mode for Threat Intelligence.
    types:
    - uid: AzureFirewallThreatIntelMode
  - name: properties.threatIntelWhitelist
    in: body
    description: ThreatIntel Whitelist for Firewall Policy.
    types:
    - uid: FirewallPolicyThreatIntelWhitelist
  - name: properties.insights
    in: body
    description: Insights on Firewall Policy.
    types:
    - uid: FirewallPolicyInsights
  - name: properties.snat
    in: body
    description: The private IP addresses/IP ranges to which traffic will not be SNAT.
    types:
    - uid: FirewallPolicySNAT
  - name: properties.sql
    in: body
    description: SQL Settings definition.
    types:
    - uid: FirewallPolicySQL
  - name: properties.dnsSettings
    in: body
    description: DNS Proxy Settings definition.
    types:
    - uid: DnsSettings
  - name: properties.explicitProxySettings
    in: body
    description: Explicit Proxy Settings definition.
    types:
    - uid: ExplicitProxySettings
  - name: properties.intrusionDetection
    in: body
    description: The configuration for Intrusion detection.
    types:
    - uid: FirewallPolicyIntrusionDetection
  - name: properties.transportSecurity
    in: body
    description: TLS Configuration definition.
    types:
    - uid: FirewallPolicyTransportSecurity
  - name: properties.sku
    in: body
    description: The Firewall Policy SKU.
    types:
    - uid: FirewallPolicySku
  - name: id
    in: body
    description: Resource ID.
    types:
    - uid: string
  - name: location
    in: body
    description: Resource location.
    types:
    - uid: string
  - name: tags
    in: body
    description: Resource tags.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
requestHeader: []
definitions:
- name: ManagedServiceIdentity
  description: Identity for the resource.
  kind: object
  properties:
  - name: principalId
    isReadyOnly: true
    description: The principal id of the system assigned identity. This property will only be provided for a system assigned identity.
    types:
    - uid: string
  - name: tenantId
    isReadyOnly: true
    description: The tenant id of the system assigned identity. This property will only be provided for a system assigned identity.
    types:
    - uid: string
  - name: type
    description: The type of identity used for the resource. The type 'SystemAssigned, UserAssigned' includes both an implicitly created identity and a set of user assigned identities. The type 'None' will remove any identities from the virtual machine.
    types:
    - uid: ResourceIdentityType
  - name: userAssignedIdentities
    description: "The list of user identities associated with resource. The user identity dictionary key references will be ARM resource ids in the form: '/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.ManagedIdentity/userAssignedIdentities/{identityName}'."
    types:
    - uid: UserAssignedIdentities
- name: SubResource
  description: Reference to another subresource.
  kind: object
  properties:
  - name: id
    description: Resource ID.
    types:
    - uid: string
- name: FirewallPolicyThreatIntelWhitelist
  description: ThreatIntel Whitelist for Firewall Policy.
  kind: object
  properties:
  - name: ipAddresses
    description: List of IP addresses for the ThreatIntel Whitelist.
    types:
    - uid: string
      isArray: true
  - name: fqdns
    description: List of FQDNs for the ThreatIntel Whitelist.
    types:
    - uid: string
      isArray: true
- name: FirewallPolicyInsights
  description: Firewall Policy Insights.
  kind: object
  properties:
  - name: isEnabled
    description: A flag to indicate if the insights are enabled on the policy.
    types:
    - uid: boolean
  - name: retentionDays
    description: Number of days the insights should be enabled on the policy.
    types:
    - uid: integer
  - name: logAnalyticsResources
    description: Workspaces needed to configure the Firewall Policy Insights.
    types:
    - uid: FirewallPolicyLogAnalyticsResources
- name: FirewallPolicySNAT
  description: The private IP addresses/IP ranges to which traffic will not be SNAT.
  kind: object
  properties:
  - name: privateRanges
    description: List of private IP addresses/IP address ranges to not be SNAT.
    types:
    - uid: string
      isArray: true
- name: FirewallPolicySQL
  description: SQL Settings in Firewall Policy.
  kind: object
  properties:
  - name: allowSqlRedirect
    description: A flag to indicate if SQL Redirect traffic filtering is enabled. Turning on the flag requires no rule using port 11000-11999.
    types:
    - uid: boolean
- name: DnsSettings
  description: DNS Proxy Settings in Firewall Policy.
  kind: object
  properties:
  - name: servers
    description: List of Custom DNS Servers.
    types:
    - uid: string
      isArray: true
  - name: enableProxy
    description: Enable DNS Proxy on Firewalls attached to the Firewall Policy.
    types:
    - uid: boolean
  - name: requireProxyForNetworkRules
    description: FQDNs in Network Rules are supported when set to true.
    types:
    - uid: boolean
- name: ExplicitProxySettings
  description: Explicit Proxy Settings in Firewall Policy.
  kind: object
  properties:
  - name: enableExplicitProxy
    description: When set to true, explicit proxy mode is enabled.
    types:
    - uid: boolean
  - name: httpPort
    description: Port number for explicit proxy http protocol, cannot be greater than 64000.
    types:
    - uid: integer
  - name: httpsPort
    description: Port number for explicit proxy https protocol, cannot be greater than 64000.
    types:
    - uid: integer
  - name: pacFilePort
    description: Port number for firewall to serve PAC file.
    types:
    - uid: integer
  - name: pacFile
    description: SAS URL for PAC file.
    types:
    - uid: string
- name: FirewallPolicyIntrusionDetection
  description: Configuration for intrusion detection mode and rules.
  kind: object
  properties:
  - name: mode
    description: Intrusion detection general state.
    types:
    - uid: FirewallPolicyIntrusionDetectionStateType
  - name: configuration
    description: Intrusion detection configuration properties.
    types:
    - uid: FirewallPolicyIntrusionDetectionConfiguration
- name: FirewallPolicyTransportSecurity
  description: Configuration needed to perform TLS termination & initiation.
  kind: object
  properties:
  - name: certificateAuthority
    description: The CA used for intermediate CA generation.
    types:
    - uid: FirewallPolicyCertificateAuthority
- name: FirewallPolicySku
  description: SKU of Firewall policy.
  kind: object
  properties:
  - name: tier
    description: Tier of Firewall Policy.
    types:
    - uid: FirewallPolicySkuTier
- name: FirewallPolicy
  description: FirewallPolicy Resource.
  kind: object
  properties:
  - name: etag
    isReadyOnly: true
    description: A unique read-only string that changes whenever the resource is updated.
    types:
    - uid: string
  - name: identity
    description: The identity of the firewall policy.
    types:
    - uid: ManagedServiceIdentity
  - name: properties.ruleCollectionGroups
    isReadyOnly: true
    description: List of references to FirewallPolicyRuleCollectionGroups.
    types:
    - uid: SubResource
      isArray: true
  - name: properties.provisioningState
    isReadyOnly: true
    description: The provisioning state of the firewall policy resource.
    types:
    - uid: ProvisioningState
  - name: properties.basePolicy
    description: The parent firewall policy from which rules are inherited.
    types:
    - uid: SubResource
  - name: properties.firewalls
    isReadyOnly: true
    description: List of references to Azure Firewalls that this Firewall Policy is associated with.
    types:
    - uid: SubResource
      isArray: true
  - name: properties.childPolicies
    isReadyOnly: true
    description: List of references to Child Firewall Policies.
    types:
    - uid: SubResource
      isArray: true
  - name: properties.threatIntelMode
    description: The operation mode for Threat Intelligence.
    types:
    - uid: AzureFirewallThreatIntelMode
  - name: properties.threatIntelWhitelist
    description: ThreatIntel Whitelist for Firewall Policy.
    types:
    - uid: FirewallPolicyThreatIntelWhitelist
  - name: properties.insights
    description: Insights on Firewall Policy.
    types:
    - uid: FirewallPolicyInsights
  - name: properties.snat
    description: The private IP addresses/IP ranges to which traffic will not be SNAT.
    types:
    - uid: FirewallPolicySNAT
  - name: properties.sql
    description: SQL Settings definition.
    types:
    - uid: FirewallPolicySQL
  - name: properties.dnsSettings
    description: DNS Proxy Settings definition.
    types:
    - uid: DnsSettings
  - name: properties.explicitProxySettings
    description: Explicit Proxy Settings definition.
    types:
    - uid: ExplicitProxySettings
  - name: properties.intrusionDetection
    description: The configuration for Intrusion detection.
    types:
    - uid: FirewallPolicyIntrusionDetection
  - name: properties.transportSecurity
    description: TLS Configuration definition.
    types:
    - uid: FirewallPolicyTransportSecurity
  - name: properties.sku
    description: The Firewall Policy SKU.
    types:
    - uid: FirewallPolicySku
  - name: id
    description: Resource ID.
    types:
    - uid: string
  - name: name
    isReadyOnly: true
    description: Resource name.
    types:
    - uid: string
  - name: type
    isReadyOnly: true
    description: Resource type.
    types:
    - uid: string
  - name: location
    description: Resource location.
    types:
    - uid: string
  - name: tags
    description: Resource tags.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
- name: CloudError
  description: An error response from the service.
  kind: object
  properties:
  - name: error
    description: Cloud error body.
    types:
    - uid: CloudErrorBody
- name: ResourceIdentityType
  description: The type of identity used for the resource. The type 'SystemAssigned, UserAssigned' includes both an implicitly created identity and a set of user assigned identities. The type 'None' will remove any identities from the virtual machine.
  kind: enum
  properties:
  - name: SystemAssigned
    types:
    - uid: string
  - name: UserAssigned
    types:
    - uid: string
  - name: SystemAssigned, UserAssigned
    types:
    - uid: string
  - name: None
    types:
    - uid: string
- name: UserAssignedIdentities
  description: "The list of user identities associated with resource. The user identity dictionary key references will be ARM resource ids in the form: '/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.ManagedIdentity/userAssignedIdentities/{identityName}'."
  kind: object
  properties:
  - name: ''
    description: ''
    types:
    - uid: ''
- name: FirewallPolicyLogAnalyticsResources
  description: Log Analytics Resources for Firewall Policy Insights.
  kind: object
  properties:
  - name: workspaces
    description: List of workspaces for Firewall Policy Insights.
    types:
    - uid: FirewallPolicyLogAnalyticsWorkspace
      isArray: true
  - name: defaultWorkspaceId
    description: The default workspace Id for Firewall Policy Insights.
    types:
    - uid: SubResource
- name: FirewallPolicyIntrusionDetectionStateType
  description: Intrusion detection general state.
  kind: enum
  properties:
  - name: Off
    types:
    - uid: string
  - name: Alert
    types:
    - uid: string
  - name: Deny
    types:
    - uid: string
- name: FirewallPolicyIntrusionDetectionConfiguration
  description: The operation for configuring intrusion detection.
  kind: object
  properties:
  - name: signatureOverrides
    description: List of specific signatures states.
    types:
    - uid: FirewallPolicyIntrusionDetectionSignatureSpecification
      isArray: true
  - name: bypassTrafficSettings
    description: List of rules for traffic to bypass.
    types:
    - uid: FirewallPolicyIntrusionDetectionBypassTrafficSpecifications
      isArray: true
  - name: privateRanges
    description: IDPS Private IP address ranges are used to identify traffic direction (i.e. inbound, outbound, etc.). By default, only ranges defined by IANA RFC 1918 are considered private IP addresses. To modify default ranges, specify your Private IP address ranges with this property
    types:
    - uid: string
      isArray: true
- name: FirewallPolicyCertificateAuthority
  description: Trusted Root certificates properties for tls.
  kind: object
  properties:
  - name: keyVaultSecretId
    description: Secret Id of (base-64 encoded unencrypted pfx) 'Secret' or 'Certificate' object stored in KeyVault.
    types:
    - uid: string
  - name: name
    description: Name of the CA certificate.
    types:
    - uid: string
- name: FirewallPolicySkuTier
  description: Tier of Firewall Policy.
  kind: enum
  properties:
  - name: Standard
    types:
    - uid: string
  - name: Premium
    types:
    - uid: string
  - name: Basic
    types:
    - uid: string
- name: ProvisioningState
  description: The current provisioning state.
  kind: enum
  properties:
  - name: Succeeded
    types:
    - uid: string
  - name: Updating
    types:
    - uid: string
  - name: Deleting
    types:
    - uid: string
  - name: Failed
    types:
    - uid: string
- name: AzureFirewallThreatIntelMode
  description: The operation mode for Threat Intel.
  kind: enum
  properties:
  - name: Alert
    types:
    - uid: string
  - name: Deny
    types:
    - uid: string
  - name: Off
    types:
    - uid: string
- name: CloudErrorBody
  description: An error response from the service.
  kind: object
  properties:
  - name: code
    description: An identifier for the error. Codes are invariant and are intended to be consumed programmatically.
    types:
    - uid: string
  - name: message
    description: A message describing the error, intended to be suitable for display in a user interface.
    types:
    - uid: string
  - name: target
    description: The target of the particular error. For example, the name of the property in error.
    types:
    - uid: string
  - name: details
    description: A list of additional details about the error.
    types:
    - uid: CloudErrorBody
      isArray: true
- name: FirewallPolicyLogAnalyticsWorkspace
  description: Log Analytics Workspace for Firewall Policy Insights.
  kind: object
  properties:
  - name: region
    description: Region to configure the Workspace.
    types:
    - uid: string
  - name: workspaceId
    description: The workspace Id for Firewall Policy Insights.
    types:
    - uid: SubResource
- name: FirewallPolicyIntrusionDetectionSignatureSpecification
  description: Intrusion detection signatures specification states.
  kind: object
  properties:
  - name: id
    description: Signature id.
    types:
    - uid: string
  - name: mode
    description: The signature state.
    types:
    - uid: FirewallPolicyIntrusionDetectionStateType
- name: FirewallPolicyIntrusionDetectionBypassTrafficSpecifications
  description: Intrusion detection bypass traffic specification.
  kind: object
  properties:
  - name: name
    description: Name of the bypass traffic rule.
    types:
    - uid: string
  - name: description
    description: Description of the bypass traffic rule.
    types:
    - uid: string
  - name: protocol
    description: The rule bypass protocol.
    types:
    - uid: FirewallPolicyIntrusionDetectionProtocol
  - name: sourceAddresses
    description: List of source IP addresses or ranges for this rule.
    types:
    - uid: string
      isArray: true
  - name: destinationAddresses
    description: List of destination IP addresses or ranges for this rule.
    types:
    - uid: string
      isArray: true
  - name: destinationPorts
    description: List of destination ports or ranges.
    types:
    - uid: string
      isArray: true
  - name: sourceIpGroups
    description: List of source IpGroups for this rule.
    types:
    - uid: string
      isArray: true
  - name: destinationIpGroups
    description: List of destination IpGroups for this rule.
    types:
    - uid: string
      isArray: true
- name: FirewallPolicyIntrusionDetectionProtocol
  description: The rule bypass protocol.
  kind: enum
  properties:
  - name: TCP
    types:
    - uid: string
  - name: UDP
    types:
    - uid: string
  - name: ICMP
    types:
    - uid: string
  - name: ANY
    types:
    - uid: string
examples:
- name: Create FirewallPolicy
  request:
    uri: PUT https://management.azure.com/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/firewallPolicies/firewallPolicy?api-version=2021-08-01
    body: >-
      {
        "tags": {
          "key1": "value1"
        },
        "location": "West US",
        "properties": {
          "threatIntelMode": "Alert",
          "threatIntelWhitelist": {
            "ipAddresses": [
              "20.3.4.5"
            ],
            "fqdns": [
              "*.microsoft.com"
            ]
          },
          "insights": {
            "isEnabled": true,
            "retentionDays": 100,
            "logAnalyticsResources": {
              "workspaces": [
                {
                  "region": "westus",
                  "workspaceId": {
                    "id": "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/workspace1"
                  }
                },
                {
                  "region": "eastus",
                  "workspaceId": {
                    "id": "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/workspace2"
                  }
                }
              ],
              "defaultWorkspaceId": {
                "id": "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/defaultWorkspace"
              }
            }
          },
          "snat": {
            "privateRanges": [
              "IANAPrivateRanges"
            ]
          },
          "sql": {
            "allowSqlRedirect": true
          },
          "dnsSettings": {
            "servers": [
              "30.3.4.5"
            ],
            "enableProxy": true,
            "requireProxyForNetworkRules": false
          },
          "explicitProxySettings": {
            "enableExplicitProxy": true,
            "httpPort": 8087,
            "httpsPort": 8087,
            "pacFilePort": 8087,
            "pacFile": "https://tinawstorage.file.core.windows.net/?sv=2020-02-10&ss=bfqt&srt=sco&sp=rwdlacuptfx&se=2021-06-04T07:01:12Z&st=2021-06-03T23:01:12Z&sip=68.65.171.11&spr=https&sig=Plsa0RRVpGbY0IETZZOT6znOHcSro71LLTTbzquYPgs%3D"
          },
          "sku": {
            "tier": "Premium"
          },
          "intrusionDetection": {
            "mode": "Alert",
            "configuration": {
              "signatureOverrides": [
                {
                  "id": "2525004",
                  "mode": "Deny"
                }
              ],
              "bypassTrafficSettings": [
                {
                  "name": "bypassRule1",
                  "description": "Rule 1",
                  "protocol": "TCP",
                  "sourceAddresses": [
                    "1.2.3.4"
                  ],
                  "destinationAddresses": [
                    "5.6.7.8"
                  ],
                  "destinationPorts": [
                    "*"
                  ]
                }
              ]
            }
          },
          "transportSecurity": {
            "certificateAuthority": {
              "name": "clientcert",
              "keyVaultSecretId": "https://kv/secret"
            }
          }
        }
      }
    codeTab: |+
      # [HTTP](#tab/HTTP)
      ``` http
      PUT https://management.azure.com/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/firewallPolicies/firewallPolicy?api-version=2021-08-01

      {
        "tags": {
          "key1": "value1"
        },
        "location": "West US",
        "properties": {
          "threatIntelMode": "Alert",
          "threatIntelWhitelist": {
            "ipAddresses": [
              "20.3.4.5"
            ],
            "fqdns": [
              "*.microsoft.com"
            ]
          },
          "insights": {
            "isEnabled": true,
            "retentionDays": 100,
            "logAnalyticsResources": {
              "workspaces": [
                {
                  "region": "westus",
                  "workspaceId": {
                    "id": "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/workspace1"
                  }
                },
                {
                  "region": "eastus",
                  "workspaceId": {
                    "id": "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/workspace2"
                  }
                }
              ],
              "defaultWorkspaceId": {
                "id": "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/defaultWorkspace"
              }
            }
          },
          "snat": {
            "privateRanges": [
              "IANAPrivateRanges"
            ]
          },
          "sql": {
            "allowSqlRedirect": true
          },
          "dnsSettings": {
            "servers": [
              "30.3.4.5"
            ],
            "enableProxy": true,
            "requireProxyForNetworkRules": false
          },
          "explicitProxySettings": {
            "enableExplicitProxy": true,
            "httpPort": 8087,
            "httpsPort": 8087,
            "pacFilePort": 8087,
            "pacFile": "https://tinawstorage.file.core.windows.net/?sv=2020-02-10&ss=bfqt&srt=sco&sp=rwdlacuptfx&se=2021-06-04T07:01:12Z&st=2021-06-03T23:01:12Z&sip=68.65.171.11&spr=https&sig=Plsa0RRVpGbY0IETZZOT6znOHcSro71LLTTbzquYPgs%3D"
          },
          "sku": {
            "tier": "Premium"
          },
          "intrusionDetection": {
            "mode": "Alert",
            "configuration": {
              "signatureOverrides": [
                {
                  "id": "2525004",
                  "mode": "Deny"
                }
              ],
              "bypassTrafficSettings": [
                {
                  "name": "bypassRule1",
                  "description": "Rule 1",
                  "protocol": "TCP",
                  "sourceAddresses": [
                    "1.2.3.4"
                  ],
                  "destinationAddresses": [
                    "5.6.7.8"
                  ],
                  "destinationPorts": [
                    "*"
                  ]
                }
              ]
            }
          },
          "transportSecurity": {
            "certificateAuthority": {
              "name": "clientcert",
              "keyVaultSecretId": "https://kv/secret"
            }
          }
        }
      }

      ```

      # [Java](#tab/Java)
      ``` java
      import com.azure.core.management.SubResource;
      import com.azure.core.util.Context;
      import com.azure.resourcemanager.network.fluent.models.FirewallPolicyInner;
      import com.azure.resourcemanager.network.models.AzureFirewallThreatIntelMode;
      import com.azure.resourcemanager.network.models.DnsSettings;
      import com.azure.resourcemanager.network.models.ExplicitProxySettings;
      import com.azure.resourcemanager.network.models.FirewallPolicyCertificateAuthority;
      import com.azure.resourcemanager.network.models.FirewallPolicyInsights;
      import com.azure.resourcemanager.network.models.FirewallPolicyIntrusionDetection;
      import com.azure.resourcemanager.network.models.FirewallPolicyIntrusionDetectionBypassTrafficSpecifications;
      import com.azure.resourcemanager.network.models.FirewallPolicyIntrusionDetectionConfiguration;
      import com.azure.resourcemanager.network.models.FirewallPolicyIntrusionDetectionProtocol;
      import com.azure.resourcemanager.network.models.FirewallPolicyIntrusionDetectionSignatureSpecification;
      import com.azure.resourcemanager.network.models.FirewallPolicyIntrusionDetectionStateType;
      import com.azure.resourcemanager.network.models.FirewallPolicyLogAnalyticsResources;
      import com.azure.resourcemanager.network.models.FirewallPolicyLogAnalyticsWorkspace;
      import com.azure.resourcemanager.network.models.FirewallPolicySku;
      import com.azure.resourcemanager.network.models.FirewallPolicySkuTier;
      import com.azure.resourcemanager.network.models.FirewallPolicySnat;
      import com.azure.resourcemanager.network.models.FirewallPolicySql;
      import com.azure.resourcemanager.network.models.FirewallPolicyThreatIntelWhitelist;
      import com.azure.resourcemanager.network.models.FirewallPolicyTransportSecurity;
      import java.util.Arrays;
      import java.util.HashMap;
      import java.util.Map;

      /** Samples for FirewallPolicies CreateOrUpdate. */
      public final class Main {
          /*
           * x-ms-original-file: specification/network/resource-manager/Microsoft.Network/stable/2021-08-01/examples/FirewallPolicyPut.json
           */
          /**
           * Sample code: Create FirewallPolicy.
           *
           * @param azure The entry point for accessing resource management APIs in Azure.
           */
          public static void createFirewallPolicy(com.azure.resourcemanager.AzureResourceManager azure) {
              azure
                  .networks()
                  .manager()
                  .serviceClient()
                  .getFirewallPolicies()
                  .createOrUpdate(
                      "rg1",
                      "firewallPolicy",
                      new FirewallPolicyInner()
                          .withLocation("West US")
                          .withTags(mapOf("key1", "value1"))
                          .withThreatIntelMode(AzureFirewallThreatIntelMode.ALERT)
                          .withThreatIntelWhitelist(
                              new FirewallPolicyThreatIntelWhitelist()
                                  .withIpAddresses(Arrays.asList("20.3.4.5"))
                                  .withFqdns(Arrays.asList("*.microsoft.com")))
                          .withInsights(
                              new FirewallPolicyInsights()
                                  .withIsEnabled(true)
                                  .withRetentionDays(100)
                                  .withLogAnalyticsResources(
                                      new FirewallPolicyLogAnalyticsResources()
                                          .withWorkspaces(
                                              Arrays
                                                  .asList(
                                                      new FirewallPolicyLogAnalyticsWorkspace()
                                                          .withRegion("westus")
                                                          .withWorkspaceId(
                                                              new SubResource()
                                                                  .withId(
                                                                      "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/workspace1")),
                                                      new FirewallPolicyLogAnalyticsWorkspace()
                                                          .withRegion("eastus")
                                                          .withWorkspaceId(
                                                              new SubResource()
                                                                  .withId(
                                                                      "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/workspace2"))))
                                          .withDefaultWorkspaceId(
                                              new SubResource()
                                                  .withId(
                                                      "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/defaultWorkspace"))))
                          .withSnat(new FirewallPolicySnat().withPrivateRanges(Arrays.asList("IANAPrivateRanges")))
                          .withSql(new FirewallPolicySql().withAllowSqlRedirect(true))
                          .withDnsSettings(
                              new DnsSettings()
                                  .withServers(Arrays.asList("30.3.4.5"))
                                  .withEnableProxy(true)
                                  .withRequireProxyForNetworkRules(false))
                          .withExplicitProxySettings(
                              new ExplicitProxySettings()
                                  .withEnableExplicitProxy(true)
                                  .withHttpPort(8087)
                                  .withHttpsPort(8087)
                                  .withPacFilePort(8087)
                                  .withPacFile(
                                      "https://tinawstorage.file.core.windows.net/?sv=2020-02-10&ss=bfqt&srt=sco&sp=rwdlacuptfx&se=2021-06-04T07:01:12Z&st=2021-06-03T23:01:12Z&sip=68.65.171.11&spr=https&sig=Plsa0RRVpGbY0IETZZOT6znOHcSro71LLTTbzquYPgs%3D"))
                          .withIntrusionDetection(
                              new FirewallPolicyIntrusionDetection()
                                  .withMode(FirewallPolicyIntrusionDetectionStateType.ALERT)
                                  .withConfiguration(
                                      new FirewallPolicyIntrusionDetectionConfiguration()
                                          .withSignatureOverrides(
                                              Arrays
                                                  .asList(
                                                      new FirewallPolicyIntrusionDetectionSignatureSpecification()
                                                          .withId("2525004")
                                                          .withMode(FirewallPolicyIntrusionDetectionStateType.DENY)))
                                          .withBypassTrafficSettings(
                                              Arrays
                                                  .asList(
                                                      new FirewallPolicyIntrusionDetectionBypassTrafficSpecifications()
                                                          .withName("bypassRule1")
                                                          .withDescription("Rule 1")
                                                          .withProtocol(FirewallPolicyIntrusionDetectionProtocol.TCP)
                                                          .withSourceAddresses(Arrays.asList("1.2.3.4"))
                                                          .withDestinationAddresses(Arrays.asList("5.6.7.8"))
                                                          .withDestinationPorts(Arrays.asList("*"))))))
                          .withTransportSecurity(
                              new FirewallPolicyTransportSecurity()
                                  .withCertificateAuthority(
                                      new FirewallPolicyCertificateAuthority()
                                          .withKeyVaultSecretId("https://kv/secret")
                                          .withName("clientcert")))
                          .withSku(new FirewallPolicySku().withTier(FirewallPolicySkuTier.PREMIUM)),
                      Context.NONE);
          }

          @SuppressWarnings("unchecked")
          private static <T> Map<String, T> mapOf(Object... inputs) {
              Map<String, T> map = new HashMap<>();
              for (int i = 0; i < inputs.length; i += 2) {
                  String key = (String) inputs[i];
                  T value = (T) inputs[i + 1];
                  map.put(key, value);
              }
              return map;
          }
      }

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-java/blob/azure-resourcemanager_2.17.0/sdk/resourcemanager/azure-resourcemanager/README.md) on how to add the SDK to your project and authenticate.
      # [Go](#tab/Go)
      ``` go
      package armnetwork_test

      import (
      	"context"
      	"log"

      	"github.com/Azure/azure-sdk-for-go/sdk/azcore/to"
      	"github.com/Azure/azure-sdk-for-go/sdk/azidentity"
      	"github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/network/armnetwork"
      )

      // Generated from example definition: https://github.com/Azure/azure-rest-api-specs/tree/main/specification/network/resource-manager/Microsoft.Network/stable/2021-08-01/examples/FirewallPolicyPut.json
      func ExampleFirewallPoliciesClient_BeginCreateOrUpdate() {
      	cred, err := azidentity.NewDefaultAzureCredential(nil)
      	if err != nil {
      		log.Fatalf("failed to obtain a credential: %v", err)
      	}
      	ctx := context.Background()
      	client, err := armnetwork.NewFirewallPoliciesClient("subid", cred, nil)
      	if err != nil {
      		log.Fatalf("failed to create client: %v", err)
      	}
      	poller, err := client.BeginCreateOrUpdate(ctx,
      		"rg1",
      		"firewallPolicy",
      		armnetwork.FirewallPolicy{
      			Location: to.Ptr("West US"),
      			Tags: map[string]*string{
      				"key1": to.Ptr("value1"),
      			},
      			Properties: &armnetwork.FirewallPolicyPropertiesFormat{
      				DNSSettings: &armnetwork.DNSSettings{
      					EnableProxy:                 to.Ptr(true),
      					RequireProxyForNetworkRules: to.Ptr(false),
      					Servers: []*string{
      						to.Ptr("30.3.4.5")},
      				},
      				ExplicitProxySettings: &armnetwork.ExplicitProxySettings{
      					EnableExplicitProxy: to.Ptr(true),
      					HTTPPort:            to.Ptr[int32](8087),
      					HTTPSPort:           to.Ptr[int32](8087),
      					PacFile:             to.Ptr("https://tinawstorage.file.core.windows.net/?sv=2020-02-10&ss=bfqt&srt=sco&sp=rwdlacuptfx&se=2021-06-04T07:01:12Z&st=2021-06-03T23:01:12Z&sip=68.65.171.11&spr=https&sig=Plsa0RRVpGbY0IETZZOT6znOHcSro71LLTTbzquYPgs%3D"),
      					PacFilePort:         to.Ptr[int32](8087),
      				},
      				Insights: &armnetwork.FirewallPolicyInsights{
      					IsEnabled: to.Ptr(true),
      					LogAnalyticsResources: &armnetwork.FirewallPolicyLogAnalyticsResources{
      						DefaultWorkspaceID: &armnetwork.SubResource{
      							ID: to.Ptr("/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/defaultWorkspace"),
      						},
      						Workspaces: []*armnetwork.FirewallPolicyLogAnalyticsWorkspace{
      							{
      								Region: to.Ptr("westus"),
      								WorkspaceID: &armnetwork.SubResource{
      									ID: to.Ptr("/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/workspace1"),
      								},
      							},
      							{
      								Region: to.Ptr("eastus"),
      								WorkspaceID: &armnetwork.SubResource{
      									ID: to.Ptr("/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/workspace2"),
      								},
      							}},
      					},
      					RetentionDays: to.Ptr[int32](100),
      				},
      				IntrusionDetection: &armnetwork.FirewallPolicyIntrusionDetection{
      					Configuration: &armnetwork.FirewallPolicyIntrusionDetectionConfiguration{
      						BypassTrafficSettings: []*armnetwork.FirewallPolicyIntrusionDetectionBypassTrafficSpecifications{
      							{
      								Name:        to.Ptr("bypassRule1"),
      								Description: to.Ptr("Rule 1"),
      								DestinationAddresses: []*string{
      									to.Ptr("5.6.7.8")},
      								DestinationPorts: []*string{
      									to.Ptr("*")},
      								SourceAddresses: []*string{
      									to.Ptr("1.2.3.4")},
      								Protocol: to.Ptr(armnetwork.FirewallPolicyIntrusionDetectionProtocolTCP),
      							}},
      						SignatureOverrides: []*armnetwork.FirewallPolicyIntrusionDetectionSignatureSpecification{
      							{
      								ID:   to.Ptr("2525004"),
      								Mode: to.Ptr(armnetwork.FirewallPolicyIntrusionDetectionStateTypeDeny),
      							}},
      					},
      					Mode: to.Ptr(armnetwork.FirewallPolicyIntrusionDetectionStateTypeAlert),
      				},
      				SKU: &armnetwork.FirewallPolicySKU{
      					Tier: to.Ptr(armnetwork.FirewallPolicySKUTierPremium),
      				},
      				Snat: &armnetwork.FirewallPolicySNAT{
      					PrivateRanges: []*string{
      						to.Ptr("IANAPrivateRanges")},
      				},
      				SQL: &armnetwork.FirewallPolicySQL{
      					AllowSQLRedirect: to.Ptr(true),
      				},
      				ThreatIntelMode: to.Ptr(armnetwork.AzureFirewallThreatIntelModeAlert),
      				ThreatIntelWhitelist: &armnetwork.FirewallPolicyThreatIntelWhitelist{
      					Fqdns: []*string{
      						to.Ptr("*.microsoft.com")},
      					IPAddresses: []*string{
      						to.Ptr("20.3.4.5")},
      				},
      				TransportSecurity: &armnetwork.FirewallPolicyTransportSecurity{
      					CertificateAuthority: &armnetwork.FirewallPolicyCertificateAuthority{
      						Name:             to.Ptr("clientcert"),
      						KeyVaultSecretID: to.Ptr("https://kv/secret"),
      					},
      				},
      			},
      		},
      		nil)
      	if err != nil {
      		log.Fatalf("failed to finish the request: %v", err)
      	}
      	res, err := poller.PollUntilDone(ctx, nil)
      	if err != nil {
      		log.Fatalf("failed to pull the result: %v", err)
      	}
      	// TODO: use response item
      	_ = res
      }

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-go/blob/sdk%2Fresourcemanager%2Fnetwork%2Farmnetwork%2Fv1.0.0/sdk/resourcemanager/network/armnetwork/README.md) on how to add the SDK to your project and authenticate.
      # [JavaScript](#tab/JavaScript)
      ``` js
      const { NetworkManagementClient } = require("@azure/arm-network");
      const { DefaultAzureCredential } = require("@azure/identity");

      /**
       * This sample demonstrates how to Creates or updates the specified Firewall Policy.
       *
       * @summary Creates or updates the specified Firewall Policy.
       * x-ms-original-file: specification/network/resource-manager/Microsoft.Network/stable/2021-08-01/examples/FirewallPolicyPut.json
       */
      async function createFirewallPolicy() {
        const subscriptionId = "subid";
        const resourceGroupName = "rg1";
        const firewallPolicyName = "firewallPolicy";
        const parameters = {
          dnsSettings: {
            enableProxy: true,
            requireProxyForNetworkRules: false,
            servers: ["30.3.4.5"],
          },
          explicitProxySettings: {
            enableExplicitProxy: true,
            httpPort: 8087,
            httpsPort: 8087,
            pacFile:
              "https://tinawstorage.file.core.windows.net/?sv=2020-02-10&ss=bfqt&srt=sco&sp=rwdlacuptfx&se=2021-06-04T07:01:12Z&st=2021-06-03T23:01:12Z&sip=68.65.171.11&spr=https&sig=Plsa0RRVpGbY0IETZZOT6znOHcSro71LLTTbzquYPgs%3D",
            pacFilePort: 8087,
          },
          insights: {
            isEnabled: true,
            logAnalyticsResources: {
              defaultWorkspaceId: {
                id: "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/defaultWorkspace",
              },
              workspaces: [
                {
                  region: "westus",
                  workspaceId: {
                    id: "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/workspace1",
                  },
                },
                {
                  region: "eastus",
                  workspaceId: {
                    id: "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/workspace2",
                  },
                },
              ],
            },
            retentionDays: 100,
          },
          intrusionDetection: {
            configuration: {
              bypassTrafficSettings: [
                {
                  name: "bypassRule1",
                  description: "Rule 1",
                  destinationAddresses: ["5.6.7.8"],
                  destinationPorts: ["*"],
                  sourceAddresses: ["1.2.3.4"],
                  protocol: "TCP",
                },
              ],
              signatureOverrides: [{ id: "2525004", mode: "Deny" }],
            },
            mode: "Alert",
          },
          location: "West US",
          sku: { tier: "Premium" },
          snat: { privateRanges: ["IANAPrivateRanges"] },
          sql: { allowSqlRedirect: true },
          tags: { key1: "value1" },
          threatIntelMode: "Alert",
          threatIntelWhitelist: {
            fqdns: ["*.microsoft.com"],
            ipAddresses: ["20.3.4.5"],
          },
          transportSecurity: {
            certificateAuthority: {
              name: "clientcert",
              keyVaultSecretId: "https://kv/secret",
            },
          },
        };
        const credential = new DefaultAzureCredential();
        const client = new NetworkManagementClient(credential, subscriptionId);
        const result = await client.firewallPolicies.beginCreateOrUpdateAndWait(
          resourceGroupName,
          firewallPolicyName,
          parameters
        );
        console.log(result);
      }

      createFirewallPolicy().catch(console.error);

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-js/blob/%40azure%2Farm-network_28.0.0/sdk/network/arm-network/README.md) on how to add the SDK to your project and authenticate.
  responses:
  - statusCode: "200"
    body: >-
      {
        "name": "firewallPolicy",
        "id": "/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/firewallPolicies/firewallPolicy",
        "type": "Microsoft.Network/firewallPolicies",
        "etag": "w/\\00000000-0000-0000-0000-000000000000\\",
        "location": "West US",
        "tags": {
          "key1": "value1"
        },
        "properties": {
          "provisioningState": "Succeeded",
          "threatIntelMode": "Alert",
          "threatIntelWhitelist": {
            "ipAddresses": [
              "20.3.4.5"
            ],
            "fqdns": [
              "*.microsoft.com"
            ]
          },
          "ruleCollectionGroups": [
            {
              "id": "/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/firewallPolicies/firewallPolicy/ruleCollectionGroups/ruleCollectionGroup1"
            },
            {
              "id": "/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/firewallPolicies/firewallPolicy/ruleCollectionGroups/ruleCollectionGroup2"
            }
          ],
          "insights": {
            "isEnabled": true,
            "retentionDays": 100,
            "logAnalyticsResources": {
              "workspaces": [
                {
                  "region": "westus",
                  "workspaceId": {
                    "id": "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/workspace1"
                  }
                },
                {
                  "region": "eastus",
                  "workspaceId": {
                    "id": "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/workspace2"
                  }
                }
              ],
              "defaultWorkspaceId": {
                "id": "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/defaultWorkspace"
              }
            }
          },
          "firewalls": [],
          "snat": {
            "privateRanges": [
              "IANAPrivateRanges"
            ]
          },
          "sql": {
            "allowSqlRedirect": true
          },
          "dnsSettings": {
            "servers": [
              "30.3.4.5"
            ],
            "enableProxy": true,
            "requireProxyForNetworkRules": false
          },
          "explicitProxySettings": {
            "enableExplicitProxy": true,
            "httpPort": 8087,
            "httpsPort": 8087,
            "pacFilePort": 8087,
            "pacFile": "https://tinawstorage.file.core.windows.net/?sv=2020-02-10&ss=bfqt&srt=sco&sp=rwdlacuptfx&se=2021-06-04T07:01:12Z&st=2021-06-03T23:01:12Z&sip=68.65.171.11&spr=https&sig=Plsa0RRVpGbY0IETZZOT6znOHcSro71LLTTbzquYPgs%3D"
          },
          "sku": {
            "tier": "Premium"
          },
          "intrusionDetection": {
            "mode": "Alert",
            "configuration": {
              "signatureOverrides": [
                {
                  "id": "2525004",
                  "mode": "Deny"
                }
              ],
              "bypassTrafficSettings": [
                {
                  "name": "bypassRule1",
                  "description": "Rule 1",
                  "protocol": "TCP",
                  "sourceAddresses": [
                    "1.2.3.4"
                  ],
                  "destinationAddresses": [
                    "5.6.7.8"
                  ],
                  "destinationPorts": [
                    "*"
                  ]
                }
              ]
            }
          },
          "transportSecurity": {
            "certificateAuthority": {
              "name": "clientcert",
              "keyVaultSecretId": "https://kv/secret"
            }
          }
        }
      }
  - statusCode: "201"
    body: >-
      {
        "name": "firewallPolicy",
        "id": "/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/firewallPolicies/firewallPolicy",
        "type": "Microsoft.Network/firewallPolicies",
        "etag": "w/\\00000000-0000-0000-0000-000000000000\\",
        "location": "West US",
        "tags": {
          "key1": "value1"
        },
        "properties": {
          "provisioningState": "Succeeded",
          "threatIntelMode": "Alert",
          "threatIntelWhitelist": {
            "ipAddresses": [
              "20.3.4.5"
            ],
            "fqdns": [
              "*.microsoft.com"
            ]
          },
          "ruleCollectionGroups": [
            {
              "id": "/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/firewallPolicies/firewallPolicy/ruleCollectionGroups/ruleCollectionGroup1"
            },
            {
              "id": "/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/firewallPolicies/firewallPolicy/ruleCollectionGroups/ruleCollectionGroup2"
            }
          ],
          "insights": {
            "isEnabled": true,
            "retentionDays": 100,
            "logAnalyticsResources": {
              "workspaces": [
                {
                  "region": "westus",
                  "workspaceId": {
                    "id": "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/workspace1"
                  }
                },
                {
                  "region": "eastus",
                  "workspaceId": {
                    "id": "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/workspace2"
                  }
                }
              ],
              "defaultWorkspaceId": {
                "id": "/subscriptions/subid/resourcegroups/rg1/providers/microsoft.operationalinsights/workspaces/defaultWorkspace"
              }
            }
          },
          "firewalls": [],
          "snat": {
            "privateRanges": [
              "IANAPrivateRanges"
            ]
          },
          "sql": {
            "allowSqlRedirect": true
          },
          "dnsSettings": {
            "servers": [
              "30.3.4.5"
            ],
            "enableProxy": true,
            "requireProxyForNetworkRules": false
          },
          "explicitProxySettings": {
            "enableExplicitProxy": true,
            "httpPort": 8087,
            "httpsPort": 8087,
            "pacFilePort": 8087,
            "pacFile": "https://tinawstorage.file.core.windows.net/?sv=2020-02-10&ss=bfqt&srt=sco&sp=rwdlacuptfx&se=2021-06-04T07:01:12Z&st=2021-06-03T23:01:12Z&sip=68.65.171.11&spr=https&sig=Plsa0RRVpGbY0IETZZOT6znOHcSro71LLTTbzquYPgs%3D"
          },
          "sku": {
            "tier": "Premium"
          },
          "intrusionDetection": {
            "mode": "Alert",
            "configuration": {
              "signatureOverrides": [
                {
                  "id": "2525004",
                  "mode": "Deny"
                }
              ],
              "bypassTrafficSettings": [
                {
                  "name": "bypassRule1",
                  "description": "Rule 1",
                  "protocol": "TCP",
                  "sourceAddresses": [
                    "1.2.3.4"
                  ],
                  "destinationAddresses": [
                    "5.6.7.8"
                  ],
                  "destinationPorts": [
                    "*"
                  ]
                }
              ]
            }
          },
          "transportSecurity": {
            "certificateAuthority": {
              "name": "clientcert",
              "keyVaultSecretId": "https://kv/secret"
            }
          }
        }
      }
security:
- name: azure_auth
  type: oauth2
  description: Azure Active Directory OAuth2 Flow.
  flow: implicit
  authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
  scopes:
  - name: user_impersonation
    description: impersonate your user account
metadata:
  description: Learn more about Virtual Networks service - Creates or updates the specified Firewall Policy.
errorCodes: []
