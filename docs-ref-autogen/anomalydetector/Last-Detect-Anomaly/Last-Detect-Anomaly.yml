### YamlMime:RESTOperation
uid: anomalydetector.lastdetectanomaly.lastdetectanomaly
name: Last Detect Anomaly
service: Cognitive Services - AnomalyDetector
groupName: Last Detect Anomaly
apiVersion: 1.1-preview.1
summary: "Detect anomalies in the last a few points of the request body.  \nSynchronized API for anomaly detection."
consumes:
- application/json
produces:
- application/json
paths:
- content: POST {Endpoint}/anomalydetector/{ApiVersion}/multivariate/models/{modelId}/last/detect
uriParameters:
- name: Endpoint
  in: path
  isRequired: true
  skipUrlEncoding: true
  description: 'Supported Cognitive Services endpoints (protocol and hostname, for example: https://westus2.api.cognitive.microsoft.com).'
  types:
  - uid: string
- name: ApiVersion
  in: path
  isRequired: true
  skipUrlEncoding: true
  description: Anomaly Detector API version (for example, v1.0).
  types:
  - uid: string
- name: modelId
  in: path
  isRequired: true
  description: Model identifier.
  types:
  - uid: string
  format: uuid
responses:
- name: 200 OK
  description: Detection has successfully completed.
  types:
  - uid: LastDetectionResult
- name: Other Status Codes
  headers:
  - name: x-ms-error-code
    value: string
  description: Error response
  types:
  - uid: ErrorResponse
requestBody:
- name: default
  parameters:
  - name: variables
    in: body
    isRequired: true
    description: variables
    types:
    - uid: VariableValues
      isArray: true
  - name: detectingPoints
    in: body
    isRequired: true
    description: number of timestamps on which the model detects
    types:
    - uid: integer
requestHeader:
- name: Ocp-Apim-Subscription-Key
  in: header
  isRequired: true
  types:
  - uid: string
definitions:
- name: VariableValues
  kind: object
  properties:
  - name: name
    description: variable name
    types:
    - uid: string
  - name: timestamps
    description: timestamps
    types:
    - uid: string
      isArray: true
  - name: values
    description: values
    types:
    - uid: number
      isArray: true
- name: LastDetectionResult
  kind: object
  properties:
  - name: variableStates
    description: ''
    types:
    - uid: VariableState
      isArray: true
  - name: results
    description: ''
    types:
    - uid: AnomalyState
      isArray: true
- name: ErrorResponse
  kind: object
  properties:
  - name: code
    description: The error code.
    types:
    - uid: string
  - name: message
    description: The message explaining the error reported by the service.
    types:
    - uid: string
- name: LastDetectionRequest
  kind: object
  properties:
  - name: variables
    description: variables
    types:
    - uid: VariableValues
      isArray: true
  - name: detectingPoints
    description: number of timestamps on which the model detects
    types:
    - uid: integer
- name: VariableState
  kind: object
  properties:
  - name: variable
    description: Variable name.
    types:
    - uid: string
  - name: filledNARatio
    description: Proportion of NaN values filled of the variable.
    types:
    - uid: number
  - name: effectiveCount
    description: Number of effective points counted.
    types:
    - uid: integer
  - name: startTime
    description: Start time of the variable.
    types:
    - uid: string
  - name: endTime
    description: End time of the variable.
    types:
    - uid: string
- name: AnomalyState
  kind: object
  properties:
  - name: timestamp
    description: timestamp
    types:
    - uid: string
  - name: value
    description: ''
    types:
    - uid: AnomalyValue
  - name: errors
    description: Error message for the current timestamp
    types:
    - uid: ErrorResponse
      isArray: true
- name: AnomalyValue
  kind: object
  properties:
  - name: isAnomaly
    description: True if an anomaly is detected at the current timestamp.
    types:
    - uid: boolean
  - name: severity
    description: Indicates the significance of the anomaly. The higher the severity, the more significant the anomaly.
    types:
    - uid: number
  - name: score
    description: Raw score from the model.
    types:
    - uid: number
  - name: interpretation
    description: ''
    types:
    - uid: AnomalyInterpretation
      isArray: true
- name: AnomalyInterpretation
  kind: object
  properties:
  - name: variable
    description: ''
    types:
    - uid: string
  - name: contributionScore
    description: ''
    types:
    - uid: number
  - name: correlationChanges
    description: ''
    types:
    - uid: CorrelationChanges
- name: CorrelationChanges
  kind: object
  properties:
  - name: changedVariables
    description: correlated variables
    types:
    - uid: string
      isArray: true
  - name: changedValues
    description: changes in correlation
    types:
    - uid: number
      isArray: true
examples:
- name: Detect anomaly with multivariate Model
  request:
    uri: POST {Endpoint}/anomalydetector/v1.1-preview.1/multivariate/models/45aad126-aafd-11ea-b8fb-d89ef3400c5f/last/detect
    body: >-
      {
        "variables": [
          {
            "name": "Variable_1",
            "timestamps": [
              "2021-01-01T00:00:00Z",
              "2021-01-01T00:01:00Z",
              "2021-01-01T00:02:00Z",
              "2021-01-01T00:03:00Z",
              "2021-01-01T00:04:00Z",
              "2021-01-01T00:05:00Z",
              "2021-01-01T00:06:00Z",
              "2021-01-01T00:07:00Z",
              "2021-01-01T00:08:00Z",
              "2021-01-01T00:09:00Z",
              "2021-01-01T00:10:00Z",
              "2021-01-01T00:11:00Z",
              "2021-01-01T00:12:00Z",
              "2021-01-01T00:13:00Z",
              "2021-01-01T00:14:00Z",
              "2021-01-01T00:15:00Z",
              "2021-01-01T00:16:00Z",
              "2021-01-01T00:17:00Z",
              "2021-01-01T00:18:00Z",
              "2021-01-01T00:19:00Z",
              "2021-01-01T00:20:00Z",
              "2021-01-01T00:21:00Z",
              "2021-01-01T00:22:00Z",
              "2021-01-01T00:23:00Z",
              "2021-01-01T00:24:00Z",
              "2021-01-01T00:25:00Z",
              "2021-01-01T00:26:00Z",
              "2021-01-01T00:27:00Z",
              "2021-01-01T00:28:00Z",
              "2021-01-01T00:29:00Z"
            ],
            "values": [
              0.4551378545933972,
              0.7388603950488748,
              0.201088255984052,
              0.7462812245891899,
              0.07308128850401663,
              0.33090474587393537,
              0.7544925268153315,
              0.987506336316328,
              0.6665932993421468,
              0.6308351543168672,
              0.08083310161466228,
              0.8414415588668442,
              0.514583545640453,
              0.0954489875193526,
              0.7786793231920507,
              0.41646133667960994,
              0.030176187583339287,
              0.3474214937189324,
              0.508530173413991,
              0.42451199127255046,
              0.2115944222725208,
              0.24733519545833516,
              0.8791022110982156,
              0.9479621899884665,
              0.26702703121252136,
              0.6954503497669413,
              0.1235728391488995,
              0.8214915473050647,
              0.11813002444192677,
              0.8579045951076123
            ]
          },
          {
            "name": "Variable_2",
            "timestamps": [
              "2021-01-01T00:00:00Z",
              "2021-01-01T00:01:00Z",
              "2021-01-01T00:02:00Z",
              "2021-01-01T00:03:00Z",
              "2021-01-01T00:04:00Z",
              "2021-01-01T00:05:00Z",
              "2021-01-01T00:06:00Z",
              "2021-01-01T00:07:00Z",
              "2021-01-01T00:08:00Z",
              "2021-01-01T00:09:00Z",
              "2021-01-01T00:10:00Z",
              "2021-01-01T00:11:00Z",
              "2021-01-01T00:12:00Z",
              "2021-01-01T00:13:00Z",
              "2021-01-01T00:14:00Z",
              "2021-01-01T00:15:00Z",
              "2021-01-01T00:16:00Z",
              "2021-01-01T00:17:00Z",
              "2021-01-01T00:18:00Z",
              "2021-01-01T00:19:00Z",
              "2021-01-01T00:20:00Z",
              "2021-01-01T00:21:00Z",
              "2021-01-01T00:22:00Z",
              "2021-01-01T00:23:00Z",
              "2021-01-01T00:24:00Z",
              "2021-01-01T00:25:00Z",
              "2021-01-01T00:26:00Z",
              "2021-01-01T00:27:00Z",
              "2021-01-01T00:28:00Z",
              "2021-01-01T00:29:00Z"
            ],
            "values": [
              0.9617871613964145,
              0.24903311574778408,
              0.4920561254118613,
              0.9895601049618598,
              0.9171759283128094,
              0.5754204711105273,
              0.1811033296265634,
              0.8852311981742577,
              0.9543231904644779,
              0.7088012446094262,
              0.7843572237149014,
              0.7664787010700046,
              0.3699552325387093,
              0.504519908266789,
              0.5848930929950164,
              0.7628913396089576,
              0.8148405868900065,
              0.08540458873739332,
              0.03481976727525682,
              0.21275099339467762,
              0.9836175579199806,
              0.9321441483364282,
              0.038466608085469534,
              0.1723138437622782,
              0.8626383410218382,
              0.35053229974224254,
              0.631141662835182,
              0.0730352607990088,
              0.08886179043386,
              0.7488606040971179
            ]
          },
          {
            "name": "Variable_3",
            "timestamps": [
              "2021-01-01T00:00:00Z",
              "2021-01-01T00:01:00Z",
              "2021-01-01T00:02:00Z",
              "2021-01-01T00:03:00Z",
              "2021-01-01T00:04:00Z",
              "2021-01-01T00:05:00Z",
              "2021-01-01T00:06:00Z",
              "2021-01-01T00:07:00Z",
              "2021-01-01T00:08:00Z",
              "2021-01-01T00:09:00Z",
              "2021-01-01T00:10:00Z",
              "2021-01-01T00:11:00Z",
              "2021-01-01T00:12:00Z",
              "2021-01-01T00:13:00Z",
              "2021-01-01T00:14:00Z",
              "2021-01-01T00:15:00Z",
              "2021-01-01T00:16:00Z",
              "2021-01-01T00:17:00Z",
              "2021-01-01T00:18:00Z",
              "2021-01-01T00:19:00Z",
              "2021-01-01T00:20:00Z",
              "2021-01-01T00:21:00Z",
              "2021-01-01T00:22:00Z",
              "2021-01-01T00:23:00Z",
              "2021-01-01T00:24:00Z",
              "2021-01-01T00:25:00Z",
              "2021-01-01T00:26:00Z",
              "2021-01-01T00:27:00Z",
              "2021-01-01T00:28:00Z",
              "2021-01-01T00:29:00Z"
            ],
            "values": [
              0.4030756879437628,
              0.15526889968448554,
              0.36352226408981103,
              0.6051200637229004,
              0.8516795018476276,
              0.2645605735279929,
              0.6810875830037345,
              0.9165894221681316,
              0.700783245230424,
              0.5624155469940331,
              0.6277289685127893,
              0.15992056539730204,
              0.6020964482827594,
              0.35937967753105915,
              0.8731686034848609,
              0.20301549117588935,
              0.029261872151168933,
              0.6261499548828445,
              0.45850782028563386,
              0.8275006940083313,
              0.032760268834037376,
              0.4485202784055029,
              0.8915691008748384,
              0.891669051517807,
              0.9469979353323046,
              0.115293087370132,
              0.08818772518459506,
              0.7426286620589166,
              0.32372247468990756,
              0.936268139507417
            ]
          }
        ],
        "detectingPoints": 2
      }
    headers:
    - name: Ocp-Apim-Subscription-Key
      value: '{API key}'
  responses:
  - statusCode: "200"
    body: >-
      {
        "variableStates": [
          {
            "variable": "variable_1",
            "filledNARatio": 0,
            "effectiveCount": 30,
            "startTime": "2021-01-01T00:00:00Z",
            "endTime": "2021-01-01T00:29:00Z"
          },
          {
            "variable": "variable_2",
            "filledNARatio": 0,
            "effectiveCount": 30,
            "startTime": "2021-01-01T00:00:00Z",
            "endTime": "2021-01-01T00:29:00Z"
          },
          {
            "variable": "variable_3",
            "filledNARatio": 0,
            "effectiveCount": 30,
            "startTime": "2021-01-01T00:00:00Z",
            "endTime": "2021-01-01T00:29:00Z"
          }
        ],
        "results": [
          {
            "timestamp": "2021-01-01T00:28:00Z",
            "value": {
              "isAnomaly": false,
              "severity": 0,
              "score": 0.6928471326828003
            },
            "errors": []
          },
          {
            "timestamp": "2021-01-01T00:29:00Z",
            "value": {
              "isAnomaly": true,
              "severity": 0.5337404608726501,
              "score": 0.9171165823936462,
              "interpretation": [
                {
                  "variable": "variable_2",
                  "contributionScore": 0.5371576215,
                  "correlationChanges": {
                    "changedVariables": [
                      "variable_1",
                      "variable_3"
                    ],
                    "changedValues": [
                      0.1741322,
                      0.1093203
                    ]
                  }
                },
                {
                  "variable": "variable_3",
                  "contributionScore": 0.3324159383,
                  "correlationChanges": {
                    "changedVariables": [
                      "variable_2"
                    ],
                    "changedValues": [
                      0.1229392
                    ]
                  }
                },
                {
                  "variable": "variable_1",
                  "contributionScore": 0.1304264402,
                  "correlationChanges": {
                    "changedVariables": [],
                    "changedValues": []
                  }
                }
              ]
            },
            "errors": []
          }
        ]
      }
  - statusCode: default
    headers:
    - name: Content-Type
      value: application/json
    - name: x-ms-error-code
      value: Error Code
    body: >-
      {
        "code": "Error Code",
        "message": "Error Message"
      }
security:
- name: Ocp-Apim-Subscription-Key
  type: apiKey
  in: header
metadata:
  description: "Detect anomalies in the last a few points of the request body.  \nSynchronized API for anomaly detection."
errorCodes: []
