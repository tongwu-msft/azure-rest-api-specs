### YamlMime:RESTOperation
uid: management.azure.com.network-watcher.networkwatchers.getnetworkconfigurationdiagnostic
name: Get Network Configuration Diagnostic
service: Network Watcher
groupName: Network Watchers
apiVersion: 2022-01-01
summary: Gets Network Configuration Diagnostic data to help customers understand and debug network behavior. It provides detailed information on what security rules were applied to a specified traffic flow and the result of evaluating these rules. Customers must provide details of a flow like source, destination, protocol, etc. The API returns whether traffic was allowed or denied, the rules evaluated for the specified flow and the evaluation results.
consumes:
- application/json
produces:
- application/json
paths:
- content: POST https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/networkWatchers/{networkWatcherName}/networkConfigurationDiagnostic?api-version=2022-01-01
uriParameters:
- name: subscriptionId
  in: path
  isRequired: true
  description: The subscription credentials which uniquely identify the Microsoft Azure subscription. The subscription ID forms part of the URI for every service call.
  types:
  - uid: string
- name: resourceGroupName
  in: path
  isRequired: true
  description: The name of the resource group.
  types:
  - uid: string
- name: networkWatcherName
  in: path
  isRequired: true
  description: The name of the network watcher.
  types:
  - uid: string
- name: api-version
  in: query
  isRequired: true
  description: Client API version.
  types:
  - uid: string
responses:
- name: 200 OK
  description: Request successful. The operation returns the result of network configuration diagnostic.
  types:
  - uid: NetworkConfigurationDiagnosticResponse
- name: 202 Accepted
  description: Accepted and the operation will complete asynchronously.
  types:
  - uid: NetworkConfigurationDiagnosticResponse
- name: Other Status Codes
  description: Error response describing why the operation failed.
  types:
  - uid: ErrorResponse
requestBody:
- name: default
  parameters:
  - name: targetResourceId
    in: body
    isRequired: true
    description: The ID of the target resource to perform network configuration diagnostic. Valid options are VM, NetworkInterface, VMSS/NetworkInterface and Application Gateway.
    types:
    - uid: string
  - name: verbosityLevel
    in: body
    description: Verbosity level.
    types:
    - uid: VerbosityLevel
  - name: profiles
    in: body
    isRequired: true
    description: List of network configuration diagnostic profiles.
    types:
    - uid: NetworkConfigurationDiagnosticProfile
      isArray: true
requestHeader: []
definitions:
- name: NetworkConfigurationDiagnosticProfile
  description: Parameters to compare with network configuration.
  kind: object
  properties:
  - name: direction
    description: The direction of the traffic.
    types:
    - uid: Direction
  - name: protocol
    description: Protocol to be verified on. Accepted values are '*', TCP, UDP.
    types:
    - uid: string
  - name: source
    description: Traffic source. Accepted values are '*', IP Address/CIDR, Service Tag.
    types:
    - uid: string
  - name: destination
    description: "Traffic destination. Accepted values are: '*', IP Address/CIDR, Service Tag."
    types:
    - uid: string
  - name: destinationPort
    description: Traffic destination port. Accepted values are '*' and a single port in the range (0 - 65535).
    types:
    - uid: string
- name: NetworkConfigurationDiagnosticResponse
  description: Results of network configuration diagnostic on the target resource.
  kind: object
  properties:
  - name: results
    isReadyOnly: true
    description: List of network configuration diagnostic results.
    types:
    - uid: NetworkConfigurationDiagnosticResult
      isArray: true
- name: ErrorResponse
  description: The error object.
  kind: object
  properties:
  - name: error
    description: "Error  \nThe error details object."
    types:
    - uid: ErrorDetails
- name: NetworkConfigurationDiagnosticParameters
  description: Parameters to get network configuration diagnostic.
  kind: object
  properties:
  - name: targetResourceId
    description: The ID of the target resource to perform network configuration diagnostic. Valid options are VM, NetworkInterface, VMSS/NetworkInterface and Application Gateway.
    types:
    - uid: string
  - name: verbosityLevel
    description: Verbosity level.
    types:
    - uid: VerbosityLevel
  - name: profiles
    description: List of network configuration diagnostic profiles.
    types:
    - uid: NetworkConfigurationDiagnosticProfile
      isArray: true
- name: Direction
  description: The direction of the traffic.
  kind: enum
  properties:
  - name: Inbound
    types:
    - uid: string
  - name: Outbound
    types:
    - uid: string
- name: NetworkConfigurationDiagnosticResult
  description: Network configuration diagnostic result corresponded to provided traffic query.
  kind: object
  properties:
  - name: profile
    description: Network configuration diagnostic profile.
    types:
    - uid: NetworkConfigurationDiagnosticProfile
  - name: networkSecurityGroupResult
    description: Network security group result.
    types:
    - uid: NetworkSecurityGroupResult
- name: ErrorDetails
  description: Common error details representation.
  kind: object
  properties:
  - name: code
    description: Error code.
    types:
    - uid: string
  - name: target
    description: Error target.
    types:
    - uid: string
  - name: message
    description: Error message.
    types:
    - uid: string
- name: VerbosityLevel
  description: Verbosity level.
  kind: enum
  properties:
  - name: Normal
    types:
    - uid: string
  - name: Minimum
    types:
    - uid: string
  - name: Full
    types:
    - uid: string
- name: NetworkSecurityGroupResult
  description: Network configuration diagnostic result corresponded provided traffic query.
  kind: object
  properties:
  - name: securityRuleAccessResult
    description: The network traffic is allowed or denied.
    types:
    - uid: SecurityRuleAccess
  - name: evaluatedNetworkSecurityGroups
    isReadyOnly: true
    description: List of results network security groups diagnostic.
    types:
    - uid: EvaluatedNetworkSecurityGroup
      isArray: true
- name: SecurityRuleAccess
  description: Whether network traffic is allowed or denied.
  kind: enum
  properties:
  - name: Allow
    types:
    - uid: string
  - name: Deny
    types:
    - uid: string
- name: EvaluatedNetworkSecurityGroup
  description: Results of network security group evaluation.
  kind: object
  properties:
  - name: networkSecurityGroupId
    description: Network security group ID.
    types:
    - uid: string
  - name: appliedTo
    description: Resource ID of nic or subnet to which network security group is applied.
    types:
    - uid: string
  - name: matchedRule
    description: Matched network security rule.
    types:
    - uid: MatchedRule
  - name: rulesEvaluationResult
    isReadyOnly: true
    description: List of network security rules evaluation results.
    types:
    - uid: NetworkSecurityRulesEvaluationResult
      isArray: true
- name: MatchedRule
  description: Matched rule.
  kind: object
  properties:
  - name: ruleName
    description: Name of the matched network security rule.
    types:
    - uid: string
  - name: action
    description: The network traffic is allowed or denied. Possible values are 'Allow' and 'Deny'.
    types:
    - uid: string
- name: NetworkSecurityRulesEvaluationResult
  description: Network security rules evaluation result.
  kind: object
  properties:
  - name: name
    description: Name of the network security rule.
    types:
    - uid: string
  - name: protocolMatched
    description: Value indicating whether protocol is matched.
    types:
    - uid: boolean
  - name: sourceMatched
    description: Value indicating whether source is matched.
    types:
    - uid: boolean
  - name: sourcePortMatched
    description: Value indicating whether source port is matched.
    types:
    - uid: boolean
  - name: destinationMatched
    description: Value indicating whether destination is matched.
    types:
    - uid: boolean
  - name: destinationPortMatched
    description: Value indicating whether destination port is matched.
    types:
    - uid: boolean
examples:
- name: Network configuration diagnostic
  request:
    uri: POST https://management.azure.com/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/networkWatchers/nw1/networkConfigurationDiagnostic?api-version=2022-01-01
    body: >-
      {
        "targetResourceId": "/subscriptions/subid/resourceGroups/rg2/providers/Microsoft.Compute/virtualMachines/vm1",
        "profiles": [
          {
            "direction": "Inbound",
            "protocol": "TCP",
            "source": "10.1.0.4",
            "destination": "12.11.12.14",
            "destinationPort": "12100"
          }
        ]
      }
    codeTab: |+
      # [HTTP](#tab/HTTP)
      ``` http
      POST https://management.azure.com/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/networkWatchers/nw1/networkConfigurationDiagnostic?api-version=2022-01-01

      {
        "targetResourceId": "/subscriptions/subid/resourceGroups/rg2/providers/Microsoft.Compute/virtualMachines/vm1",
        "profiles": [
          {
            "direction": "Inbound",
            "protocol": "TCP",
            "source": "10.1.0.4",
            "destination": "12.11.12.14",
            "destinationPort": "12100"
          }
        ]
      }

      ```

      # [Go](#tab/Go)
      ``` go
      package armnetwork_test

      import (
      	"context"
      	"log"

      	"github.com/Azure/azure-sdk-for-go/sdk/azcore/to"
      	"github.com/Azure/azure-sdk-for-go/sdk/azidentity"
      	"github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/network/armnetwork"
      )

      // Generated from example definition: https://github.com/Azure/azure-rest-api-specs/tree/main/specification/network/resource-manager/Microsoft.Network/stable/2022-01-01/examples/NetworkWatcherNetworkConfigurationDiagnostic.json
      func ExampleWatchersClient_BeginGetNetworkConfigurationDiagnostic() {
      	cred, err := azidentity.NewDefaultAzureCredential(nil)
      	if err != nil {
      		log.Fatalf("failed to obtain a credential: %v", err)
      	}
      	ctx := context.Background()
      	client, err := armnetwork.NewWatchersClient("subid", cred, nil)
      	if err != nil {
      		log.Fatalf("failed to create client: %v", err)
      	}
      	poller, err := client.BeginGetNetworkConfigurationDiagnostic(ctx, "rg1", "nw1", armnetwork.ConfigurationDiagnosticParameters{
      		Profiles: []*armnetwork.ConfigurationDiagnosticProfile{
      			{
      				Destination:     to.Ptr("12.11.12.14"),
      				DestinationPort: to.Ptr("12100"),
      				Direction:       to.Ptr(armnetwork.DirectionInbound),
      				Source:          to.Ptr("10.1.0.4"),
      				Protocol:        to.Ptr("TCP"),
      			}},
      		TargetResourceID: to.Ptr("/subscriptions/subid/resourceGroups/rg2/providers/Microsoft.Compute/virtualMachines/vm1"),
      	}, nil)
      	if err != nil {
      		log.Fatalf("failed to finish the request: %v", err)
      	}
      	res, err := poller.PollUntilDone(ctx, nil)
      	if err != nil {
      		log.Fatalf("failed to pull the result: %v", err)
      	}
      	// TODO: use response item
      	_ = res
      }

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-go/blob/sdk%2Fresourcemanager%2Fnetwork%2Farmnetwork%2Fv1.1.0/sdk/resourcemanager/network/armnetwork/README.md) on how to add the SDK to your project and authenticate.
      # [JavaScript](#tab/JavaScript)
      ``` js
      const { NetworkManagementClient } = require("@azure/arm-network");
      const { DefaultAzureCredential } = require("@azure/identity");

      /**
       * This sample demonstrates how to Gets Network Configuration Diagnostic data to help customers understand and debug network behavior. It provides detailed information on what security rules were applied to a specified traffic flow and the result of evaluating these rules. Customers must provide details of a flow like source, destination, protocol, etc. The API returns whether traffic was allowed or denied, the rules evaluated for the specified flow and the evaluation results.
       *
       * @summary Gets Network Configuration Diagnostic data to help customers understand and debug network behavior. It provides detailed information on what security rules were applied to a specified traffic flow and the result of evaluating these rules. Customers must provide details of a flow like source, destination, protocol, etc. The API returns whether traffic was allowed or denied, the rules evaluated for the specified flow and the evaluation results.
       * x-ms-original-file: specification/network/resource-manager/Microsoft.Network/stable/2022-01-01/examples/NetworkWatcherNetworkConfigurationDiagnostic.json
       */
      async function networkConfigurationDiagnostic() {
        const subscriptionId = "subid";
        const resourceGroupName = "rg1";
        const networkWatcherName = "nw1";
        const parameters = {
          profiles: [
            {
              destination: "12.11.12.14",
              destinationPort: "12100",
              direction: "Inbound",
              source: "10.1.0.4",
              protocol: "TCP",
            },
          ],
          targetResourceId:
            "/subscriptions/subid/resourceGroups/rg2/providers/Microsoft.Compute/virtualMachines/vm1",
        };
        const credential = new DefaultAzureCredential();
        const client = new NetworkManagementClient(credential, subscriptionId);
        const result = await client.networkWatchers.beginGetNetworkConfigurationDiagnosticAndWait(
          resourceGroupName,
          networkWatcherName,
          parameters
        );
        console.log(result);
      }

      networkConfigurationDiagnostic().catch(console.error);

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-js/blob/%40azure%2Farm-network_29.0.0/sdk/network/arm-network/README.md) on how to add the SDK to your project and authenticate.
  responses:
  - statusCode: "200"
    body: >-
      {
        "results": [
          {
            "profile": {
              "direction": "Inbound",
              "protocol": "TCP",
              "source": "10.1.0.4",
              "destination": "12.11.12.14",
              "destinationPort": "12100"
            },
            "networkSecurityGroupResult": {
              "securityRuleAccessResult": "Allow",
              "evaluatedNetworkSecurityGroups": [
                {
                  "networkSecurityGroupId": "/subscriptions/subid/resourceGroups/rg2/providers/Microsoft.Network/networkSecurityGroups/nsg1",
                  "appliedTo": "/subscriptions/subid/resourceGroups/rg2/providers/Microsoft.Network/virtualNetworks/vnet/subnets/AppSubnet",
                  "matchedRule": {
                    "ruleName": "UserRule_fe_rule",
                    "action": "Allow"
                  },
                  "rulesEvaluationResult": [
                    {
                      "name": "UserRule_Cleanuptool-Allow-100",
                      "protocolMatched": true,
                      "sourceMatched": false,
                      "sourcePortMatched": true,
                      "destinationMatched": true,
                      "destinationPortMatched": false
                    },
                    {
                      "name": "UserRule_Cleanuptool-Allow-101",
                      "protocolMatched": true,
                      "sourceMatched": true,
                      "sourcePortMatched": true,
                      "destinationMatched": true,
                      "destinationPortMatched": false
                    },
                    {
                      "name": "UserRule_Cleanuptool-Allow-102",
                      "protocolMatched": true,
                      "sourceMatched": false,
                      "sourcePortMatched": true,
                      "destinationMatched": true,
                      "destinationPortMatched": false
                    },
                    {
                      "name": "UserRule_Cleanuptool-Deny-103",
                      "protocolMatched": true,
                      "sourceMatched": true,
                      "sourcePortMatched": true,
                      "destinationMatched": true,
                      "destinationPortMatched": false
                    },
                    {
                      "name": "UserRule_fe_rule",
                      "protocolMatched": true,
                      "sourceMatched": true,
                      "sourcePortMatched": true,
                      "destinationMatched": true,
                      "destinationPortMatched": true
                    }
                  ]
                },
                {
                  "networkSecurityGroupId": "/subscriptions/61cc8a98-a8be-4bfe-a04e-0b461f93fe35/resourceGroups/NwRgCentralUSEUAP_copy/providers/Microsoft.Network/networkSecurityGroups/AppNSG",
                  "appliedTo": "/subscriptions/subid/resourceGroups/rg2/providers/Microsoft.Network/virtualNetworks/vnet/networkInterfaces/nic",
                  "matchedRule": {
                    "ruleName": "UserRule_fe_rule",
                    "action": "Allow"
                  },
                  "rulesEvaluationResult": [
                    {
                      "name": "UserRule_fe_rule",
                      "protocolMatched": true,
                      "sourceMatched": true,
                      "sourcePortMatched": true,
                      "destinationMatched": true,
                      "destinationPortMatched": true
                    }
                  ]
                }
              ]
            }
          }
        ]
      }
  - statusCode: "202"
    headers:
    - name: Location
      value: https:/management.azure.com/subscriptions/subid/resourceGroups/rg1/providers/Microsoft.Network/networkWatchers/nw1/networkConfigurationDiagnostic?api-version=2022-01-01
    body: >-
      {
        "results": [
          {
            "profile": {
              "direction": "Inbound",
              "protocol": "TCP",
              "source": "10.1.0.4",
              "destination": "12.11.12.14",
              "destinationPort": "12100"
            },
            "networkSecurityGroupResult": {
              "securityRuleAccessResult": "Allow",
              "evaluatedNetworkSecurityGroups": [
                {
                  "networkSecurityGroupId": "/subscriptions/subid/resourceGroups/rg2/providers/Microsoft.Network/networkSecurityGroups/nsg1",
                  "appliedTo": "/subscriptions/subid/resourceGroups/rg2/providers/Microsoft.Network/virtualNetworks/vnet/subnets/AppSubnet",
                  "matchedRule": {
                    "ruleName": "UserRule_fe_rule",
                    "action": "Allow"
                  },
                  "rulesEvaluationResult": [
                    {
                      "name": "UserRule_Cleanuptool-Allow-100",
                      "protocolMatched": true,
                      "sourceMatched": false,
                      "sourcePortMatched": true,
                      "destinationMatched": true,
                      "destinationPortMatched": false
                    },
                    {
                      "name": "UserRule_Cleanuptool-Allow-101",
                      "protocolMatched": true,
                      "sourceMatched": true,
                      "sourcePortMatched": true,
                      "destinationMatched": true,
                      "destinationPortMatched": false
                    },
                    {
                      "name": "UserRule_Cleanuptool-Allow-102",
                      "protocolMatched": true,
                      "sourceMatched": false,
                      "sourcePortMatched": true,
                      "destinationMatched": true,
                      "destinationPortMatched": false
                    },
                    {
                      "name": "UserRule_Cleanuptool-Deny-103",
                      "protocolMatched": true,
                      "sourceMatched": true,
                      "sourcePortMatched": true,
                      "destinationMatched": true,
                      "destinationPortMatched": false
                    },
                    {
                      "name": "UserRule_fe_rule",
                      "protocolMatched": true,
                      "sourceMatched": true,
                      "sourcePortMatched": true,
                      "destinationMatched": true,
                      "destinationPortMatched": true
                    }
                  ]
                },
                {
                  "networkSecurityGroupId": "/subscriptions/61cc8a98-a8be-4bfe-a04e-0b461f93fe35/resourceGroups/NwRgCentralUSEUAP_copy/providers/Microsoft.Network/networkSecurityGroups/AppNSG",
                  "appliedTo": "/subscriptions/subid/resourceGroups/rg2/providers/Microsoft.Network/virtualNetworks/vnet/networkInterfaces/nic",
                  "matchedRule": {
                    "ruleName": "UserRule_fe_rule",
                    "action": "Allow"
                  },
                  "rulesEvaluationResult": [
                    {
                      "name": "UserRule_fe_rule",
                      "protocolMatched": true,
                      "sourceMatched": true,
                      "sourcePortMatched": true,
                      "destinationMatched": true,
                      "destinationPortMatched": true
                    }
                  ]
                }
              ]
            }
          }
        ]
      }
security:
- name: azure_auth
  type: oauth2
  description: Azure Active Directory OAuth2 Flow.
  flow: implicit
  authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
  scopes:
  - name: user_impersonation
    description: impersonate your user account
metadata:
  description: Gets Network Configuration Diagnostic data to help customers understand and debug network behavior. It provides detailed information on what security rules were
errorCodes: []
