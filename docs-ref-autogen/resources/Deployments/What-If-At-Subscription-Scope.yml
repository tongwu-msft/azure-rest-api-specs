### YamlMime:RESTOperation
uid: management.azure.com.resources.deployments.whatifatsubscriptionscope
name: What If At Subscription Scope
service: Resource Management
groupName: Deployments
apiVersion: 2021-04-01
summary: Returns changes that will be made by the deployment if executed at the scope of the subscription.
consumes:
- application/json
produces:
- application/json
paths:
- content: POST https://management.azure.com/subscriptions/{subscriptionId}/providers/Microsoft.Resources/deployments/{deploymentName}/whatIf?api-version=2021-04-01
uriParameters:
- name: subscriptionId
  in: path
  isRequired: true
  description: The Microsoft Azure subscription ID.
  types:
  - uid: string
- name: deploymentName
  in: path
  isRequired: true
  description: The name of the deployment.
  types:
  - uid: string
  pattern: ^[-\w\._\(\)]+$
- name: api-version
  in: query
  isRequired: true
  description: The API version to use for this operation.
  types:
  - uid: string
responses:
- name: 200 OK
  description: OK - Returns What-If operation status
  types:
  - uid: WhatIfOperationResult
- name: 202 Accepted
  headers:
  - name: Location
    value: string
  - name: Retry-After
    value: string
  description: Accepted - Returns URL in Location header to query for long-running operation status.
- name: Other Status Codes
  description: Error response describing why the operation failed.
  types:
  - uid: CloudError
requestBody:
- name: default
  parameters:
  - name: location
    in: body
    description: The location to store the deployment data.
    types:
    - uid: string
  - name: properties
    in: body
    isRequired: true
    description: The deployment properties.
    types:
    - uid: DeploymentWhatIfProperties
requestHeader: []
definitions:
- name: DeploymentWhatIfProperties
  description: Deployment What-if properties.
  kind: object
  properties:
  - name: whatIfSettings
    description: Optional What-If operation settings.
    types:
    - uid: DeploymentWhatIfSettings
  - name: template
    description: The template content. You use this element when you want to pass the template syntax directly in the request rather than link to an existing template. It can be a JObject or well-formed JSON string. Use either the templateLink property or the template property, but not both.
    types:
    - uid: object
  - name: templateLink
    description: The URI of the template. Use either the templateLink property or the template property, but not both.
    types:
    - uid: TemplateLink
  - name: parameters
    description: Name and value pairs that define the deployment parameters for the template. You use this element when you want to provide the parameter values directly in the request rather than link to an existing parameter file. Use either the parametersLink property or the parameters property, but not both. It can be a JObject or a well formed JSON string.
    types:
    - uid: object
  - name: parametersLink
    description: The URI of parameters file. You use this element to link to an existing parameters file. Use either the parametersLink property or the parameters property, but not both.
    types:
    - uid: ParametersLink
  - name: mode
    description: The mode that is used to deploy resources. This value can be either Incremental or Complete. In Incremental mode, resources are deployed without deleting existing resources that are not included in the template. In Complete mode, resources are deployed and existing resources in the resource group that are not included in the template are deleted. Be careful when using Complete mode as you may unintentionally delete resources.
    types:
    - uid: DeploymentMode
  - name: debugSetting
    description: The debug setting of the deployment.
    types:
    - uid: DebugSetting
  - name: onErrorDeployment
    description: The deployment on error behavior.
    types:
    - uid: OnErrorDeployment
  - name: expressionEvaluationOptions
    description: Specifies whether template expressions are evaluated within the scope of the parent template or nested template. Only applicable to nested templates. If not specified, default value is outer.
    types:
    - uid: ExpressionEvaluationOptions
- name: WhatIfOperationResult
  description: Result of the What-If operation. Contains a list of predicted changes and a URL link to get to the next set of results.
  kind: object
  properties:
  - name: status
    description: Status of the What-If operation.
    types:
    - uid: string
  - name: error
    description: "Error Response  \nError when What-If operation fails."
    types:
    - uid: ErrorResponse
  - name: properties.changes
    description: List of resource changes predicted by What-If operation.
    types:
    - uid: WhatIfChange
      isArray: true
- name: CloudError
  description: An error response for a resource management request.
  kind: object
  properties:
  - name: error
    description: "Error Response  \nCommon error response for all Azure Resource Manager APIs to return error details for failed operations. (This also follows the OData error response format.)"
    types:
    - uid: ErrorResponse
- name: DeploymentWhatIf
  description: Deployment What-if operation parameters.
  kind: object
  properties:
  - name: location
    description: The location to store the deployment data.
    types:
    - uid: string
  - name: properties
    description: The deployment properties.
    types:
    - uid: DeploymentWhatIfProperties
- name: DeploymentWhatIfSettings
  description: Deployment What-If operation settings.
  kind: object
  properties:
  - name: resultFormat
    description: The format of the What-If results
    types:
    - uid: WhatIfResultFormat
- name: TemplateLink
  description: Entity representing the reference to the template.
  kind: object
  properties:
  - name: uri
    description: The URI of the template to deploy. Use either the uri or id property, but not both.
    types:
    - uid: string
  - name: id
    description: The resource id of a Template Spec. Use either the id or uri property, but not both.
    types:
    - uid: string
  - name: relativePath
    description: The relativePath property can be used to deploy a linked template at a location relative to the parent. If the parent template was linked with a TemplateSpec, this will reference an artifact in the TemplateSpec.  If the parent was linked with a URI, the child deployment will be a combination of the parent and relativePath URIs
    types:
    - uid: string
  - name: contentVersion
    description: If included, must match the ContentVersion in the template.
    types:
    - uid: string
  - name: queryString
    description: The query string (for example, a SAS token) to be used with the templateLink URI.
    types:
    - uid: string
- name: ParametersLink
  description: Entity representing the reference to the deployment parameters.
  kind: object
  properties:
  - name: uri
    description: The URI of the parameters file.
    types:
    - uid: string
  - name: contentVersion
    description: If included, must match the ContentVersion in the template.
    types:
    - uid: string
- name: DeploymentMode
  description: The mode that is used to deploy resources. This value can be either Incremental or Complete. In Incremental mode, resources are deployed without deleting existing resources that are not included in the template. In Complete mode, resources are deployed and existing resources in the resource group that are not included in the template are deleted. Be careful when using Complete mode as you may unintentionally delete resources.
  kind: enum
  properties:
  - name: Incremental
    types:
    - uid: string
  - name: Complete
    types:
    - uid: string
- name: DebugSetting
  description: The debug setting.
  kind: object
  properties:
  - name: detailLevel
    description: Specifies the type of information to log for debugging. The permitted values are none, requestContent, responseContent, or both requestContent and responseContent separated by a comma. The default is none. When setting this value, carefully consider the type of information you are passing in during deployment. By logging information about the request or response, you could potentially expose sensitive data that is retrieved through the deployment operations.
    types:
    - uid: string
- name: OnErrorDeployment
  description: Deployment on error behavior.
  kind: object
  properties:
  - name: type
    description: The deployment on error behavior type. Possible values are LastSuccessful and SpecificDeployment.
    types:
    - uid: OnErrorDeploymentType
  - name: deploymentName
    description: The deployment to be used on error case.
    types:
    - uid: string
- name: ExpressionEvaluationOptions
  description: Specifies whether template expressions are evaluated within the scope of the parent template or nested template.
  kind: object
  properties:
  - name: scope
    description: The scope to be used for evaluation of parameters, variables and functions in a nested template.
    types:
    - uid: ExpressionEvaluationOptionsScopeType
- name: ErrorResponse
  description: Error Response
  kind: object
  properties:
  - name: code
    isReadyOnly: true
    description: The error code.
    types:
    - uid: string
  - name: message
    isReadyOnly: true
    description: The error message.
    types:
    - uid: string
  - name: target
    isReadyOnly: true
    description: The error target.
    types:
    - uid: string
  - name: details
    isReadyOnly: true
    description: The error details.
    types:
    - uid: ErrorResponse
      isArray: true
  - name: additionalInfo
    isReadyOnly: true
    description: The error additional info.
    types:
    - uid: ErrorAdditionalInfo
      isArray: true
- name: WhatIfChange
  description: Information about a single resource change predicted by What-If operation.
  kind: object
  properties:
  - name: resourceId
    description: Resource ID
    types:
    - uid: string
  - name: changeType
    description: Type of change that will be made to the resource when the deployment is executed.
    types:
    - uid: ChangeType
  - name: unsupportedReason
    description: The explanation about why the resource is unsupported by What-If.
    types:
    - uid: string
  - name: before
    description: The snapshot of the resource before the deployment is executed.
    types:
    - uid: object
  - name: after
    description: The predicted snapshot of the resource after the deployment is executed.
    types:
    - uid: object
  - name: delta
    description: The predicted changes to resource properties.
    types:
    - uid: WhatIfPropertyChange
      isArray: true
- name: WhatIfResultFormat
  description: The format of the What-If results
  kind: enum
  properties:
  - name: ResourceIdOnly
    types:
    - uid: string
  - name: FullResourcePayloads
    types:
    - uid: string
- name: OnErrorDeploymentType
  description: The deployment on error behavior type. Possible values are LastSuccessful and SpecificDeployment.
  kind: enum
  properties:
  - name: LastSuccessful
    types:
    - uid: string
  - name: SpecificDeployment
    types:
    - uid: string
- name: ExpressionEvaluationOptionsScopeType
  description: The scope to be used for evaluation of parameters, variables and functions in a nested template.
  kind: enum
  properties:
  - name: NotSpecified
    types:
    - uid: string
  - name: Outer
    types:
    - uid: string
  - name: Inner
    types:
    - uid: string
- name: ErrorAdditionalInfo
  description: The resource management error additional info.
  kind: object
  properties:
  - name: type
    isReadyOnly: true
    description: The additional info type.
    types:
    - uid: string
  - name: info
    isReadyOnly: true
    description: The additional info.
    types:
    - uid: object
- name: ChangeType
  description: Type of change that will be made to the resource when the deployment is executed.
  kind: enum
  properties:
  - name: Create
    description: The resource does not exist in the current state but is present in the desired state. The resource will be created when the deployment is executed.
    types:
    - uid: string
  - name: Delete
    description: The resource exists in the current state and is missing from the desired state. The resource will be deleted when the deployment is executed.
    types:
    - uid: string
  - name: Ignore
    description: The resource exists in the current state and is missing from the desired state. The resource will not be deployed or modified when the deployment is executed.
    types:
    - uid: string
  - name: Deploy
    description: The resource exists in the current state and the desired state and will be redeployed when the deployment is executed. The properties of the resource may or may not change.
    types:
    - uid: string
  - name: NoChange
    description: The resource exists in the current state and the desired state and will be redeployed when the deployment is executed. The properties of the resource will not change.
    types:
    - uid: string
  - name: Modify
    description: The resource exists in the current state and the desired state and will be redeployed when the deployment is executed. The properties of the resource will change.
    types:
    - uid: string
  - name: Unsupported
    description: The resource is not supported by What-If.
    types:
    - uid: string
- name: WhatIfPropertyChange
  description: The predicted change to the resource property.
  kind: object
  properties:
  - name: path
    description: The path of the property.
    types:
    - uid: string
  - name: propertyChangeType
    description: The type of property change.
    types:
    - uid: PropertyChangeType
  - name: before
    description: The value of the property before the deployment is executed.
    types:
    - uid: object
  - name: after
    description: The value of the property after the deployment is executed.
    types:
    - uid: object
  - name: children
    description: Nested property changes.
    types:
    - uid: WhatIfPropertyChange
      isArray: true
- name: PropertyChangeType
  description: The type of property change.
  kind: enum
  properties:
  - name: Create
    description: The property does not exist in the current state but is present in the desired state. The property will be created when the deployment is executed.
    types:
    - uid: string
  - name: Delete
    description: The property exists in the current state and is missing from the desired state. It will be deleted when the deployment is executed.
    types:
    - uid: string
  - name: Modify
    description: The property exists in both current and desired state and is different. The value of the property will change when the deployment is executed.
    types:
    - uid: string
  - name: Array
    description: The property is an array and contains nested changes.
    types:
    - uid: string
  - name: NoEffect
    description: The property will not be set or updated.
    types:
    - uid: string
examples:
- name: Predict template changes at subscription scope
  request:
    uri: POST https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000001/providers/Microsoft.Resources/deployments/my-deployment/whatIf?api-version=2021-04-01
    body: >-
      {
        "location": "westus",
        "properties": {
          "templateLink": {
            "uri": "https://example.com/exampleTemplate.json"
          },
          "parameters": {},
          "mode": "Incremental"
        }
      }
    codeTab: |+
      # [HTTP](#tab/HTTP)
      ``` http
      POST https://management.azure.com/subscriptions/00000000-0000-0000-0000-000000000001/providers/Microsoft.Resources/deployments/my-deployment/whatIf?api-version=2021-04-01

      {
        "location": "westus",
        "properties": {
          "templateLink": {
            "uri": "https://example.com/exampleTemplate.json"
          },
          "parameters": {},
          "mode": "Incremental"
        }
      }

      ```

      # [Go](#tab/Go)
      ``` go
      package armresources_test

      import (
      	"context"
      	"log"

      	"github.com/Azure/azure-sdk-for-go/sdk/azcore/to"
      	"github.com/Azure/azure-sdk-for-go/sdk/azidentity"
      	"github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/resources/armresources"
      )

      // Generated from example definition: https://github.com/Azure/azure-rest-api-specs/tree/main/specification/resources/resource-manager/Microsoft.Resources/stable/2021-04-01/examples/PostDeploymentWhatIfOnSubscription.json
      func ExampleDeploymentsClient_BeginWhatIfAtSubscriptionScope() {
      	cred, err := azidentity.NewDefaultAzureCredential(nil)
      	if err != nil {
      		log.Fatalf("failed to obtain a credential: %v", err)
      	}
      	ctx := context.Background()
      	client, err := armresources.NewDeploymentsClient("00000000-0000-0000-0000-000000000001", cred, nil)
      	if err != nil {
      		log.Fatalf("failed to create client: %v", err)
      	}
      	poller, err := client.BeginWhatIfAtSubscriptionScope(ctx,
      		"my-deployment",
      		armresources.DeploymentWhatIf{
      			Location: to.Ptr("westus"),
      			Properties: &armresources.DeploymentWhatIfProperties{
      				Mode:         to.Ptr(armresources.DeploymentModeIncremental),
      				Parameters:   map[string]interface{}{},
      				TemplateLink: &armresources.TemplateLink{},
      			},
      		},
      		nil)
      	if err != nil {
      		log.Fatalf("failed to finish the request: %v", err)
      	}
      	res, err := poller.PollUntilDone(ctx, nil)
      	if err != nil {
      		log.Fatalf("failed to pull the result: %v", err)
      	}
      	// TODO: use response item
      	_ = res
      }

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-go/blob/sdk%2Fresourcemanager%2Fresources%2Farmresources%2Fv1.0.0/sdk/resourcemanager/resources/armresources/README.md) on how to add the SDK to your project and authenticate.
      # [JavaScript](#tab/JavaScript)
      ``` js
      const { ResourceManagementClient } = require("@azure/arm-resources");
      const { DefaultAzureCredential } = require("@azure/identity");

      /**
       * This sample demonstrates how to Returns changes that will be made by the deployment if executed at the scope of the subscription.
       *
       * @summary Returns changes that will be made by the deployment if executed at the scope of the subscription.
       * x-ms-original-file: specification/resources/resource-manager/Microsoft.Resources/stable/2021-04-01/examples/PostDeploymentWhatIfOnSubscription.json
       */
      async function predictTemplateChangesAtSubscriptionScope() {
        const subscriptionId = "00000000-0000-0000-0000-000000000001";
        const deploymentName = "my-deployment";
        const parameters = {
          location: "westus",
          properties: { mode: "Incremental", parameters: {}, templateLink: {} },
        };
        const credential = new DefaultAzureCredential();
        const client = new ResourceManagementClient(credential, subscriptionId);
        const result = await client.deployments.beginWhatIfAtSubscriptionScopeAndWait(
          deploymentName,
          parameters
        );
        console.log(result);
      }

      predictTemplateChangesAtSubscriptionScope().catch(console.error);

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-js/blob/%40azure%2Farm-resources_5.0.1/sdk/resources/arm-resources/README.md) on how to add the SDK to your project and authenticate.
  responses:
  - statusCode: "200"
    body: >-
      {
        "status": "Succeeded",
        "properties": {
          "changes": [
            {
              "resourceId": "/subscriptions/00000000-0000-0000-0000-000000000001/resourceGroups/my-resource-group/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myExistingIdentity",
              "changeType": "Modify",
              "before": {
                "apiVersion": "2018-11-30",
                "id": "/subscriptions/00000000-0000-0000-0000-000000000001/resourceGroups/my-resource-group/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myExistingIdentity",
                "type": "Microsoft.ManagedIdentity/userAssignedIdentities",
                "name": "myExistingIdentity",
                "location": "westus2"
              },
              "after": {
                "apiVersion": "2018-11-30",
                "id": "/subscriptions/00000000-0000-0000-0000-000000000001/resourceGroups/my-resource-group/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myExistingIdentity",
                "type": "Microsoft.ManagedIdentity/userAssignedIdentities",
                "name": "myExistingIdentity",
                "location": "westus2",
                "tags": {
                  "myNewTag": "my tag value"
                }
              },
              "delta": [
                {
                  "path": "tags.myNewTag",
                  "propertyChangeType": "Create",
                  "after": "my tag value"
                }
              ]
            },
            {
              "resourceId": "/subscriptions/00000000-0000-0000-0000-000000000001/resourceGroups/my-resource-group/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myNewIdentity",
              "changeType": "Create",
              "after": {
                "apiVersion": "2018-11-30",
                "id": "/subscriptions/00000000-0000-0000-0000-000000000001/resourceGroups/my-resource-group/providers/Microsoft.ManagedIdentity/userAssignedIdentities/myNewIdentity",
                "type": "Microsoft.ManagedIdentity/userAssignedIdentities",
                "name": "myNewIdentity",
                "location": "eastus",
                "tags": {
                  "myOtherNewTag": "another new tag value"
                }
              }
            },
            {
              "resourceId": "/subscriptions/00000000-0000-0000-0000-000000000001/resourceGroups/my-resource-group2",
              "changeType": "Create",
              "after": {
                "apiVersion": "2019-03-01",
                "id": "/subscriptions/00000000-0000-0000-0000-000000000001/resourceGroups/my-resource-group2",
                "type": "Microsoft.Resources/resourceGroups",
                "name": "my-resource-group2",
                "location": "{location3}"
              }
            }
          ]
        }
      }
  - statusCode: "202"
    headers:
    - name: Location
      value: /subscriptions/00000000-0000-0000-0000-000000000000/ZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZZ
security:
- name: azure_auth
  type: oauth2
  description: Azure Active Directory OAuth2 Flow
  flow: implicit
  authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
  scopes:
  - name: user_impersonation
    description: impersonate your user account
metadata:
  description: Learn more about Resource Management service - Returns changes that will be made by the deployment if executed at the scope of the subscription.
errorCodes: []
