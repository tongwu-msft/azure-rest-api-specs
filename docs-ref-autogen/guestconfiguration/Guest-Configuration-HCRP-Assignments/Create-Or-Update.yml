### YamlMime:RESTOperation
uid: management.azure.com.guestconfiguration.guestconfigurationhcrpassignments.createorupdate
name: Create Or Update
service: Guest Configuration
groupName: Guest Configuration HCRP Assignments
apiVersion: 2020-06-25
summary: Creates an association between a ARC machine and guest configuration
consumes:
- application/json
produces:
- application/json
paths:
- content: PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.HybridCompute/machines/{machineName}/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/{guestConfigurationAssignmentName}?api-version=2020-06-25
uriParameters:
- name: subscriptionId
  in: path
  isRequired: true
  description: Subscription ID which uniquely identify Microsoft Azure subscription. The subscription ID forms part of the URI for every service call.
  types:
  - uid: string
- name: resourceGroupName
  in: path
  isRequired: true
  description: The resource group name.
  types:
  - uid: string
  pattern: ^[-\w\._]+$
- name: machineName
  in: path
  isRequired: true
  description: The name of the ARC machine.
  types:
  - uid: string
- name: guestConfigurationAssignmentName
  in: path
  isRequired: true
  description: Name of the guest configuration assignment.
  types:
  - uid: string
- name: api-version
  in: query
  isRequired: true
  description: Client Api Version.
  types:
  - uid: string
responses:
- name: 201 Created
  description: Created. The guest configuration assignment for the ARC machine was created successfully.
  types:
  - uid: GuestConfigurationAssignment
- name: 200 OK
  description: OK. The guest configuration assignment for the ARC machine was updated successfully.
  types:
  - uid: GuestConfigurationAssignment
- name: Other Status Codes
  description: Error response describing why the operation failed.
  types:
  - uid: ErrorResponse
requestBody:
- name: default
  parameters:
  - name: properties
    in: body
    description: Properties of the Guest configuration assignment.
    types:
    - uid: GuestConfigurationAssignmentProperties
  - name: name
    in: body
    description: Name of the guest configuration assignment.
    types:
    - uid: string
  - name: location
    in: body
    description: Region where the VM is located.
    types:
    - uid: string
requestHeader: []
definitions:
- name: GuestConfigurationAssignmentProperties
  description: Guest configuration assignment properties.
  kind: object
  properties:
  - name: targetResourceId
    isReadyOnly: true
    description: VM resource Id.
    types:
    - uid: string
  - name: guestConfiguration
    description: The guest configuration to assign.
    types:
    - uid: GuestConfigurationNavigation
  - name: complianceStatus
    isReadyOnly: true
    description: A value indicating compliance status of the machine for the assigned guest configuration.
    types:
    - uid: complianceStatus
  - name: lastComplianceStatusChecked
    isReadyOnly: true
    description: Date and time when last compliance status was checked.
    types:
    - uid: string
  - name: latestReportId
    isReadyOnly: true
    description: 'Id of the latest report for the guest configuration assignment. '
    types:
    - uid: string
  - name: parameterHash
    isReadyOnly: true
    description: 'parameter hash for the guest configuration assignment. '
    types:
    - uid: string
  - name: resourceType
    isReadyOnly: true
    description: Type of the resource - VMSS / VM
    types:
    - uid: string
  - name: vmssVMList
    description: The list of VM Compliance data for VMSS
    types:
    - uid: VMSSVMInfo
      isArray: true
  - name: latestAssignmentReport
    description: Last reported guest configuration assignment report.
    types:
    - uid: AssignmentReport
  - name: context
    description: 'The source which initiated the guest configuration assignment. Ex: Azure Policy'
    types:
    - uid: string
  - name: assignmentHash
    isReadyOnly: true
    description: Combined hash of the configuration package and parameters.
    types:
    - uid: string
  - name: provisioningState
    isReadyOnly: true
    description: The provisioning state, which only appears in the response.
    types:
    - uid: provisioningState
- name: GuestConfigurationAssignment
  description: Guest configuration assignment is an association between a machine and guest configuration.
  kind: object
  properties:
  - name: properties
    description: Properties of the Guest configuration assignment.
    types:
    - uid: GuestConfigurationAssignmentProperties
  - name: id
    isReadyOnly: true
    description: ARM resource id of the guest configuration assignment.
    types:
    - uid: string
  - name: name
    description: Name of the guest configuration assignment.
    types:
    - uid: string
  - name: location
    description: Region where the VM is located.
    types:
    - uid: string
  - name: type
    isReadyOnly: true
    description: The type of the resource.
    types:
    - uid: string
- name: ErrorResponse
  description: Error response of an operation failure
  kind: object
  properties:
  - name: error
    description: ''
    types:
    - uid: Error
- name: GuestConfigurationNavigation
  description: Guest configuration is an artifact that encapsulates DSC configuration and its dependencies. The artifact is a zip file containing DSC configuration (as MOF) and dependent resources and other dependencies like modules.
  kind: object
  properties:
  - name: kind
    description: Kind of the guest configuration. For example:DSC
    types:
    - uid: kind
  - name: name
    description: Name of the guest configuration.
    types:
    - uid: string
  - name: version
    description: Version of the guest configuration.
    types:
    - uid: string
  - name: contentUri
    description: Uri of the storage where guest configuration package is uploaded.
    types:
    - uid: string
  - name: contentHash
    description: Combined hash of the guest configuration package and configuration parameters.
    types:
    - uid: string
  - name: assignmentType
    description: Specifies the assignment type and execution of the configuration. Possible values are Audit, DeployAndAutoCorrect, ApplyAndAutoCorrect and ApplyAndMonitor.
    types:
    - uid: assignmentType
  - name: contentType
    isReadyOnly: true
    description: Specifies the content type of the configuration. Possible values could be Builtin or Custom.
    types:
    - uid: string
  - name: configurationParameter
    description: The configuration parameters for the guest configuration.
    types:
    - uid: ConfigurationParameter
      isArray: true
  - name: configurationProtectedParameter
    description: The protected configuration parameters for the guest configuration.
    types:
    - uid: ConfigurationParameter
      isArray: true
  - name: configurationSetting
    description: The configuration setting for the guest configuration.
    types:
    - uid: ConfigurationSetting
- name: complianceStatus
  description: A value indicating compliance status of the machine for the assigned guest configuration.
  kind: enum
  properties:
  - name: Compliant
    types:
    - uid: string
  - name: NonCompliant
    types:
    - uid: string
  - name: Pending
    types:
    - uid: string
- name: VMSSVMInfo
  description: Information about VMSS VM
  kind: object
  properties:
  - name: vmId
    isReadyOnly: true
    description: UUID of the VM.
    types:
    - uid: string
  - name: vmResourceId
    isReadyOnly: true
    description: Azure resource Id of the VM.
    types:
    - uid: string
  - name: complianceStatus
    isReadyOnly: true
    description: A value indicating compliance status of the machine for the assigned guest configuration.
    types:
    - uid: complianceStatus
  - name: latestReportId
    isReadyOnly: true
    description: 'Id of the latest report for the guest configuration assignment. '
    types:
    - uid: string
  - name: lastComplianceChecked
    isReadyOnly: true
    description: Date and time when last compliance status was checked.
    types:
    - uid: string
- name: AssignmentReport
  kind: object
  properties:
  - name: id
    isReadyOnly: true
    description: ARM resource id of the report for the guest configuration assignment.
    types:
    - uid: string
  - name: reportId
    isReadyOnly: true
    description: GUID that identifies the guest configuration assignment report under a subscription, resource group.
    types:
    - uid: string
  - name: assignment
    description: Configuration details of the guest configuration assignment.
    types:
    - uid: AssignmentInfo
  - name: vm
    description: Information about the VM.
    types:
    - uid: VMInfo
  - name: startTime
    isReadyOnly: true
    description: Start date and time of the guest configuration assignment compliance status check.
    types:
    - uid: string
  - name: endTime
    isReadyOnly: true
    description: End date and time of the guest configuration assignment compliance status check.
    types:
    - uid: string
  - name: complianceStatus
    isReadyOnly: true
    description: A value indicating compliance status of the machine for the assigned guest configuration.
    types:
    - uid: complianceStatus
  - name: operationType
    isReadyOnly: true
    description: Type of report, Consistency or Initial
    types:
    - uid: type
  - name: resources
    description: The list of resources for which guest configuration assignment compliance is checked.
    types:
    - uid: AssignmentReportResource
      isArray: true
- name: provisioningState
  description: The provisioning state, which only appears in the response.
  kind: enum
  properties:
  - name: Succeeded
    types:
    - uid: string
  - name: Failed
    types:
    - uid: string
  - name: Canceled
    types:
    - uid: string
  - name: Created
    types:
    - uid: string
- name: Error
  kind: object
  properties:
  - name: code
    description: Error code.
    types:
    - uid: string
  - name: message
    description: Detail error message indicating why the operation failed.
    types:
    - uid: string
- name: kind
  description: Kind of the guest configuration. For example:DSC
  kind: enum
  properties:
  - name: DSC
    types:
    - uid: string
- name: assignmentType
  description: Specifies the assignment type and execution of the configuration. Possible values are Audit, DeployAndAutoCorrect, ApplyAndAutoCorrect and ApplyAndMonitor.
  kind: enum
  properties:
  - name: Audit
    types:
    - uid: string
  - name: DeployAndAutoCorrect
    types:
    - uid: string
  - name: ApplyAndAutoCorrect
    types:
    - uid: string
  - name: ApplyAndMonitor
    types:
    - uid: string
- name: ConfigurationParameter
  description: Represents a configuration parameter.
  kind: object
  properties:
  - name: name
    description: Name of the configuration parameter.
    types:
    - uid: string
  - name: value
    description: Value of the configuration parameter.
    types:
    - uid: string
- name: ConfigurationSetting
  description: Configuration setting of LCM (Local Configuration Manager).
  kind: object
  properties:
  - name: configurationMode
    description: Specifies how the LCM(Local Configuration Manager) actually applies the configuration to the target nodes. Possible values are ApplyOnly, ApplyAndMonitor, and ApplyAndAutoCorrect.
    types:
    - uid: configurationMode
  - name: allowModuleOverwrite
    description: If true - new configurations downloaded from the pull service are allowed to overwrite the old ones on the target node. Otherwise, false
    types:
    - uid: boolean
  - name: actionAfterReboot
    description: Specifies what happens after a reboot during the application of a configuration. The possible values are ContinueConfiguration and StopConfiguration
    types:
    - uid: actionAfterReboot
  - name: refreshFrequencyMins
    description: The time interval, in minutes, at which the LCM checks a pull service to get updated configurations. This value is ignored if the LCM is not configured in pull mode. The default value is 30.
    types:
    - uid: number
    defaultValue: 30
  - name: rebootIfNeeded
    description: Set this to true to automatically reboot the node after a configuration that requires reboot is applied. Otherwise, you will have to manually reboot the node for any configuration that requires it. The default value is false. To use this setting when a reboot condition is enacted by something other than DSC (such as Windows Installer), combine this setting with the xPendingReboot module.
    types:
    - uid: boolean
  - name: configurationModeFrequencyMins
    description: How often, in minutes, the current configuration is checked and applied. This property is ignored if the ConfigurationMode property is set to ApplyOnly. The default value is 15.
    types:
    - uid: number
    defaultValue: 15
- name: AssignmentInfo
  description: Information about the guest configuration assignment.
  kind: object
  properties:
  - name: name
    isReadyOnly: true
    description: Name of the guest configuration assignment.
    types:
    - uid: string
  - name: configuration
    description: Information about the configuration.
    types:
    - uid: ConfigurationInfo
- name: VMInfo
  description: Information about the VM.
  kind: object
  properties:
  - name: id
    isReadyOnly: true
    description: Azure resource Id of the VM.
    types:
    - uid: string
  - name: uuid
    isReadyOnly: true
    description: UUID(Universally Unique Identifier) of the VM.
    types:
    - uid: string
- name: type
  description: Type of report, Consistency or Initial
  kind: enum
  properties:
  - name: Consistency
    types:
    - uid: string
  - name: Initial
    types:
    - uid: string
- name: AssignmentReportResource
  description: The guest configuration assignment resource.
  kind: object
  properties:
  - name: complianceStatus
    isReadyOnly: true
    description: A value indicating compliance status of the machine for the assigned guest configuration.
    types:
    - uid: complianceStatus
  - name: resourceId
    isReadyOnly: true
    description: Name of the guest configuration assignment resource setting.
    types:
    - uid: string
  - name: reasons
    description: Compliance reason and reason code for a resource.
    types:
    - uid: AssignmentReportResourceComplianceReason
      isArray: true
  - name: properties
    isReadyOnly: true
    description: Properties of a guest configuration assignment resource.
    types:
    - uid: object
- name: configurationMode
  description: Specifies how the LCM(Local Configuration Manager) actually applies the configuration to the target nodes. Possible values are ApplyOnly, ApplyAndMonitor, and ApplyAndAutoCorrect.
  kind: enum
  properties:
  - name: ApplyOnly
    types:
    - uid: string
  - name: ApplyAndMonitor
    types:
    - uid: string
  - name: ApplyAndAutoCorrect
    types:
    - uid: string
- name: actionAfterReboot
  description: Specifies what happens after a reboot during the application of a configuration. The possible values are ContinueConfiguration and StopConfiguration
  kind: enum
  properties:
  - name: ContinueConfiguration
    types:
    - uid: string
  - name: StopConfiguration
    types:
    - uid: string
- name: ConfigurationInfo
  description: Information about the configuration.
  kind: object
  properties:
  - name: name
    isReadyOnly: true
    description: Name of the configuration.
    types:
    - uid: string
  - name: version
    isReadyOnly: true
    description: Version of the configuration.
    types:
    - uid: string
- name: AssignmentReportResourceComplianceReason
  description: Reason and code for the compliance of the guest configuration assignment resource.
  kind: object
  properties:
  - name: phrase
    isReadyOnly: true
    description: Reason for the compliance of the guest configuration assignment resource.
    types:
    - uid: string
  - name: code
    isReadyOnly: true
    description: Code for the compliance of the guest configuration assignment resource.
    types:
    - uid: string
examples:
- name: Create or update guest configuration assignment
  request:
    uri: PUT https://management.azure.com/subscriptions/mySubscriptionId/resourceGroups/myResourceGroupName/providers/Microsoft.HybridCompute/machines/myMachineName/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/WhitelistedApplication?api-version=2020-06-25
    body: >-
      {
        "location": "westcentralus",
        "name": "WhitelistedApplication",
        "properties": {
          "context": "Azure policy",
          "guestConfiguration": {
            "name": "WhitelistedApplication",
            "version": "1.*",
            "contentUri": "https://thisisfake/pacakge",
            "contentHash": "123contenthash",
            "assignmentType": "ApplyAndAutoCorrect",
            "configurationParameter": [
              {
                "name": "[InstalledApplication]bwhitelistedapp;Name",
                "value": "NotePad,sql"
              }
            ]
          }
        }
      }
    codeTab: |+
      # [HTTP](#tab/HTTP)
      ``` http
      PUT https://management.azure.com/subscriptions/mySubscriptionId/resourceGroups/myResourceGroupName/providers/Microsoft.HybridCompute/machines/myMachineName/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/WhitelistedApplication?api-version=2020-06-25

      {
        "location": "westcentralus",
        "name": "WhitelistedApplication",
        "properties": {
          "context": "Azure policy",
          "guestConfiguration": {
            "name": "WhitelistedApplication",
            "version": "1.*",
            "contentUri": "https://thisisfake/pacakge",
            "contentHash": "123contenthash",
            "assignmentType": "ApplyAndAutoCorrect",
            "configurationParameter": [
              {
                "name": "[InstalledApplication]bwhitelistedapp;Name",
                "value": "NotePad,sql"
              }
            ]
          }
        }
      }

      ```

  responses:
  - statusCode: "201"
    body: >-
      {
        "location": "westcentralus",
        "id": "/subscriptions/mysubscriptionid/resourceGroups/myResourceGroupName/providers/HybridRP.Compute/virtualMachines/myvm/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/WhitelistedApplication",
        "name": "WhitelistedApplication",
        "properties": {
          "complianceStatus": "Pending",
          "assignmentHash": "abcdr453g",
          "latestReportId": "a2a64e5d-a1a9-4344-a866-fb9e1541f723",
          "lastComplianceStatusChecked": null,
          "context": "Azure policy",
          "resourceType": null,
          "vmssVMList": null,
          "guestConfiguration": {
            "kind": null,
            "name": "WhitelistedApplication",
            "version": "1.0.0.3",
            "contentUri": null,
            "contentHash": null,
            "contentType": null,
            "configurationParameter": [
              {
                "name": "[InstalledApplication]bwhitelistedapp;Name",
                "value": "NotePad,sql"
              }
            ]
          },
          "provisioningState": "Succeeded"
        }
      }
  - statusCode: "200"
    body: >-
      {
        "location": "westcentralus",
        "id": "/subscriptions/mysubscriptionid/resourceGroups/myResourceGroupName/providers/HybridRP.Compute/virtualMachines/myvm/providers/Microsoft.GuestConfiguration/guestConfigurationAssignments/WhitelistedApplication",
        "name": "WhitelistedApplication",
        "properties": {
          "complianceStatus": "Pending",
          "assignmentHash": "abcdr453g",
          "latestReportId": "a2a64e5d-a1a9-4344-a866-fb9e1541f723",
          "lastComplianceStatusChecked": null,
          "context": "Azure policy",
          "resourceType": null,
          "vmssVMList": null,
          "guestConfiguration": {
            "kind": null,
            "name": "WhitelistedApplication",
            "version": "1.0.0.3",
            "contentUri": null,
            "contentHash": null,
            "contentType": null,
            "configurationParameter": [
              {
                "name": "[InstalledApplication]bwhitelistedapp;Name",
                "value": "NotePad,sql"
              }
            ]
          },
          "provisioningState": "Succeeded"
        }
      }
security:
- name: azure_auth
  type: oauth2
  description: Azure Active Directory OAuth2 Flow
  flow: implicit
  authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
  scopes:
  - name: user_impersonation
    description: impersonate your user account
metadata:
  description: Learn more about Guest Configuration service - Creates an association between a ARC machine and guest configuration
errorCodes: []
