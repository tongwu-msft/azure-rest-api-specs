### YamlMime:RESTOperation
uid: management.azure.com.aks.agentpools.upgradenodeimageversion
name: Upgrade Node Image Version
service: AKS
groupName: Agent Pools
apiVersion: 2021-03-01
summary: Upgrade node image version of an agent pool to the latest.
consumes:
- application/json
produces:
- application/json
paths:
- content: POST https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.ContainerService/managedClusters/{resourceName}/agentPools/{agentPoolName}/upgradeNodeImageVersion?api-version=2021-03-01
uriParameters:
- name: subscriptionId
  in: path
  isRequired: true
  description: Subscription credentials which uniquely identify Microsoft Azure subscription. The subscription ID forms part of the URI for every service call.
  types:
  - uid: string
- name: resourceGroupName
  in: path
  isRequired: true
  description: The name of the resource group.
  types:
  - uid: string
- name: resourceName
  in: path
  isRequired: true
  description: The name of the managed cluster resource.
  types:
  - uid: string
  pattern: ^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$
- name: agentPoolName
  in: path
  isRequired: true
  description: The name of the agent pool.
  types:
  - uid: string
- name: api-version
  in: query
  isRequired: true
  description: Client Api Version.
  types:
  - uid: string
responses:
- name: 200 OK
  description: OK
- name: 202 Accepted
  description: Accepted
  types:
  - uid: AgentPool
- name: Other Status Codes
  description: Error response describing why the operation failed.
  types:
  - uid: CloudError
requestHeader: []
definitions:
- name: AgentPool
  description: Agent Pool.
  kind: object
  properties:
  - name: id
    isReadyOnly: true
    description: Resource ID.
    types:
    - uid: string
  - name: name
    isReadyOnly: true
    description: The name of the resource that is unique within a resource group. This name can be used to access the resource.
    types:
    - uid: string
  - name: type
    isReadyOnly: true
    description: Resource type
    types:
    - uid: string
  - name: properties.count
    description: Number of agents (VMs) to host docker containers. Allowed values must be in the range of 0 to 100 (inclusive) for user pools and in the range of 1 to 100 (inclusive) for system pools. The default value is 1.
    types:
    - uid: integer
  - name: properties.vmSize
    description: Size of agent VMs.
    types:
    - uid: string
  - name: properties.osDiskSizeGB
    description: OS Disk Size in GB to be used to specify the disk size for every machine in this master/agent pool. If you specify 0, it will apply the default osDisk size according to the vmSize specified.
    types:
    - uid: integer
  - name: properties.osDiskType
    description: OS disk type to be used for machines in a given agent pool. Allowed values are 'Ephemeral' and 'Managed'. If unspecified, defaults to 'Ephemeral' when the VM supports ephemeral OS and has a cache disk larger than the requested OSDiskSizeGB. Otherwise, defaults to 'Managed'. May not be changed after creation.
    types:
    - uid: OSDiskType
  - name: properties.kubeletDiskType
    description: KubeletDiskType determines the placement of emptyDir volumes, container runtime data root, and Kubelet ephemeral storage. Currently allows one value, OS, resulting in Kubelet using the OS disk for data.
    types:
    - uid: KubeletDiskType
  - name: properties.vnetSubnetID
    description: VNet SubnetID specifies the VNet's subnet identifier for nodes and maybe pods
    types:
    - uid: string
  - name: properties.podSubnetID
    description: Pod SubnetID specifies the VNet's subnet identifier for pods.
    types:
    - uid: string
  - name: properties.maxPods
    description: Maximum number of pods that can run on a node.
    types:
    - uid: integer
  - name: properties.osType
    description: OsType to be used to specify os type. Choose from Linux and Windows. Default to Linux.
    types:
    - uid: OSType
  - name: properties.osSKU
    description: OsSKU to be used to specify os sku. Choose from Ubuntu(default) and CBLMariner for Linux OSType. Not applicable to Windows OSType.
    types:
    - uid: OSSKU
  - name: properties.maxCount
    description: Maximum number of nodes for auto-scaling
    types:
    - uid: integer
  - name: properties.minCount
    description: Minimum number of nodes for auto-scaling
    types:
    - uid: integer
  - name: properties.enableAutoScaling
    description: Whether to enable auto-scaler
    types:
    - uid: boolean
  - name: properties.type
    description: AgentPoolType represents types of an agent pool
    types:
    - uid: AgentPoolType
  - name: properties.mode
    description: AgentPoolMode represents mode of an agent pool
    types:
    - uid: AgentPoolMode
  - name: properties.orchestratorVersion
    description: Version of orchestrator specified when creating the managed cluster.
    types:
    - uid: string
  - name: properties.nodeImageVersion
    isReadyOnly: true
    description: Version of node image
    types:
    - uid: string
  - name: properties.upgradeSettings
    description: Settings for upgrading the agentpool
    types:
    - uid: AgentPoolUpgradeSettings
  - name: properties.provisioningState
    isReadyOnly: true
    description: The current deployment or provisioning state, which only appears in the response.
    types:
    - uid: string
  - name: properties.powerState
    isReadyOnly: true
    description: Describes whether the Agent Pool is Running or Stopped
    types:
    - uid: PowerState
  - name: properties.availabilityZones
    description: Availability zones for nodes. Must use VirtualMachineScaleSets AgentPoolType.
    types:
    - uid: string
      isArray: true
  - name: properties.enableNodePublicIP
    description: Enable public IP for nodes
    types:
    - uid: boolean
  - name: properties.nodePublicIPPrefixID
    description: Public IP Prefix ID. VM nodes use IPs assigned from this Public IP Prefix.
    types:
    - uid: string
  - name: properties.scaleSetPriority
    description: ScaleSetPriority to be used to specify virtual machine scale set priority. Default to regular.
    types:
    - uid: ScaleSetPriority
  - name: properties.scaleSetEvictionPolicy
    description: ScaleSetEvictionPolicy to be used to specify eviction policy for Spot virtual machine scale set. Default to Delete.
    types:
    - uid: ScaleSetEvictionPolicy
  - name: properties.spotMaxPrice
    description: SpotMaxPrice to be used to specify the maximum price you are willing to pay in US Dollars. Possible values are any decimal value greater than zero or -1 which indicates default price to be up-to on-demand.
    types:
    - uid: number
  - name: properties.tags
    description: Agent pool tags to be persisted on the agent pool virtual machine scale set.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
  - name: properties.nodeLabels
    description: Agent pool node labels to be persisted across all nodes in agent pool.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
  - name: properties.nodeTaints
    description: Taints added to new nodes during node pool create and scale. For example, key=value:NoSchedule.
    types:
    - uid: string
      isArray: true
  - name: properties.proximityPlacementGroupID
    description: The ID for Proximity Placement Group.
    types:
    - uid: string
  - name: properties.kubeletConfig
    description: KubeletConfig specifies the configuration of kubelet on agent nodes.
    types:
    - uid: KubeletConfig
  - name: properties.linuxOSConfig
    description: LinuxOSConfig specifies the OS configuration of linux agent nodes.
    types:
    - uid: LinuxOSConfig
  - name: properties.enableEncryptionAtHost
    description: Whether to enable EncryptionAtHost
    types:
    - uid: boolean
  - name: properties.enableFIPS
    description: Whether to use FIPS enabled OS
    types:
    - uid: boolean
  - name: properties.gpuInstanceProfile
    description: GPUInstanceProfile to be used to specify GPU MIG instance profile for supported GPU VM SKU. Supported values are MIG1g, MIG2g, MIG3g, MIG4g and MIG7g.
    types:
    - uid: 'GPUInstanceProfile '
- name: CloudError
  description: An error response from the Container service.
  kind: object
  properties:
  - name: error
    description: Details about the error.
    types:
    - uid: CloudErrorBody
- name: OSDiskType
  description: OSDiskType represents the type of an OS disk on an agent pool.
  kind: enum
  properties:
  - name: Managed
    types:
    - uid: string
  - name: Ephemeral
    types:
    - uid: string
- name: KubeletDiskType
  description: "KubeletDiskType determines the placement of emptyDir volumes, container runtime data root, and Kubelet ephemeral storage. Allowed values: 'OS', 'Temporary' (preview)."
  kind: enum
  properties:
  - name: OS
    types:
    - uid: string
  - name: Temporary
    types:
    - uid: string
- name: OSType
  description: OsType to be used to specify os type. Choose from Linux and Windows. Default to Linux.
  kind: enum
  properties:
  - name: Linux
    types:
    - uid: string
  - name: Windows
    types:
    - uid: string
- name: OSSKU
  description: OsSKU to be used to specify os sku. Choose from Ubuntu(default) and CBLMariner for Linux OSType. Not applicable to Windows OSType.
  kind: enum
  properties:
  - name: Ubuntu
    types:
    - uid: string
  - name: CBLMariner
    types:
    - uid: string
- name: AgentPoolType
  description: AgentPoolType represents types of an agent pool.
  kind: enum
  properties:
  - name: VirtualMachineScaleSets
    types:
    - uid: string
  - name: AvailabilitySet
    types:
    - uid: string
- name: AgentPoolMode
  description: AgentPoolMode represents mode of an agent pool.
  kind: enum
  properties:
  - name: System
    types:
    - uid: string
  - name: User
    types:
    - uid: string
- name: AgentPoolUpgradeSettings
  description: Settings for upgrading an agentpool
  kind: object
  properties:
  - name: maxSurge
    description: Count or percentage of additional nodes to be added during upgrade. If empty uses AKS default
    types:
    - uid: string
- name: PowerState
  description: Describes the Power State of the cluster
  kind: object
  properties:
  - name: code
    description: Tells whether the cluster is Running or Stopped
    types:
    - uid: code
- name: ScaleSetPriority
  description: ScaleSetPriority to be used to specify virtual machine scale set priority. Default to regular.
  kind: enum
  properties:
  - name: Spot
    types:
    - uid: string
  - name: Regular
    types:
    - uid: string
- name: ScaleSetEvictionPolicy
  description: ScaleSetEvictionPolicy to be used to specify eviction policy for Spot virtual machine scale set. Default to Delete.
  kind: enum
  properties:
  - name: Delete
    types:
    - uid: string
  - name: Deallocate
    types:
    - uid: string
- name: KubeletConfig
  description: Kubelet configurations of agent nodes.
  kind: object
  properties:
  - name: cpuManagerPolicy
    description: CPU Manager policy to use.
    types:
    - uid: string
  - name: cpuCfsQuota
    description: Enable CPU CFS quota enforcement for containers that specify CPU limits.
    types:
    - uid: boolean
  - name: cpuCfsQuotaPeriod
    description: Sets CPU CFS quota period value.
    types:
    - uid: string
  - name: imageGcHighThreshold
    description: The percent of disk usage after which image garbage collection is always run.
    types:
    - uid: integer
  - name: imageGcLowThreshold
    description: The percent of disk usage before which image garbage collection is never run.
    types:
    - uid: integer
  - name: topologyManagerPolicy
    description: Topology Manager policy to use.
    types:
    - uid: string
  - name: allowedUnsafeSysctls
    description: Allowlist of unsafe sysctls or unsafe sysctl patterns (ending in `*`).
    types:
    - uid: string
      isArray: true
  - name: failSwapOn
    description: If set to true it will make the Kubelet fail to start if swap is enabled on the node.
    types:
    - uid: boolean
  - name: containerLogMaxSizeMB
    description: The maximum size (e.g. 10Mi) of container log file before it is rotated.
    types:
    - uid: integer
  - name: containerLogMaxFiles
    description: The maximum number of container log files that can be present for a container. The number must be ≥ 2.
    types:
    - uid: integer
  - name: podMaxPids
    description: The maximum number of processes per pod.
    types:
    - uid: integer
- name: LinuxOSConfig
  description: OS configurations of Linux agent nodes.
  kind: object
  properties:
  - name: sysctls
    description: Sysctl settings for Linux agent nodes.
    types:
    - uid: SysctlConfig
  - name: transparentHugePageEnabled
    description: Transparent Huge Page enabled configuration.
    types:
    - uid: string
  - name: transparentHugePageDefrag
    description: Transparent Huge Page defrag configuration.
    types:
    - uid: string
  - name: swapFileSizeMB
    description: SwapFileSizeMB specifies size in MB of a swap file will be created on each node.
    types:
    - uid: integer
- name: 'GPUInstanceProfile '
  description: GPUInstanceProfile to be used to specify GPU MIG instance profile for supported GPU VM SKU. Supported values are MIG1g, MIG2g, MIG3g, MIG4g and MIG7g.
  kind: enum
  properties:
  - name: MIG1g
    types:
    - uid: string
  - name: MIG2g
    types:
    - uid: string
  - name: MIG3g
    types:
    - uid: string
  - name: MIG4g
    types:
    - uid: string
  - name: MIG7g
    types:
    - uid: string
- name: CloudErrorBody
  description: An error response from the Container service.
  kind: object
  properties:
  - name: code
    description: An identifier for the error. Codes are invariant and are intended to be consumed programmatically.
    types:
    - uid: string
  - name: message
    description: A message describing the error, intended to be suitable for display in a user interface.
    types:
    - uid: string
  - name: target
    description: The target of the particular error. For example, the name of the property in error.
    types:
    - uid: string
  - name: details
    description: A list of additional details about the error.
    types:
    - uid: CloudErrorBody
      isArray: true
- name: code
  description: Tells whether the cluster is Running or Stopped
  kind: enum
  properties:
  - name: Running
    types:
    - uid: string
  - name: Stopped
    types:
    - uid: string
- name: SysctlConfig
  description: Sysctl settings for Linux agent nodes.
  kind: object
  properties:
  - name: netCoreSomaxconn
    description: Sysctl setting net.core.somaxconn.
    types:
    - uid: integer
  - name: netCoreNetdevMaxBacklog
    description: Sysctl setting net.core.netdev_max_backlog.
    types:
    - uid: integer
  - name: netCoreRmemDefault
    description: Sysctl setting net.core.rmem_default.
    types:
    - uid: integer
  - name: netCoreRmemMax
    description: Sysctl setting net.core.rmem_max.
    types:
    - uid: integer
  - name: netCoreWmemDefault
    description: Sysctl setting net.core.wmem_default.
    types:
    - uid: integer
  - name: netCoreWmemMax
    description: Sysctl setting net.core.wmem_max.
    types:
    - uid: integer
  - name: netCoreOptmemMax
    description: Sysctl setting net.core.optmem_max.
    types:
    - uid: integer
  - name: netIpv4TcpMaxSynBacklog
    description: Sysctl setting net.ipv4.tcp_max_syn_backlog.
    types:
    - uid: integer
  - name: netIpv4TcpMaxTwBuckets
    description: Sysctl setting net.ipv4.tcp_max_tw_buckets.
    types:
    - uid: integer
  - name: netIpv4TcpFinTimeout
    description: Sysctl setting net.ipv4.tcp_fin_timeout.
    types:
    - uid: integer
  - name: netIpv4TcpKeepaliveTime
    description: Sysctl setting net.ipv4.tcp_keepalive_time.
    types:
    - uid: integer
  - name: netIpv4TcpKeepaliveProbes
    description: Sysctl setting net.ipv4.tcp_keepalive_probes.
    types:
    - uid: integer
  - name: netIpv4TcpkeepaliveIntvl
    description: Sysctl setting net.ipv4.tcp_keepalive_intvl.
    types:
    - uid: integer
  - name: netIpv4TcpTwReuse
    description: Sysctl setting net.ipv4.tcp_tw_reuse.
    types:
    - uid: boolean
  - name: netIpv4IpLocalPortRange
    description: Sysctl setting net.ipv4.ip_local_port_range.
    types:
    - uid: string
  - name: netIpv4NeighDefaultGcThresh1
    description: Sysctl setting net.ipv4.neigh.default.gc_thresh1.
    types:
    - uid: integer
  - name: netIpv4NeighDefaultGcThresh2
    description: Sysctl setting net.ipv4.neigh.default.gc_thresh2.
    types:
    - uid: integer
  - name: netIpv4NeighDefaultGcThresh3
    description: Sysctl setting net.ipv4.neigh.default.gc_thresh3.
    types:
    - uid: integer
  - name: netNetfilterNfConntrackMax
    description: Sysctl setting net.netfilter.nf_conntrack_max.
    types:
    - uid: integer
  - name: netNetfilterNfConntrackBuckets
    description: Sysctl setting net.netfilter.nf_conntrack_buckets.
    types:
    - uid: integer
  - name: fsInotifyMaxUserWatches
    description: Sysctl setting fs.inotify.max_user_watches.
    types:
    - uid: integer
  - name: fsFileMax
    description: Sysctl setting fs.file-max.
    types:
    - uid: integer
  - name: fsAioMaxNr
    description: Sysctl setting fs.aio-max-nr.
    types:
    - uid: integer
  - name: fsNrOpen
    description: Sysctl setting fs.nr_open.
    types:
    - uid: integer
  - name: kernelThreadsMax
    description: Sysctl setting kernel.threads-max.
    types:
    - uid: integer
  - name: vmMaxMapCount
    description: Sysctl setting vm.max_map_count.
    types:
    - uid: integer
  - name: vmSwappiness
    description: Sysctl setting vm.swappiness.
    types:
    - uid: integer
  - name: vmVfsCachePressure
    description: Sysctl setting vm.vfs_cache_pressure.
    types:
    - uid: integer
examples:
- name: Upgrade Agent Pool Node Image Version
  request:
    uri: POST https://management.azure.com/subscriptions/subid1/resourceGroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1/upgradeNodeImageVersion?api-version=2021-03-01
  responses:
  - statusCode: "200"
  - statusCode: "202"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "UpgradingNodeImageVersion",
          "count": 3,
          "vmSize": "Standard_DS1_v2",
          "maxPods": 110,
          "osType": "Linux",
          "orchestratorVersion": "1.9.6",
          "nodeImageVersion": "AKSUbuntu-1604-2020.03.11",
          "upgradeSettings": {
            "maxSurge": "33%"
          }
        }
      }
security:
- name: azure_auth
  type: oauth2
  description: Azure Active Directory OAuth2 Flow
  flow: implicit
  authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
  scopes:
  - name: user_impersonation
    description: impersonate your user account
metadata:
  description: Learn more about AKS service - Upgrade node image version of an agent pool to the latest.
errorCodes: []
