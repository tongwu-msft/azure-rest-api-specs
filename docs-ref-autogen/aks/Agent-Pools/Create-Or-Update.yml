### YamlMime:RESTOperation
uid: management.azure.com.aks.agentpools.createorupdate
name: Create Or Update
service: AKS
groupName: Agent Pools
apiVersion: 2021-05-01
summary: Creates or updates an agent pool in the specified managed cluster.
consumes:
- application/json
produces:
- application/json
paths:
- content: PUT https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.ContainerService/managedClusters/{resourceName}/agentPools/{agentPoolName}?api-version=2021-05-01
uriParameters:
- name: subscriptionId
  in: path
  isRequired: true
  description: Subscription credentials which uniquely identify Microsoft Azure subscription. The subscription ID forms part of the URI for every service call.
  types:
  - uid: string
- name: resourceGroupName
  in: path
  isRequired: true
  description: The name of the resource group.
  types:
  - uid: string
- name: resourceName
  in: path
  isRequired: true
  description: The name of the managed cluster resource.
  types:
  - uid: string
  pattern: ^[a-zA-Z0-9]$|^[a-zA-Z0-9][-_a-zA-Z0-9]{0,61}[a-zA-Z0-9]$
- name: agentPoolName
  in: path
  isRequired: true
  description: The name of the agent pool.
  types:
  - uid: string
- name: api-version
  in: query
  isRequired: true
  description: Client Api Version.
  types:
  - uid: string
responses:
- name: 200 OK
  description: OK
  types:
  - uid: AgentPool
- name: 201 Created
  description: Created
  types:
  - uid: AgentPool
- name: Other Status Codes
  description: Error response describing why the operation failed.
  types:
  - uid: CloudError
requestBody:
- name: default
  parameters:
  - name: properties.count
    in: body
    description: Number of agents (VMs) to host docker containers. Allowed values must be in the range of 0 to 1000 (inclusive) for user pools and in the range of 1 to 1000 (inclusive) for system pools. The default value is 1.
    types:
    - uid: integer
  - name: properties.vmSize
    in: body
    description: "The size of the agent pool VMs.  \nVM size availability varies by region. If a node contains insufficient compute resources (memory, cpu, etc) pods might fail to run correctly. For more details on restricted VM sizes, see: https://docs.microsoft.com/azure/aks/quotas-skus-regions"
    types:
    - uid: string
  - name: properties.osDiskSizeGB
    in: body
    description: OS Disk Size in GB to be used to specify the disk size for every machine in the master/agent pool. If you specify 0, it will apply the default osDisk size according to the vmSize specified.
    types:
    - uid: integer
  - name: properties.osDiskType
    in: body
    description: "The OS disk type to be used for machines in the agent pool.  \nThe default is 'Ephemeral' if the VM supports it and has a cache disk larger than the requested OSDiskSizeGB. Otherwise, defaults to 'Managed'. May not be changed after creation. For more information see [Ephemeral OS](https://docs.microsoft.com/azure/aks/cluster-configuration#ephemeral-os)."
    types:
    - uid: OSDiskType
  - name: properties.kubeletDiskType
    in: body
    description: Determines the placement of emptyDir volumes, container runtime data root, and Kubelet ephemeral storage.
    types:
    - uid: KubeletDiskType
  - name: properties.vnetSubnetID
    in: body
    description: "The ID of the subnet which agent pool nodes and optionally pods will join on startup.  \nIf this is not specified, a VNET and subnet will be generated and used. If no podSubnetID is specified, this applies to nodes and pods, otherwise it applies to just nodes. This is of the form: /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/virtualNetworks/{virtualNetworkName}/subnets/{subnetName}"
    types:
    - uid: string
  - name: properties.podSubnetID
    in: body
    description: "The ID of the subnet which pods will join when launched.  \nIf omitted, pod IPs are statically assigned on the node subnet (see vnetSubnetID for more details). This is of the form: /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/virtualNetworks/{virtualNetworkName}/subnets/{subnetName}"
    types:
    - uid: string
  - name: properties.maxPods
    in: body
    description: The maximum number of pods that can run on a node.
    types:
    - uid: integer
  - name: properties.osType
    in: body
    description: The operating system type. The default is Linux.
    types:
    - uid: OSType
  - name: properties.osSKU
    in: body
    description: Specifies an OS SKU. This value must not be specified if OSType is Windows.
    types:
    - uid: OSSKU
  - name: properties.maxCount
    in: body
    description: The maximum number of nodes for auto-scaling
    types:
    - uid: integer
  - name: properties.minCount
    in: body
    description: The minimum number of nodes for auto-scaling
    types:
    - uid: integer
  - name: properties.enableAutoScaling
    in: body
    description: Whether to enable auto-scaler
    types:
    - uid: boolean
  - name: properties.type
    in: body
    description: The type of Agent Pool.
    types:
    - uid: AgentPoolType
  - name: properties.mode
    in: body
    description: "The mode of an agent pool.  \nA cluster must have at least one 'System' Agent Pool at all times. For additional information on agent pool restrictions and best practices, see: https://docs.microsoft.com/azure/aks/use-system-pools"
    types:
    - uid: AgentPoolMode
  - name: properties.orchestratorVersion
    in: body
    description: "The version of Kubernetes running on the Agent Pool.  \nAs a best practice, you should upgrade all node pools in an AKS cluster to the same Kubernetes version. The node pool version must have the same major version as the control plane. The node pool minor version must be within two minor versions of the control plane version. The node pool version cannot be greater than the control plane version. For more information see [upgrading a node pool](https://docs.microsoft.com/azure/aks/use-multiple-node-pools#upgrade-a-node-pool)."
    types:
    - uid: string
  - name: properties.upgradeSettings
    in: body
    description: Settings for upgrading the agentpool
    types:
    - uid: AgentPoolUpgradeSettings
  - name: properties.availabilityZones
    in: body
    description: The list of Availability zones to use for nodes. This can only be specified if the AgentPoolType property is 'VirtualMachineScaleSets'.
    types:
    - uid: string
      isArray: true
  - name: properties.enableNodePublicIP
    in: body
    description: "Whether each node is allocated its own public IP.  \nSome scenarios may require nodes in a node pool to receive their own dedicated public IP addresses. A common scenario is for gaming workloads, where a console needs to make a direct connection to a cloud virtual machine to minimize hops. For more information see [assigning a public IP per node](https://docs.microsoft.com/azure/aks/use-multiple-node-pools#assign-a-public-ip-per-node-for-your-node-pools). The default is false."
    types:
    - uid: boolean
  - name: properties.nodePublicIPPrefixID
    in: body
    description: "The public IP prefix ID which VM nodes should use IPs from.  \nThis is of the form: /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/publicIPPrefixes/{publicIPPrefixName}"
    types:
    - uid: string
  - name: properties.scaleSetPriority
    in: body
    description: The Virtual Machine Scale Set priority. If not specified, the default is 'Regular'.
    types:
    - uid: ScaleSetPriority
  - name: properties.scaleSetEvictionPolicy
    in: body
    description: "The Virtual Machine Scale Set eviction policy to use.  \nThis cannot be specified unless the scaleSetPriority is 'Spot'. If not specified, the default is 'Delete'."
    types:
    - uid: ScaleSetEvictionPolicy
  - name: properties.spotMaxPrice
    in: body
    description: "The max price (in US Dollars) you are willing to pay for spot instances. Possible values are any decimal value greater than zero or -1 which indicates default price to be up-to on-demand.  \nPossible values are any decimal value greater than zero or -1 which indicates the willingness to pay any on-demand price. For more details on spot pricing, see [spot VMs pricing](https://docs.microsoft.com/azure/virtual-machines/spot-vms#pricing)"
    types:
    - uid: number
  - name: properties.tags
    in: body
    description: The tags to be persisted on the agent pool virtual machine scale set.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
  - name: properties.nodeLabels
    in: body
    description: The node labels to be persisted across all nodes in agent pool.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
  - name: properties.nodeTaints
    in: body
    description: The taints added to new nodes during node pool create and scale. For example, key=value:NoSchedule.
    types:
    - uid: string
      isArray: true
  - name: properties.proximityPlacementGroupID
    in: body
    description: The ID for Proximity Placement Group.
    types:
    - uid: string
  - name: properties.kubeletConfig
    in: body
    description: "Kubelet configurations of agent nodes.  \nThe Kubelet configuration on the agent pool nodes."
    types:
    - uid: KubeletConfig
  - name: properties.linuxOSConfig
    in: body
    description: "OS configurations of Linux agent nodes.  \nThe OS configuration of Linux agent nodes."
    types:
    - uid: LinuxOSConfig
  - name: properties.enableEncryptionAtHost
    in: body
    description: "Whether to enable host based OS and data drive encryption.  \nThis is only supported on certain VM sizes and in certain Azure regions. For more information, see: https://docs.microsoft.com/azure/aks/enable-host-encryption"
    types:
    - uid: boolean
  - name: properties.enableUltraSSD
    in: body
    description: Whether to enable UltraSSD
    types:
    - uid: boolean
  - name: properties.enableFIPS
    in: body
    description: "Whether to use a FIPS-enabled OS.  \nSee [Add a FIPS-enabled node pool](https://docs.microsoft.com/azure/aks/use-multiple-node-pools#add-a-fips-enabled-node-pool-preview) for more details."
    types:
    - uid: boolean
  - name: properties.gpuInstanceProfile
    in: body
    description: GPUInstanceProfile to be used to specify GPU MIG instance profile for supported GPU VM SKU.
    types:
    - uid: 'GPUInstanceProfile '
requestHeader: []
definitions:
- name: AgentPoolUpgradeSettings
  description: Settings for upgrading an agentpool
  kind: object
  properties:
  - name: maxSurge
    description: "The maximum number or percentage of nodes that are surged during upgrade.  \nThis can either be set to an integer (e.g. '5') or a percentage (e.g. '50%'). If a percentage is specified, it is the percentage of the total agent pool size at the time of the upgrade. For percentages, fractional nodes are rounded up. If not specified, the default is 1. For more information, including best practices, see: https://docs.microsoft.com/azure/aks/upgrade-cluster#customize-node-surge-upgrade"
    types:
    - uid: string
- name: PowerState
  description: Describes the Power State of the cluster
  kind: object
  properties:
  - name: code
    description: Tells whether the cluster is Running or Stopped
    types:
    - uid: code
- name: KubeletConfig
  description: Kubelet configurations of agent nodes.
  kind: object
  properties:
  - name: cpuManagerPolicy
    description: "The CPU Manager policy to use.  \nThe default is 'none'. See [Kubernetes CPU management policies](https://kubernetes.io/docs/tasks/administer-cluster/cpu-management-policies/#cpu-management-policies) for more information. Allowed values are 'none' and 'static'."
    types:
    - uid: string
  - name: cpuCfsQuota
    description: "If CPU CFS quota enforcement is enabled for containers that specify CPU limits.  \nThe default is true."
    types:
    - uid: boolean
  - name: cpuCfsQuotaPeriod
    description: "The CPU CFS quota period value.  \nThe default is '100ms.' Valid values are a sequence of decimal numbers with an optional fraction and a unit suffix. For example: '300ms', '2h45m'. Supported units are 'ns', 'us', 'ms', 's', 'm', and 'h'."
    types:
    - uid: string
  - name: imageGcHighThreshold
    description: "The percent of disk usage after which image garbage collection is always run.  \nTo disable image garbage collection, set to 100. The default is 85%"
    types:
    - uid: integer
  - name: imageGcLowThreshold
    description: "The percent of disk usage before which image garbage collection is never run.  \nThis cannot be set higher than imageGcHighThreshold. The default is 80%"
    types:
    - uid: integer
  - name: topologyManagerPolicy
    description: "The Topology Manager policy to use.  \nFor more information see [Kubernetes Topology Manager](https://kubernetes.io/docs/tasks/administer-cluster/topology-manager). The default is 'none'. Allowed values are 'none', 'best-effort', 'restricted', and 'single-numa-node'."
    types:
    - uid: string
  - name: allowedUnsafeSysctls
    description: Allowed list of unsafe sysctls or unsafe sysctl patterns (ending in `*`).
    types:
    - uid: string
      isArray: true
  - name: failSwapOn
    description: If set to true it will make the Kubelet fail to start if swap is enabled on the node.
    types:
    - uid: boolean
  - name: containerLogMaxSizeMB
    description: The maximum size (e.g. 10Mi) of container log file before it is rotated.
    types:
    - uid: integer
  - name: containerLogMaxFiles
    description: The maximum number of container log files that can be present for a container. The number must be â‰¥ 2.
    types:
    - uid: integer
  - name: podMaxPids
    description: The maximum number of processes per pod.
    types:
    - uid: integer
- name: LinuxOSConfig
  description: OS configurations of Linux agent nodes.
  kind: object
  properties:
  - name: sysctls
    description: Sysctl settings for Linux agent nodes.
    types:
    - uid: SysctlConfig
  - name: transparentHugePageEnabled
    description: "Whether transparent hugepages are enabled.  \nValid values are 'always', 'madvise', and 'never'. The default is 'always'. For more information see [Transparent Hugepages](https://www.kernel.org/doc/html/latest/admin-guide/mm/transhuge.html#admin-guide-transhuge)."
    types:
    - uid: string
  - name: transparentHugePageDefrag
    description: "Whether the kernel should make aggressive use of memory compaction to make more hugepages available.  \nValid values are 'always', 'defer', 'defer+madvise', 'madvise' and 'never'. The default is 'madvise'. For more information see [Transparent Hugepages](https://www.kernel.org/doc/html/latest/admin-guide/mm/transhuge.html#admin-guide-transhuge)."
    types:
    - uid: string
  - name: swapFileSizeMB
    description: The size in MB of a swap file that will be created on each node.
    types:
    - uid: integer
- name: AgentPool
  description: Agent Pool.
  kind: object
  properties:
  - name: id
    isReadyOnly: true
    description: Resource ID.
    types:
    - uid: string
  - name: name
    isReadyOnly: true
    description: The name of the resource that is unique within a resource group. This name can be used to access the resource.
    types:
    - uid: string
  - name: type
    isReadyOnly: true
    description: Resource type
    types:
    - uid: string
  - name: properties.count
    description: Number of agents (VMs) to host docker containers. Allowed values must be in the range of 0 to 1000 (inclusive) for user pools and in the range of 1 to 1000 (inclusive) for system pools. The default value is 1.
    types:
    - uid: integer
  - name: properties.vmSize
    description: "The size of the agent pool VMs.  \nVM size availability varies by region. If a node contains insufficient compute resources (memory, cpu, etc) pods might fail to run correctly. For more details on restricted VM sizes, see: https://docs.microsoft.com/azure/aks/quotas-skus-regions"
    types:
    - uid: string
  - name: properties.osDiskSizeGB
    description: OS Disk Size in GB to be used to specify the disk size for every machine in the master/agent pool. If you specify 0, it will apply the default osDisk size according to the vmSize specified.
    types:
    - uid: integer
  - name: properties.osDiskType
    description: "The OS disk type to be used for machines in the agent pool.  \nThe default is 'Ephemeral' if the VM supports it and has a cache disk larger than the requested OSDiskSizeGB. Otherwise, defaults to 'Managed'. May not be changed after creation. For more information see [Ephemeral OS](https://docs.microsoft.com/azure/aks/cluster-configuration#ephemeral-os)."
    types:
    - uid: OSDiskType
  - name: properties.kubeletDiskType
    description: Determines the placement of emptyDir volumes, container runtime data root, and Kubelet ephemeral storage.
    types:
    - uid: KubeletDiskType
  - name: properties.vnetSubnetID
    description: "The ID of the subnet which agent pool nodes and optionally pods will join on startup.  \nIf this is not specified, a VNET and subnet will be generated and used. If no podSubnetID is specified, this applies to nodes and pods, otherwise it applies to just nodes. This is of the form: /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/virtualNetworks/{virtualNetworkName}/subnets/{subnetName}"
    types:
    - uid: string
  - name: properties.podSubnetID
    description: "The ID of the subnet which pods will join when launched.  \nIf omitted, pod IPs are statically assigned on the node subnet (see vnetSubnetID for more details). This is of the form: /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/virtualNetworks/{virtualNetworkName}/subnets/{subnetName}"
    types:
    - uid: string
  - name: properties.maxPods
    description: The maximum number of pods that can run on a node.
    types:
    - uid: integer
  - name: properties.osType
    description: The operating system type. The default is Linux.
    types:
    - uid: OSType
  - name: properties.osSKU
    description: Specifies an OS SKU. This value must not be specified if OSType is Windows.
    types:
    - uid: OSSKU
  - name: properties.maxCount
    description: The maximum number of nodes for auto-scaling
    types:
    - uid: integer
  - name: properties.minCount
    description: The minimum number of nodes for auto-scaling
    types:
    - uid: integer
  - name: properties.enableAutoScaling
    description: Whether to enable auto-scaler
    types:
    - uid: boolean
  - name: properties.type
    description: The type of Agent Pool.
    types:
    - uid: AgentPoolType
  - name: properties.mode
    description: "The mode of an agent pool.  \nA cluster must have at least one 'System' Agent Pool at all times. For additional information on agent pool restrictions and best practices, see: https://docs.microsoft.com/azure/aks/use-system-pools"
    types:
    - uid: AgentPoolMode
  - name: properties.orchestratorVersion
    description: "The version of Kubernetes running on the Agent Pool.  \nAs a best practice, you should upgrade all node pools in an AKS cluster to the same Kubernetes version. The node pool version must have the same major version as the control plane. The node pool minor version must be within two minor versions of the control plane version. The node pool version cannot be greater than the control plane version. For more information see [upgrading a node pool](https://docs.microsoft.com/azure/aks/use-multiple-node-pools#upgrade-a-node-pool)."
    types:
    - uid: string
  - name: properties.nodeImageVersion
    isReadyOnly: true
    description: The version of node image
    types:
    - uid: string
  - name: properties.upgradeSettings
    description: Settings for upgrading the agentpool
    types:
    - uid: AgentPoolUpgradeSettings
  - name: properties.provisioningState
    isReadyOnly: true
    description: The current deployment or provisioning state.
    types:
    - uid: string
  - name: properties.powerState
    isReadyOnly: true
    description: Describes whether the Agent Pool is Running or Stopped
    types:
    - uid: PowerState
  - name: properties.availabilityZones
    description: The list of Availability zones to use for nodes. This can only be specified if the AgentPoolType property is 'VirtualMachineScaleSets'.
    types:
    - uid: string
      isArray: true
  - name: properties.enableNodePublicIP
    description: "Whether each node is allocated its own public IP.  \nSome scenarios may require nodes in a node pool to receive their own dedicated public IP addresses. A common scenario is for gaming workloads, where a console needs to make a direct connection to a cloud virtual machine to minimize hops. For more information see [assigning a public IP per node](https://docs.microsoft.com/azure/aks/use-multiple-node-pools#assign-a-public-ip-per-node-for-your-node-pools). The default is false."
    types:
    - uid: boolean
  - name: properties.nodePublicIPPrefixID
    description: "The public IP prefix ID which VM nodes should use IPs from.  \nThis is of the form: /subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Network/publicIPPrefixes/{publicIPPrefixName}"
    types:
    - uid: string
  - name: properties.scaleSetPriority
    description: The Virtual Machine Scale Set priority. If not specified, the default is 'Regular'.
    types:
    - uid: ScaleSetPriority
  - name: properties.scaleSetEvictionPolicy
    description: "The Virtual Machine Scale Set eviction policy to use.  \nThis cannot be specified unless the scaleSetPriority is 'Spot'. If not specified, the default is 'Delete'."
    types:
    - uid: ScaleSetEvictionPolicy
  - name: properties.spotMaxPrice
    description: "The max price (in US Dollars) you are willing to pay for spot instances. Possible values are any decimal value greater than zero or -1 which indicates default price to be up-to on-demand.  \nPossible values are any decimal value greater than zero or -1 which indicates the willingness to pay any on-demand price. For more details on spot pricing, see [spot VMs pricing](https://docs.microsoft.com/azure/virtual-machines/spot-vms#pricing)"
    types:
    - uid: number
  - name: properties.tags
    description: The tags to be persisted on the agent pool virtual machine scale set.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
  - name: properties.nodeLabels
    description: The node labels to be persisted across all nodes in agent pool.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
  - name: properties.nodeTaints
    description: The taints added to new nodes during node pool create and scale. For example, key=value:NoSchedule.
    types:
    - uid: string
      isArray: true
  - name: properties.proximityPlacementGroupID
    description: The ID for Proximity Placement Group.
    types:
    - uid: string
  - name: properties.kubeletConfig
    description: "Kubelet configurations of agent nodes.  \nThe Kubelet configuration on the agent pool nodes."
    types:
    - uid: KubeletConfig
  - name: properties.linuxOSConfig
    description: "OS configurations of Linux agent nodes.  \nThe OS configuration of Linux agent nodes."
    types:
    - uid: LinuxOSConfig
  - name: properties.enableEncryptionAtHost
    description: "Whether to enable host based OS and data drive encryption.  \nThis is only supported on certain VM sizes and in certain Azure regions. For more information, see: https://docs.microsoft.com/azure/aks/enable-host-encryption"
    types:
    - uid: boolean
  - name: properties.enableUltraSSD
    description: Whether to enable UltraSSD
    types:
    - uid: boolean
  - name: properties.enableFIPS
    description: "Whether to use a FIPS-enabled OS.  \nSee [Add a FIPS-enabled node pool](https://docs.microsoft.com/azure/aks/use-multiple-node-pools#add-a-fips-enabled-node-pool-preview) for more details."
    types:
    - uid: boolean
  - name: properties.gpuInstanceProfile
    description: GPUInstanceProfile to be used to specify GPU MIG instance profile for supported GPU VM SKU.
    types:
    - uid: 'GPUInstanceProfile '
- name: CloudError
  description: An error response from the Container service.
  kind: object
  properties:
  - name: error
    description: Details about the error.
    types:
    - uid: CloudErrorBody
- name: code
  description: Tells whether the cluster is Running or Stopped
  kind: enum
  properties:
  - name: Running
    description: The cluster is running.
    types:
    - uid: string
  - name: Stopped
    description: The cluster is stopped.
    types:
    - uid: string
- name: SysctlConfig
  description: Sysctl settings for Linux agent nodes.
  kind: object
  properties:
  - name: netCoreSomaxconn
    description: Sysctl setting net.core.somaxconn.
    types:
    - uid: integer
  - name: netCoreNetdevMaxBacklog
    description: Sysctl setting net.core.netdev_max_backlog.
    types:
    - uid: integer
  - name: netCoreRmemDefault
    description: Sysctl setting net.core.rmem_default.
    types:
    - uid: integer
  - name: netCoreRmemMax
    description: Sysctl setting net.core.rmem_max.
    types:
    - uid: integer
  - name: netCoreWmemDefault
    description: Sysctl setting net.core.wmem_default.
    types:
    - uid: integer
  - name: netCoreWmemMax
    description: Sysctl setting net.core.wmem_max.
    types:
    - uid: integer
  - name: netCoreOptmemMax
    description: Sysctl setting net.core.optmem_max.
    types:
    - uid: integer
  - name: netIpv4TcpMaxSynBacklog
    description: Sysctl setting net.ipv4.tcp_max_syn_backlog.
    types:
    - uid: integer
  - name: netIpv4TcpMaxTwBuckets
    description: Sysctl setting net.ipv4.tcp_max_tw_buckets.
    types:
    - uid: integer
  - name: netIpv4TcpFinTimeout
    description: Sysctl setting net.ipv4.tcp_fin_timeout.
    types:
    - uid: integer
  - name: netIpv4TcpKeepaliveTime
    description: Sysctl setting net.ipv4.tcp_keepalive_time.
    types:
    - uid: integer
  - name: netIpv4TcpKeepaliveProbes
    description: Sysctl setting net.ipv4.tcp_keepalive_probes.
    types:
    - uid: integer
  - name: netIpv4TcpkeepaliveIntvl
    description: Sysctl setting net.ipv4.tcp_keepalive_intvl.
    types:
    - uid: integer
  - name: netIpv4TcpTwReuse
    description: Sysctl setting net.ipv4.tcp_tw_reuse.
    types:
    - uid: boolean
  - name: netIpv4IpLocalPortRange
    description: Sysctl setting net.ipv4.ip_local_port_range.
    types:
    - uid: string
  - name: netIpv4NeighDefaultGcThresh1
    description: Sysctl setting net.ipv4.neigh.default.gc_thresh1.
    types:
    - uid: integer
  - name: netIpv4NeighDefaultGcThresh2
    description: Sysctl setting net.ipv4.neigh.default.gc_thresh2.
    types:
    - uid: integer
  - name: netIpv4NeighDefaultGcThresh3
    description: Sysctl setting net.ipv4.neigh.default.gc_thresh3.
    types:
    - uid: integer
  - name: netNetfilterNfConntrackMax
    description: Sysctl setting net.netfilter.nf_conntrack_max.
    types:
    - uid: integer
  - name: netNetfilterNfConntrackBuckets
    description: Sysctl setting net.netfilter.nf_conntrack_buckets.
    types:
    - uid: integer
  - name: fsInotifyMaxUserWatches
    description: Sysctl setting fs.inotify.max_user_watches.
    types:
    - uid: integer
  - name: fsFileMax
    description: Sysctl setting fs.file-max.
    types:
    - uid: integer
  - name: fsAioMaxNr
    description: Sysctl setting fs.aio-max-nr.
    types:
    - uid: integer
  - name: fsNrOpen
    description: Sysctl setting fs.nr_open.
    types:
    - uid: integer
  - name: kernelThreadsMax
    description: Sysctl setting kernel.threads-max.
    types:
    - uid: integer
  - name: vmMaxMapCount
    description: Sysctl setting vm.max_map_count.
    types:
    - uid: integer
  - name: vmSwappiness
    description: Sysctl setting vm.swappiness.
    types:
    - uid: integer
  - name: vmVfsCachePressure
    description: Sysctl setting vm.vfs_cache_pressure.
    types:
    - uid: integer
- name: OSDiskType
  description: The OS disk type to be used for machines in the agent pool.
  kind: enum
  properties:
  - name: Managed
    description: Azure replicates the operating system disk for a virtual machine to Azure storage to avoid data loss should the VM need to be relocated to another host. Since containers aren't designed to have local state persisted, this behavior offers limited value while providing some drawbacks, including slower node provisioning and higher read/write latency.
    types:
    - uid: string
  - name: Ephemeral
    description: Ephemeral OS disks are stored only on the host machine, just like a temporary disk. This provides lower read/write latency, along with faster node scaling and cluster upgrades.
    types:
    - uid: string
- name: KubeletDiskType
  description: Determines the placement of emptyDir volumes, container runtime data root, and Kubelet ephemeral storage.
  kind: enum
  properties:
  - name: OS
    description: Kubelet will use the OS disk for its data.
    types:
    - uid: string
  - name: Temporary
    description: Kubelet will use the temporary disk for its data.
    types:
    - uid: string
- name: OSType
  description: The operating system type. The default is Linux.
  kind: enum
  properties:
  - name: Linux
    description: Use Linux.
    types:
    - uid: string
  - name: Windows
    description: Use Windows.
    types:
    - uid: string
- name: OSSKU
  description: Specifies an OS SKU. This value must not be specified if OSType is Windows.
  kind: enum
  properties:
  - name: Ubuntu
    types:
    - uid: string
  - name: CBLMariner
    types:
    - uid: string
- name: AgentPoolType
  description: The type of Agent Pool.
  kind: enum
  properties:
  - name: VirtualMachineScaleSets
    description: Create an Agent Pool backed by a Virtual Machine Scale Set.
    types:
    - uid: string
  - name: AvailabilitySet
    description: Use of this is strongly discouraged.
    types:
    - uid: string
- name: AgentPoolMode
  description: The mode of an agent pool.
  kind: enum
  properties:
  - name: System
    description: System agent pools are primarily for hosting critical system pods such as CoreDNS and metrics-server. System agent pools osType must be Linux. System agent pools VM SKU must have at least 2vCPUs and 4GB of memory.
    types:
    - uid: string
  - name: User
    description: User agent pools are primarily for hosting your application pods.
    types:
    - uid: string
- name: ScaleSetPriority
  description: The Virtual Machine Scale Set priority.
  kind: enum
  properties:
  - name: Spot
    description: Spot priority VMs will be used. There is no SLA for spot nodes. See [spot on AKS](https://docs.microsoft.com/azure/aks/spot-node-pool) for more information.
    types:
    - uid: string
  - name: Regular
    description: Regular VMs will be used.
    types:
    - uid: string
- name: ScaleSetEvictionPolicy
  description: The Virtual Machine Scale Set eviction policy.
  kind: enum
  properties:
  - name: Delete
    description: Nodes in the underlying Scale Set of the node pool are deleted when they're evicted.
    types:
    - uid: string
  - name: Deallocate
    description: Nodes in the underlying Scale Set of the node pool are set to the stopped-deallocated state upon eviction. Nodes in the stopped-deallocated state count against your compute quota and can cause issues with cluster scaling or upgrading.
    types:
    - uid: string
- name: 'GPUInstanceProfile '
  description: GPUInstanceProfile to be used to specify GPU MIG instance profile for supported GPU VM SKU.
  kind: enum
  properties:
  - name: MIG1g
    types:
    - uid: string
  - name: MIG2g
    types:
    - uid: string
  - name: MIG3g
    types:
    - uid: string
  - name: MIG4g
    types:
    - uid: string
  - name: MIG7g
    types:
    - uid: string
- name: CloudErrorBody
  description: An error response from the Container service.
  kind: object
  properties:
  - name: code
    description: An identifier for the error. Codes are invariant and are intended to be consumed programmatically.
    types:
    - uid: string
  - name: message
    description: A message describing the error, intended to be suitable for display in a user interface.
    types:
    - uid: string
  - name: target
    description: The target of the particular error. For example, the name of the property in error.
    types:
    - uid: string
  - name: details
    description: A list of additional details about the error.
    types:
    - uid: CloudErrorBody
      isArray: true
examples:
- name: Create/Update Agent Pool
  request:
    uri: PUT https://management.azure.com/subscriptions/subid1/resourceGroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1?api-version=2021-05-01
    body: >-
      {
        "properties": {
          "orchestratorVersion": "",
          "count": 3,
          "vmSize": "Standard_DS1_v2",
          "osType": "Linux",
          "tags": {
            "name1": "val1"
          },
          "nodeLabels": {
            "key1": "val1"
          },
          "nodeTaints": [
            "Key1=Value1:NoSchedule"
          ],
          "scaleSetPriority": "Spot",
          "scaleSetEvictionPolicy": "Delete",
          "mode": "User"
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Succeeded",
          "orchestratorVersion": "1.9.6",
          "count": 3,
          "vmSize": "Standard_DS1_v2",
          "maxPods": 110,
          "osType": "Linux",
          "tags": {
            "name1": "val1"
          },
          "nodeLabels": {
            "key1": "val1"
          },
          "nodeTaints": [
            "Key1=Value1:NoSchedule"
          ],
          "scaleSetPriority": "Spot",
          "scaleSetEvictionPolicy": "Delete",
          "mode": "User",
          "nodeImageVersion": "AKSUbuntu:1604:2020.03.11"
        }
      }
  - statusCode: "201"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Creating",
          "orchestratorVersion": "1.9.6",
          "count": 3,
          "vmSize": "Standard_DS1_v2",
          "maxPods": 110,
          "osType": "Linux",
          "tags": {
            "name1": "val1"
          },
          "nodeLabels": {
            "key1": "val1"
          },
          "nodeTaints": [
            "Key1=Value1:NoSchedule"
          ],
          "scaleSetPriority": "Spot",
          "scaleSetEvictionPolicy": "Delete",
          "mode": "User"
        }
      }
- name: Update Agent Pool
  request:
    uri: PUT https://management.azure.com/subscriptions/subid1/resourceGroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1?api-version=2021-05-01
    body: >-
      {
        "properties": {
          "orchestratorVersion": "",
          "count": 3,
          "enableAutoScaling": true,
          "minCount": 2,
          "maxCount": 2,
          "vmSize": "Standard_DS1_v2",
          "osType": "Linux",
          "nodeTaints": [
            "Key1=Value1:NoSchedule"
          ],
          "scaleSetPriority": "Spot",
          "scaleSetEvictionPolicy": "Delete"
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Succeeded",
          "orchestratorVersion": "1.9.6",
          "count": 3,
          "enableAutoScaling": true,
          "minCount": 2,
          "maxCount": 2,
          "vmSize": "Standard_DS1_v2",
          "maxPods": 110,
          "osType": "Linux",
          "nodeTaints": [
            "Key1=Value1:NoSchedule"
          ],
          "scaleSetPriority": "Spot",
          "scaleSetEvictionPolicy": "Delete"
        }
      }
  - statusCode: "201"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Updating",
          "orchestratorVersion": "1.9.6",
          "count": 3,
          "enableAutoScaling": true,
          "minCount": 2,
          "maxCount": 2,
          "vmSize": "Standard_DS1_v2",
          "maxPods": 110,
          "osType": "Linux",
          "nodeTaints": [
            "Key1=Value1:NoSchedule"
          ],
          "scaleSetPriority": "Spot",
          "scaleSetEvictionPolicy": "Delete"
        }
      }
- name: Create Spot Agent Pool
  request:
    uri: PUT https://management.azure.com/subscriptions/subid1/resourceGroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1?api-version=2021-05-01
    body: >-
      {
        "properties": {
          "orchestratorVersion": "",
          "count": 3,
          "vmSize": "Standard_DS1_v2",
          "osType": "Linux",
          "tags": {
            "name1": "val1"
          },
          "nodeLabels": {
            "key1": "val1"
          },
          "nodeTaints": [
            "Key1=Value1:NoSchedule"
          ],
          "scaleSetPriority": "Spot",
          "scaleSetEvictionPolicy": "Delete"
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Succeeded",
          "orchestratorVersion": "1.9.6",
          "count": 3,
          "vmSize": "Standard_DS1_v2",
          "maxPods": 110,
          "osType": "Linux",
          "tags": {
            "name1": "val1"
          },
          "nodeLabels": {
            "key1": "val1"
          },
          "nodeTaints": [
            "Key1=Value1:NoSchedule"
          ],
          "scaleSetPriority": "Spot",
          "scaleSetEvictionPolicy": "Delete",
          "spotMaxPrice": -1
        }
      }
  - statusCode: "201"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Creating",
          "orchestratorVersion": "1.9.6",
          "count": 3,
          "vmSize": "Standard_DS1_v2",
          "maxPods": 110,
          "osType": "Linux",
          "tags": {
            "name1": "val1"
          },
          "nodeLabels": {
            "key1": "val1"
          },
          "nodeTaints": [
            "Key1=Value1:NoSchedule"
          ],
          "scaleSetPriority": "Spot",
          "scaleSetEvictionPolicy": "Delete",
          "spotMaxPrice": -1
        }
      }
- name: Create Agent Pool with PPG
  request:
    uri: PUT https://management.azure.com/subscriptions/subid1/resourceGroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1?api-version=2021-05-01
    body: >-
      {
        "properties": {
          "orchestratorVersion": "",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "osType": "Linux",
          "proximityPlacementGroupID": "/subscriptions/subid1/resourcegroups/rg1/providers//Microsoft.Compute/proximityPlacementGroups/ppg1"
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Succeeded",
          "orchestratorVersion": "1.9.6",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "maxPods": 110,
          "osType": "Linux",
          "proximityPlacementGroupID": "/subscriptions/subid1/resourcegroups/rg1/providers//Microsoft.Compute/proximityPlacementGroups/ppg1"
        }
      }
  - statusCode: "201"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Creating",
          "orchestratorVersion": "1.9.6",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "maxPods": 110,
          "osType": "Linux",
          "proximityPlacementGroupID": "/subscriptions/subid1/resourcegroups/rg1/providers//Microsoft.Compute/proximityPlacementGroups/ppg1"
        }
      }
- name: Create Agent Pool with OSSKU
  request:
    uri: PUT https://management.azure.com/subscriptions/subid1/resourceGroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1?api-version=2021-05-01
    body: >-
      {
        "properties": {
          "orchestratorVersion": "",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "osType": "Linux",
          "osSKU": "CBLMariner",
          "kubeletConfig": {
            "cpuManagerPolicy": "static",
            "cpuCfsQuota": true,
            "cpuCfsQuotaPeriod": "200ms",
            "imageGcHighThreshold": 90,
            "imageGcLowThreshold": 70,
            "topologyManagerPolicy": "best-effort",
            "allowedUnsafeSysctls": [
              "kernel.msg*",
              "net.core.somaxconn"
            ],
            "failSwapOn": false
          },
          "linuxOSConfig": {
            "sysctls": {
              "netCoreWmemDefault": 12345,
              "netIpv4TcpTwReuse": true,
              "netIpv4IpLocalPortRange": "20000 60000",
              "kernelThreadsMax": 99999
            },
            "transparentHugePageEnabled": "always",
            "transparentHugePageDefrag": "madvise",
            "swapFileSizeMB": 1500
          }
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Succeeded",
          "orchestratorVersion": "1.17.8",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "maxPods": 110,
          "osType": "Linux",
          "osSKU": "CBLMariner",
          "kubeletConfig": {
            "cpuManagerPolicy": "static",
            "cpuCfsQuota": true,
            "cpuCfsQuotaPeriod": "200ms",
            "imageGcHighThreshold": 90,
            "imageGcLowThreshold": 70,
            "topologyManagerPolicy": "best-effort",
            "allowedUnsafeSysctls": [
              "kernel.msg*",
              "net.core.somaxconn"
            ],
            "failSwapOn": false
          },
          "linuxOSConfig": {
            "sysctls": {
              "netCoreWmemDefault": 12345,
              "netIpv4TcpTwReuse": true,
              "netIpv4IpLocalPortRange": "20000 60000",
              "kernelThreadsMax": 99999
            },
            "transparentHugePageEnabled": "always",
            "transparentHugePageDefrag": "madvise",
            "swapFileSizeMB": 1500
          }
        }
      }
  - statusCode: "201"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Creating",
          "orchestratorVersion": "1.17.8",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "maxPods": 110,
          "osType": "Linux",
          "osSKU": "CBLMariner",
          "kubeletConfig": {
            "cpuManagerPolicy": "static",
            "cpuCfsQuota": true,
            "cpuCfsQuotaPeriod": "200ms",
            "imageGcHighThreshold": 90,
            "imageGcLowThreshold": 70,
            "topologyManagerPolicy": "best-effort",
            "allowedUnsafeSysctls": [
              "kernel.msg*",
              "net.core.somaxconn"
            ],
            "failSwapOn": false,
            "podMaxPids": 100
          },
          "linuxOSConfig": {
            "sysctls": {
              "netCoreWmemDefault": 65536,
              "netIpv4TcpTwReuse": true,
              "netIpv4IpLocalPortRange": "20000 60000",
              "kernelThreadsMax": 99999
            },
            "transparentHugePageEnabled": "always",
            "transparentHugePageDefrag": "madvise",
            "swapFileSizeMB": 1500
          }
        }
      }
- name: Create Agent Pool with GPUMIG
  request:
    uri: PUT https://management.azure.com/subscriptions/subid1/resourceGroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1?api-version=2021-05-01
    body: >-
      {
        "properties": {
          "orchestratorVersion": "",
          "count": 3,
          "vmSize": "Standard_ND96asr_v4",
          "osType": "Linux",
          "gpuInstanceProfile": "MIG2g",
          "kubeletConfig": {
            "cpuManagerPolicy": "static",
            "cpuCfsQuota": true,
            "cpuCfsQuotaPeriod": "200ms",
            "imageGcHighThreshold": 90,
            "imageGcLowThreshold": 70,
            "topologyManagerPolicy": "best-effort",
            "allowedUnsafeSysctls": [
              "kernel.msg*",
              "net.core.somaxconn"
            ],
            "failSwapOn": false
          },
          "linuxOSConfig": {
            "sysctls": {
              "netCoreWmemDefault": 12345,
              "netIpv4TcpTwReuse": true,
              "netIpv4IpLocalPortRange": "20000 60000",
              "kernelThreadsMax": 99999
            },
            "transparentHugePageEnabled": "always",
            "transparentHugePageDefrag": "madvise",
            "swapFileSizeMB": 1500
          }
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Succeeded",
          "orchestratorVersion": "1.17.8",
          "count": 3,
          "vmSize": "Standard_ND96asr_v4",
          "maxPods": 110,
          "osType": "Linux",
          "gpuInstanceProfile": "MIG2g",
          "kubeletConfig": {
            "cpuManagerPolicy": "static",
            "cpuCfsQuota": true,
            "cpuCfsQuotaPeriod": "200ms",
            "imageGcHighThreshold": 90,
            "imageGcLowThreshold": 70,
            "topologyManagerPolicy": "best-effort",
            "allowedUnsafeSysctls": [
              "kernel.msg*",
              "net.core.somaxconn"
            ],
            "failSwapOn": false
          },
          "linuxOSConfig": {
            "sysctls": {
              "netCoreWmemDefault": 12345,
              "netIpv4TcpTwReuse": true,
              "netIpv4IpLocalPortRange": "20000 60000",
              "kernelThreadsMax": 99999
            },
            "transparentHugePageEnabled": "always",
            "transparentHugePageDefrag": "madvise",
            "swapFileSizeMB": 1500
          }
        }
      }
  - statusCode: "201"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Creating",
          "orchestratorVersion": "1.17.8",
          "count": 3,
          "vmSize": "Standard_ND96asr_v4",
          "maxPods": 110,
          "osType": "Linux",
          "gpuInstanceProfile": "MIG2g",
          "kubeletConfig": {
            "cpuManagerPolicy": "static",
            "cpuCfsQuota": true,
            "cpuCfsQuotaPeriod": "200ms",
            "imageGcHighThreshold": 90,
            "imageGcLowThreshold": 70,
            "topologyManagerPolicy": "best-effort",
            "allowedUnsafeSysctls": [
              "kernel.msg*",
              "net.core.somaxconn"
            ],
            "failSwapOn": false,
            "podMaxPids": 100
          },
          "linuxOSConfig": {
            "sysctls": {
              "netCoreWmemDefault": 65536,
              "netIpv4TcpTwReuse": true,
              "netIpv4IpLocalPortRange": "20000 60000",
              "kernelThreadsMax": 99999
            },
            "transparentHugePageEnabled": "always",
            "transparentHugePageDefrag": "madvise",
            "swapFileSizeMB": 1500
          }
        }
      }
- name: Create Agent Pool with Ephemeral OS Disk
  request:
    uri: PUT https://management.azure.com/subscriptions/subid1/resourceGroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1?api-version=2021-05-01
    body: >-
      {
        "properties": {
          "orchestratorVersion": "",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "osType": "Linux",
          "osDiskType": "Ephemeral",
          "osDiskSizeGB": 64
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Succeeded",
          "orchestratorVersion": "1.17.8",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "maxPods": 110,
          "osType": "Linux",
          "osDiskType": "Ephemeral",
          "osDiskSizeGB": 64
        }
      }
  - statusCode: "201"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Creating",
          "orchestratorVersion": "1.17.8",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "maxPods": 110,
          "osType": "Linux",
          "osDiskType": "Ephemeral",
          "kubeletDiskType": "OS",
          "osDiskSizeGB": 64
        }
      }
- name: Create Agent Pool with KubeletConfig and LinuxOSConfig
  request:
    uri: PUT https://management.azure.com/subscriptions/subid1/resourceGroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1?api-version=2021-05-01
    body: >-
      {
        "properties": {
          "orchestratorVersion": "",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "osType": "Linux",
          "kubeletConfig": {
            "cpuManagerPolicy": "static",
            "cpuCfsQuota": true,
            "cpuCfsQuotaPeriod": "200ms",
            "imageGcHighThreshold": 90,
            "imageGcLowThreshold": 70,
            "topologyManagerPolicy": "best-effort",
            "allowedUnsafeSysctls": [
              "kernel.msg*",
              "net.core.somaxconn"
            ],
            "failSwapOn": false
          },
          "linuxOSConfig": {
            "sysctls": {
              "netCoreWmemDefault": 12345,
              "netIpv4TcpTwReuse": true,
              "netIpv4IpLocalPortRange": "20000 60000",
              "kernelThreadsMax": 99999
            },
            "transparentHugePageEnabled": "always",
            "transparentHugePageDefrag": "madvise",
            "swapFileSizeMB": 1500
          }
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Succeeded",
          "orchestratorVersion": "1.17.8",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "maxPods": 110,
          "osType": "Linux",
          "kubeletConfig": {
            "cpuManagerPolicy": "static",
            "cpuCfsQuota": true,
            "cpuCfsQuotaPeriod": "200ms",
            "imageGcHighThreshold": 90,
            "imageGcLowThreshold": 70,
            "topologyManagerPolicy": "best-effort",
            "allowedUnsafeSysctls": [
              "kernel.msg*",
              "net.core.somaxconn"
            ],
            "failSwapOn": false
          },
          "linuxOSConfig": {
            "sysctls": {
              "netCoreWmemDefault": 12345,
              "netIpv4TcpTwReuse": true,
              "netIpv4IpLocalPortRange": "20000 60000",
              "kernelThreadsMax": 99999
            },
            "transparentHugePageEnabled": "always",
            "transparentHugePageDefrag": "madvise",
            "swapFileSizeMB": 1500
          }
        }
      }
  - statusCode: "201"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Creating",
          "orchestratorVersion": "1.17.8",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "maxPods": 110,
          "osType": "Linux",
          "kubeletConfig": {
            "cpuManagerPolicy": "static",
            "cpuCfsQuota": true,
            "cpuCfsQuotaPeriod": "200ms",
            "imageGcHighThreshold": 90,
            "imageGcLowThreshold": 70,
            "topologyManagerPolicy": "best-effort",
            "allowedUnsafeSysctls": [
              "kernel.msg*",
              "net.core.somaxconn"
            ],
            "failSwapOn": false,
            "podMaxPids": 100
          },
          "linuxOSConfig": {
            "sysctls": {
              "netCoreWmemDefault": 65536,
              "netIpv4TcpTwReuse": true,
              "netIpv4IpLocalPortRange": "20000 60000",
              "kernelThreadsMax": 99999
            },
            "transparentHugePageEnabled": "always",
            "transparentHugePageDefrag": "madvise",
            "swapFileSizeMB": 1500
          }
        }
      }
- name: Create Agent Pool with EncryptionAtHost enabled
  request:
    uri: PUT https://management.azure.com/subscriptions/subid1/resourceGroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1?api-version=2021-05-01
    body: >-
      {
        "properties": {
          "orchestratorVersion": "",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "osType": "Linux",
          "enableEncryptionAtHost": true
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Succeeded",
          "orchestratorVersion": "1.17.13",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "maxPods": 110,
          "osType": "Linux",
          "enableEncryptionAtHost": true
        }
      }
  - statusCode: "201"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Creating",
          "orchestratorVersion": "1.17.13",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "maxPods": 110,
          "osType": "Linux",
          "enableEncryptionAtHost": true
        }
      }
- name: Create Agent Pool with UltraSSD enabled
  request:
    uri: PUT https://management.azure.com/subscriptions/subid1/resourceGroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1?api-version=2021-05-01
    body: >-
      {
        "properties": {
          "orchestratorVersion": "",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "osType": "Linux",
          "enableUltraSSD": true
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Succeeded",
          "orchestratorVersion": "1.17.13",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "maxPods": 110,
          "osType": "Linux",
          "enableUltraSSD": true
        }
      }
  - statusCode: "201"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Creating",
          "orchestratorVersion": "1.17.13",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "maxPods": 110,
          "osType": "Linux",
          "enableUltraSSD": true
        }
      }
- name: Create Agent Pool with FIPS enabled OS
  request:
    uri: PUT https://management.azure.com/subscriptions/subid1/resourceGroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1?api-version=2021-05-01
    body: >-
      {
        "properties": {
          "orchestratorVersion": "",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "osType": "Linux",
          "enableFIPS": true
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Succeeded",
          "orchestratorVersion": "1.19.6",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "maxPods": 110,
          "osType": "Linux",
          "enableFIPS": true
        }
      }
  - statusCode: "201"
    body: >-
      {
        "id": "/subscriptions/subid1/resourcegroups/rg1/providers/Microsoft.ContainerService/managedClusters/clustername1/agentPools/agentpool1",
        "type": "Microsoft.ContainerService/managedClusters/agentPools",
        "name": "agentpool1",
        "properties": {
          "provisioningState": "Creating",
          "orchestratorVersion": "1.19.6",
          "count": 3,
          "vmSize": "Standard_DS2_v2",
          "maxPods": 110,
          "osType": "Linux",
          "enableFIPS": true
        }
      }
security:
- name: azure_auth
  type: oauth2
  description: Azure Active Directory OAuth2 Flow
  flow: implicit
  authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
  scopes:
  - name: user_impersonation
    description: impersonate your user account
metadata:
  description: Learn more about AKS service - Creates or updates an agent pool in the specified managed cluster.
errorCodes: []
