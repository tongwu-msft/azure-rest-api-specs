### YamlMime:RESTOperation
uid: management.azure.com.policy.policydefinitions.createorupdateatmanagementgroup
name: Create Or Update At Management Group
service: Policy
groupName: Policy Definitions
apiVersion: 2021-06-01
summary: "Creates or updates a policy definition in a management group.  \nThis operation creates or updates a policy definition in the given management group with the given name."
consumes:
- application/json
produces:
- application/json
paths:
- content: PUT https://management.azure.com/providers/Microsoft.Management/managementGroups/{managementGroupId}/providers/Microsoft.Authorization/policyDefinitions/{policyDefinitionName}?api-version=2021-06-01
uriParameters:
- name: managementGroupId
  in: path
  isRequired: true
  description: The ID of the management group.
  types:
  - uid: string
- name: policyDefinitionName
  in: path
  isRequired: true
  description: The name of the policy definition to create.
  types:
  - uid: string
- name: api-version
  in: query
  isRequired: true
  description: The API version to use for the operation.
  types:
  - uid: string
responses:
- name: 201 Created
  description: Created - Returns information about the policy definition.
  types:
  - uid: PolicyDefinition
- name: Other Status Codes
  description: Error response describing why the operation failed.
  types:
  - uid: CloudError
requestBody:
- name: default
  parameters:
  - name: properties.policyType
    in: body
    description: The type of policy definition. Possible values are NotSpecified, BuiltIn, Custom, and Static.
    types:
    - uid: policyType
  - name: properties.mode
    in: body
    description: The policy definition mode. Some examples are All, Indexed, Microsoft.KeyVault.Data.
    types:
    - uid: string
  - name: properties.displayName
    in: body
    description: The display name of the policy definition.
    types:
    - uid: string
  - name: properties.description
    in: body
    description: The policy definition description.
    types:
    - uid: string
  - name: properties.policyRule
    in: body
    description: The policy rule.
    types:
    - uid: object
  - name: properties.metadata
    in: body
    description: The policy definition metadata.  Metadata is an open ended object and is typically a collection of key value pairs.
    types:
    - uid: object
  - name: properties.parameters
    in: body
    description: The parameter definitions for parameters used in the policy rule. The keys are the parameter names.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: ParameterDefinitionsValue
requestHeader: []
definitions:
- name: systemData
  description: Metadata pertaining to creation and last modification of the resource.
  kind: object
  properties:
  - name: createdBy
    description: The identity that created the resource.
    types:
    - uid: string
  - name: createdByType
    description: The type of identity that created the resource.
    types:
    - uid: createdByType
  - name: createdAt
    description: The timestamp of resource creation (UTC).
    types:
    - uid: string
  - name: lastModifiedBy
    description: The identity that last modified the resource.
    types:
    - uid: string
  - name: lastModifiedByType
    description: The type of identity that last modified the resource.
    types:
    - uid: createdByType
  - name: lastModifiedAt
    description: The timestamp of resource last modification (UTC)
    types:
    - uid: string
- name: ParameterDefinitionsValue
  description: The definition of a parameter that can be provided to the policy.
  kind: object
  properties:
  - name: type
    description: The data type of the parameter.
    types:
    - uid: parameterType
  - name: allowedValues
    description: The allowed values for the parameter.
    types:
    - uid: object
      isArray: true
  - name: defaultValue
    description: The default value for the parameter if no value is provided.
    types:
    - uid: object
  - name: metadata
    description: General metadata for the parameter.
    types:
    - uid: Metadata
- name: PolicyDefinition
  description: The policy definition.
  kind: object
  properties:
  - name: id
    isReadyOnly: true
    description: The ID of the policy definition.
    types:
    - uid: string
  - name: name
    isReadyOnly: true
    description: The name of the policy definition.
    types:
    - uid: string
  - name: type
    isReadyOnly: true
    description: The type of the resource (Microsoft.Authorization/policyDefinitions).
    types:
    - uid: string
  - name: systemData
    isReadyOnly: true
    description: The system metadata relating to this resource.
    types:
    - uid: systemData
  - name: properties.policyType
    description: The type of policy definition. Possible values are NotSpecified, BuiltIn, Custom, and Static.
    types:
    - uid: policyType
  - name: properties.mode
    description: The policy definition mode. Some examples are All, Indexed, Microsoft.KeyVault.Data.
    types:
    - uid: string
    defaultValue: Indexed
  - name: properties.displayName
    description: The display name of the policy definition.
    types:
    - uid: string
  - name: properties.description
    description: The policy definition description.
    types:
    - uid: string
  - name: properties.policyRule
    description: The policy rule.
    types:
    - uid: object
  - name: properties.metadata
    description: The policy definition metadata.  Metadata is an open ended object and is typically a collection of key value pairs.
    types:
    - uid: object
  - name: properties.parameters
    description: The parameter definitions for parameters used in the policy rule. The keys are the parameter names.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: ParameterDefinitionsValue
- name: CloudError
  description: An error response from a policy operation.
  kind: object
  properties:
  - name: error
    description: "Error Response  \nCommon error response for all Azure Resource Manager APIs to return error details for failed operations. (This also follows the OData error response format.)"
    types:
    - uid: ErrorResponse
- name: createdByType
  description: The type of identity that created the resource.
  kind: enum
  properties:
  - name: User
    types:
    - uid: string
  - name: Application
    types:
    - uid: string
  - name: ManagedIdentity
    types:
    - uid: string
  - name: Key
    types:
    - uid: string
- name: parameterType
  description: The data type of the parameter.
  kind: enum
  properties:
  - name: String
    types:
    - uid: string
  - name: Array
    types:
    - uid: string
  - name: Object
    types:
    - uid: string
  - name: Boolean
    types:
    - uid: string
  - name: Integer
    types:
    - uid: string
  - name: Float
    types:
    - uid: string
  - name: DateTime
    types:
    - uid: string
- name: Metadata
  description: General metadata for the parameter.
  kind: object
  properties:
  - name: displayName
    description: The display name for the parameter.
    types:
    - uid: string
  - name: description
    description: The description of the parameter.
    types:
    - uid: string
  - name: strongType
    description: Used when assigning the policy definition through the portal. Provides a context aware list of values for the user to choose from.
    types:
    - uid: string
  - name: assignPermissions
    description: Set to true to have Azure portal create role assignments on the resource ID or resource scope value of this parameter during policy assignment. This property is useful in case you wish to assign permissions outside the assignment scope.
    types:
    - uid: boolean
- name: policyType
  description: The type of policy definition. Possible values are NotSpecified, BuiltIn, Custom, and Static.
  kind: enum
  properties:
  - name: NotSpecified
    types:
    - uid: string
  - name: BuiltIn
    types:
    - uid: string
  - name: Custom
    types:
    - uid: string
  - name: Static
    types:
    - uid: string
- name: ErrorResponse
  description: Error Response
  kind: object
  properties:
  - name: code
    isReadyOnly: true
    description: The error code.
    types:
    - uid: string
  - name: message
    isReadyOnly: true
    description: The error message.
    types:
    - uid: string
  - name: target
    isReadyOnly: true
    description: The error target.
    types:
    - uid: string
  - name: details
    isReadyOnly: true
    description: The error details.
    types:
    - uid: ErrorResponse
      isArray: true
  - name: additionalInfo
    isReadyOnly: true
    description: The error additional info.
    types:
    - uid: ErrorAdditionalInfo
      isArray: true
- name: ErrorAdditionalInfo
  description: The resource management error additional info.
  kind: object
  properties:
  - name: type
    isReadyOnly: true
    description: The additional info type.
    types:
    - uid: string
  - name: info
    isReadyOnly: true
    description: The additional info.
    types:
    - uid: object
examples:
- name: Create or update a policy definition at management group level
  request:
    uri: PUT https://management.azure.com/providers/Microsoft.Management/managementGroups/MyManagementGroup/providers/Microsoft.Authorization/policyDefinitions/ResourceNaming?api-version=2021-06-01
    body: >-
      {
        "properties": {
          "mode": "All",
          "displayName": "Enforce resource naming convention",
          "description": "Force resource names to begin with given 'prefix' and/or end with given 'suffix'",
          "metadata": {
            "category": "Naming"
          },
          "policyRule": {
            "if": {
              "not": {
                "field": "name",
                "like": "[concat(parameters('prefix'), '*', parameters('suffix'))]"
              }
            },
            "then": {
              "effect": "deny"
            }
          },
          "parameters": {
            "prefix": {
              "type": "String",
              "metadata": {
                "displayName": "Prefix",
                "description": "Resource name prefix"
              }
            },
            "suffix": {
              "type": "String",
              "metadata": {
                "displayName": "Suffix",
                "description": "Resource name suffix"
              }
            }
          }
        }
      }
    codeTab: |+
      # [HTTP](#tab/HTTP)
      ``` http
      PUT https://management.azure.com/providers/Microsoft.Management/managementGroups/MyManagementGroup/providers/Microsoft.Authorization/policyDefinitions/ResourceNaming?api-version=2021-06-01

      {
        "properties": {
          "mode": "All",
          "displayName": "Enforce resource naming convention",
          "description": "Force resource names to begin with given 'prefix' and/or end with given 'suffix'",
          "metadata": {
            "category": "Naming"
          },
          "policyRule": {
            "if": {
              "not": {
                "field": "name",
                "like": "[concat(parameters('prefix'), '*', parameters('suffix'))]"
              }
            },
            "then": {
              "effect": "deny"
            }
          },
          "parameters": {
            "prefix": {
              "type": "String",
              "metadata": {
                "displayName": "Prefix",
                "description": "Resource name prefix"
              }
            },
            "suffix": {
              "type": "String",
              "metadata": {
                "displayName": "Suffix",
                "description": "Resource name suffix"
              }
            }
          }
        }
      }

      ```

      # [Java](#tab/Java)
      ``` java
      import com.azure.core.management.serializer.SerializerFactory;
      import com.azure.core.util.Context;
      import com.azure.core.util.serializer.SerializerEncoding;
      import com.azure.resourcemanager.resources.fluent.models.PolicyDefinitionInner;
      import com.azure.resourcemanager.resources.models.ParameterDefinitionsValue;
      import com.azure.resourcemanager.resources.models.ParameterDefinitionsValueMetadata;
      import com.azure.resourcemanager.resources.models.ParameterType;
      import java.io.IOException;
      import java.util.HashMap;
      import java.util.Map;

      /** Samples for PolicyDefinitions CreateOrUpdateAtManagementGroup. */
      public final class Main {
          /*
           * x-ms-original-file: specification/resources/resource-manager/Microsoft.Authorization/stable/2021-06-01/examples/createOrUpdatePolicyDefinitionAtManagementGroup.json
           */
          /**
           * Sample code: Create or update a policy definition at management group level.
           *
           * @param azure The entry point for accessing resource management APIs in Azure.
           */
          public static void createOrUpdateAPolicyDefinitionAtManagementGroupLevel(
              com.azure.resourcemanager.AzureResourceManager azure) throws IOException {
              azure
                  .genericResources()
                  .manager()
                  .policyClient()
                  .getPolicyDefinitions()
                  .createOrUpdateAtManagementGroupWithResponse(
                      "ResourceNaming",
                      "MyManagementGroup",
                      new PolicyDefinitionInner()
                          .withMode("All")
                          .withDisplayName("Enforce resource naming convention")
                          .withDescription("Force resource names to begin with given 'prefix' and/or end with given 'suffix'")
                          .withPolicyRule(
                              SerializerFactory
                                  .createDefaultManagementSerializerAdapter()
                                  .deserialize(
                                      "{\"if\":{\"not\":{\"field\":\"name\",\"like\":\"[concat(parameters('prefix'), '*',"
                                          + " parameters('suffix'))]\"}},\"then\":{\"effect\":\"deny\"}}",
                                      Object.class,
                                      SerializerEncoding.JSON))
                          .withMetadata(
                              SerializerFactory
                                  .createDefaultManagementSerializerAdapter()
                                  .deserialize("{\"category\":\"Naming\"}", Object.class, SerializerEncoding.JSON))
                          .withParameters(
                              mapOf(
                                  "prefix",
                                  new ParameterDefinitionsValue()
                                      .withType(ParameterType.STRING)
                                      .withMetadata(
                                          new ParameterDefinitionsValueMetadata()
                                              .withDisplayName("Prefix")
                                              .withDescription("Resource name prefix")
                                              .withAdditionalProperties(mapOf())),
                                  "suffix",
                                  new ParameterDefinitionsValue()
                                      .withType(ParameterType.STRING)
                                      .withMetadata(
                                          new ParameterDefinitionsValueMetadata()
                                              .withDisplayName("Suffix")
                                              .withDescription("Resource name suffix")
                                              .withAdditionalProperties(mapOf())))),
                      Context.NONE);
          }

          @SuppressWarnings("unchecked")
          private static <T> Map<String, T> mapOf(Object... inputs) {
              Map<String, T> map = new HashMap<>();
              for (int i = 0; i < inputs.length; i += 2) {
                  String key = (String) inputs[i];
                  T value = (T) inputs[i + 1];
                  map.put(key, value);
              }
              return map;
          }
      }

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-java/blob/azure-resourcemanager_2.17.0/sdk/resourcemanager/azure-resourcemanager/README.md) on how to add the SDK to your project and authenticate.
      # [Go](#tab/Go)
      ``` go
      package armpolicy_test

      import (
      	"context"
      	"log"

      	"github.com/Azure/azure-sdk-for-go/sdk/azcore/to"
      	"github.com/Azure/azure-sdk-for-go/sdk/azidentity"
      	"github.com/Azure/azure-sdk-for-go/sdk/resourcemanager/resources/armpolicy"
      )

      // Generated from example definition: https://github.com/Azure/azure-rest-api-specs/tree/main/specification/resources/resource-manager/Microsoft.Authorization/stable/2021-06-01/examples/createOrUpdatePolicyDefinitionAtManagementGroup.json
      func ExampleDefinitionsClient_CreateOrUpdateAtManagementGroup() {
      	cred, err := azidentity.NewDefaultAzureCredential(nil)
      	if err != nil {
      		log.Fatalf("failed to obtain a credential: %v", err)
      	}
      	ctx := context.Background()
      	client, err := armpolicy.NewDefinitionsClient("<subscription-id>", cred, nil)
      	if err != nil {
      		log.Fatalf("failed to create client: %v", err)
      	}
      	_, err = client.CreateOrUpdateAtManagementGroup(ctx,
      		"ResourceNaming",
      		"MyManagementGroup",
      		armpolicy.Definition{
      			Properties: &armpolicy.DefinitionProperties{
      				Description: to.Ptr("Force resource names to begin with given 'prefix' and/or end with given 'suffix'"),
      				DisplayName: to.Ptr("Enforce resource naming convention"),
      				Metadata: map[string]interface{}{
      					"category": "Naming",
      				},
      				Mode: to.Ptr("All"),
      				Parameters: map[string]*armpolicy.ParameterDefinitionsValue{
      					"prefix": {
      						Type: to.Ptr(armpolicy.ParameterTypeString),
      						Metadata: &armpolicy.ParameterDefinitionsValueMetadata{
      							Description: to.Ptr("Resource name prefix"),
      							DisplayName: to.Ptr("Prefix"),
      						},
      					},
      					"suffix": {
      						Type: to.Ptr(armpolicy.ParameterTypeString),
      						Metadata: &armpolicy.ParameterDefinitionsValueMetadata{
      							Description: to.Ptr("Resource name suffix"),
      							DisplayName: to.Ptr("Suffix"),
      						},
      					},
      				},
      				PolicyRule: map[string]interface{}{
      					"if": map[string]interface{}{
      						"not": map[string]interface{}{
      							"field": "name",
      							"like":  "[concat(parameters('prefix'), '*', parameters('suffix'))]",
      						},
      					},
      					"then": map[string]interface{}{
      						"effect": "deny",
      					},
      				},
      			},
      		},
      		nil)
      	if err != nil {
      		log.Fatalf("failed to finish the request: %v", err)
      	}
      }

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-go/blob/sdk%2Fresourcemanager%2Fresources%2Farmpolicy%2Fv0.6.0/sdk/resourcemanager/resources/armpolicy/README.md) on how to add the SDK to your project and authenticate.
      # [JavaScript](#tab/JavaScript)
      ``` js
      const { PolicyClient } = require("@azure/arm-policy");
      const { DefaultAzureCredential } = require("@azure/identity");

      /**
       * This sample demonstrates how to This operation creates or updates a policy definition in the given management group with the given name.
       *
       * @summary This operation creates or updates a policy definition in the given management group with the given name.
       * x-ms-original-file: specification/resources/resource-manager/Microsoft.Authorization/stable/2021-06-01/examples/createOrUpdatePolicyDefinitionAtManagementGroup.json
       */
      async function createOrUpdateAPolicyDefinitionAtManagementGroupLevel() {
        const subscriptionId = "00000000-0000-0000-0000-000000000000";
        const policyDefinitionName = "ResourceNaming";
        const managementGroupId = "MyManagementGroup";
        const parameters = {
          description: "Force resource names to begin with given 'prefix' and/or end with given 'suffix'",
          displayName: "Enforce resource naming convention",
          metadata: { category: "Naming" },
          mode: "All",
          parameters: {
            prefix: {
              type: "String",
              metadata: { description: "Resource name prefix", displayName: "Prefix" },
            },
            suffix: {
              type: "String",
              metadata: { description: "Resource name suffix", displayName: "Suffix" },
            },
          },
          policyRule: {
            if: {
              not: {
                field: "name",
                like: "[concat(parameters('prefix'), '*', parameters('suffix'))]",
              },
            },
            then: { effect: "deny" },
          },
        };
        const credential = new DefaultAzureCredential();
        const client = new PolicyClient(credential, subscriptionId);
        const result = await client.policyDefinitions.createOrUpdateAtManagementGroup(
          policyDefinitionName,
          managementGroupId,
          parameters
        );
        console.log(result);
      }

      createOrUpdateAPolicyDefinitionAtManagementGroupLevel().catch(console.error);

      ```
      Read this [SDK documentation](https://github.com/Azure/azure-sdk-for-js/blob/%40azure%2Farm-policy_5.0.2/sdk/policy/arm-policy/README.md) on how to add the SDK to your project and authenticate.
  responses:
  - statusCode: "201"
    body: >-
      {
        "id": "/providers/Microsoft.Management/managementgroups/MyManagementGroup/providers/Microsoft.Authorization/policyDefinitions/ResourceNaming",
        "type": "Microsoft.Authorization/policyDefinitions",
        "name": "ResourceNaming",
        "properties": {
          "mode": "All",
          "displayName": "Naming Convention",
          "description": "Force resource names to begin with 'prefix' and end with 'suffix'",
          "metadata": {
            "category": "Naming"
          },
          "policyRule": {
            "if": {
              "not": {
                "field": "name",
                "like": "[concat(parameters('prefix'), '*', parameters('suffix'))]"
              }
            },
            "then": {
              "effect": "deny"
            }
          },
          "parameters": {
            "prefix": {
              "type": "String",
              "metadata": {
                "displayName": "Prefix",
                "description": "Resource name prefix"
              }
            },
            "suffix": {
              "type": "String",
              "metadata": {
                "displayName": "Suffix",
                "description": "Resource name suffix"
              }
            }
          },
          "policyType": "Custom"
        }
      }
security:
- name: azure_auth
  type: oauth2
  description: Azure Active Directory OAuth2 Flow
  flow: implicit
  authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
  scopes:
  - name: user_impersonation
    description: impersonate your user account
metadata:
  description: >-
    Creates or updates a policy definition in a management group.

    This operation creates or updates a policy definition in the given management group with the given
errorCodes: []
