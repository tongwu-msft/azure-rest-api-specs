### YamlMime:RESTOperation
uid: management.azure.com.securitycenter.devicesecuritygroups.createorupdate
name: Create Or Update
service: Security Center
groupName: Device Security Groups
apiVersion: 2019-08-01
summary: Use this method to creates or updates the device security group on a specified IoT Hub resource.
consumes:
- application/json
produces:
- application/json
paths:
- content: PUT https://management.azure.com/{resourceId}/providers/Microsoft.Security/deviceSecurityGroups/{deviceSecurityGroupName}?api-version=2019-08-01
uriParameters:
- name: resourceId
  in: path
  isRequired: true
  skipUrlEncoding: true
  description: The identifier of the resource.
  types:
  - uid: string
- name: deviceSecurityGroupName
  in: path
  isRequired: true
  description: The name of the device security group. Note that the name of the device security group is case insensitive.
  types:
  - uid: string
- name: api-version
  in: query
  isRequired: true
  description: API version for the operation
  types:
  - uid: string
responses:
- name: 200 OK
  description: Security group was updated.
  types:
  - uid: DeviceSecurityGroup
- name: 201 Created
  description: Security group was created.
  types:
  - uid: DeviceSecurityGroup
- name: Other Status Codes
  description: Error response describing why the operation failed.
  types:
  - uid: CloudError
requestBody:
- name: default
  parameters:
  - name: properties.thresholdRules
    in: body
    description: The list of custom alert threshold rules.
    types:
    - uid: ThresholdCustomAlertRule
      isArray: true
  - name: properties.timeWindowRules
    in: body
    description: The list of custom alert time-window rules.
    types:
    - uid: TimeWindowCustomAlertRule
      isArray: true
  - name: properties.allowlistRules
    in: body
    description: The allow-list custom alert rules.
    types:
    - uid: AllowlistCustomAlertRule
      isArray: true
  - name: properties.denylistRules
    in: body
    description: The deny-list custom alert rules.
    types:
    - uid: DenylistCustomAlertRule
      isArray: true
requestHeader: []
definitions:
- name: ThresholdCustomAlertRule
  description: A custom alert rule that checks if a value (depends on the custom alert type) is within the given range.
  kind: object
  properties:
  - name: minThreshold
    description: The minimum threshold.
    types:
    - uid: integer
  - name: maxThreshold
    description: The maximum threshold.
    types:
    - uid: integer
  - name: displayName
    isReadyOnly: true
    description: The display name of the custom alert.
    types:
    - uid: string
  - name: description
    isReadyOnly: true
    description: The description of the custom alert.
    types:
    - uid: string
  - name: isEnabled
    description: Status of the custom alert.
    types:
    - uid: boolean
  - name: ruleType
    description: The type of the custom alert rule.
    types:
    - uid: string
- name: TimeWindowCustomAlertRule
  description: A custom alert rule that checks if the number of activities (depends on the custom alert type) in a time window is within the given range.
  kind: object
  properties:
  - name: timeWindowSize
    description: The time window size in iso8601 format.
    types:
    - uid: string
  - name: minThreshold
    description: The minimum threshold.
    types:
    - uid: integer
  - name: maxThreshold
    description: The maximum threshold.
    types:
    - uid: integer
  - name: displayName
    isReadyOnly: true
    description: The display name of the custom alert.
    types:
    - uid: string
  - name: description
    isReadyOnly: true
    description: The description of the custom alert.
    types:
    - uid: string
  - name: isEnabled
    description: Status of the custom alert.
    types:
    - uid: boolean
  - name: ruleType
    description: The type of the custom alert rule.
    types:
    - uid: string
- name: AllowlistCustomAlertRule
  description: A custom alert rule that checks if a value (depends on the custom alert type) is allowed.
  kind: object
  properties:
  - name: allowlistValues
    description: The values to allow. The format of the values depends on the rule type.
    types:
    - uid: string
      isArray: true
  - name: valueType
    isReadyOnly: true
    description: The value type of the items in the list.
    types:
    - uid: valueType
  - name: displayName
    isReadyOnly: true
    description: The display name of the custom alert.
    types:
    - uid: string
  - name: description
    isReadyOnly: true
    description: The description of the custom alert.
    types:
    - uid: string
  - name: isEnabled
    description: Status of the custom alert.
    types:
    - uid: boolean
  - name: ruleType
    description: The type of the custom alert rule.
    types:
    - uid: string
- name: DenylistCustomAlertRule
  description: A custom alert rule that checks if a value (depends on the custom alert type) is denied.
  kind: object
  properties:
  - name: denylistValues
    description: The values to deny. The format of the values depends on the rule type.
    types:
    - uid: string
      isArray: true
  - name: valueType
    isReadyOnly: true
    description: The value type of the items in the list.
    types:
    - uid: valueType
  - name: displayName
    isReadyOnly: true
    description: The display name of the custom alert.
    types:
    - uid: string
  - name: description
    isReadyOnly: true
    description: The description of the custom alert.
    types:
    - uid: string
  - name: isEnabled
    description: Status of the custom alert.
    types:
    - uid: boolean
  - name: ruleType
    description: The type of the custom alert rule.
    types:
    - uid: string
- name: DeviceSecurityGroup
  description: The device security group resource
  kind: object
  properties:
  - name: properties.thresholdRules
    description: The list of custom alert threshold rules.
    types:
    - uid: ThresholdCustomAlertRule
      isArray: true
  - name: properties.timeWindowRules
    description: The list of custom alert time-window rules.
    types:
    - uid: TimeWindowCustomAlertRule
      isArray: true
  - name: properties.allowlistRules
    description: The allow-list custom alert rules.
    types:
    - uid: AllowlistCustomAlertRule
      isArray: true
  - name: properties.denylistRules
    description: The deny-list custom alert rules.
    types:
    - uid: DenylistCustomAlertRule
      isArray: true
  - name: id
    isReadyOnly: true
    description: Resource Id
    types:
    - uid: string
  - name: name
    isReadyOnly: true
    description: Resource name
    types:
    - uid: string
  - name: type
    isReadyOnly: true
    description: Resource type
    types:
    - uid: string
- name: CloudError
  description: Error response structure.
  kind: object
  properties:
  - name: error.code
    isReadyOnly: true
    description: An identifier for the error. Codes are invariant and are intended to be consumed programmatically.
    types:
    - uid: string
  - name: error.message
    isReadyOnly: true
    description: A message describing the error, intended to be suitable for display in a user interface.
    types:
    - uid: string
- name: valueType
  description: The value type of the items in the list.
  kind: enum
  properties:
  - name: IpCidr
    description: An IP range in CIDR format (e.g. '192.168.0.1/8').
    types:
    - uid: string
  - name: String
    description: Any string value.
    types:
    - uid: string
examples:
- name: Create or update a device security group for the specified IoT hub resource
  request:
    uri: PUT https://management.azure.com/subscriptions/20ff7fc3-e762-44dd-bd96-b71116dcdc23/resourceGroups/SampleRG/providers/Microsoft.Devices/iotHubs/sampleiothub/providers/Microsoft.Security/deviceSecurityGroups/samplesecuritygroup?api-version=2019-08-01
    body: >-
      {
        "id": "/subscriptions/20ff7fc3-e762-44dd-bd96-b71116dcdc23/resourceGroups/SampleRG/providers/Microsoft.Devices/iotHubs/sampleiothub/providers/Microsoft.Security/deviceSecurityGroups/samplesecuritygroup",
        "name": "samplesecuritygroup",
        "type": "Microsoft.Security/deviceSecurityGroups",
        "properties": {
          "timeWindowRules": [
            {
              "ruleType": "ActiveConnectionsNotInAllowedRange",
              "displayName": "Number of active connections is not in allowed range",
              "description": "Get an alert when the number of active connections of a device in the time window is not in the allowed range",
              "isEnabled": true,
              "minThreshold": 0,
              "maxThreshold": 30,
              "timeWindowSize": "PT05M"
            }
          ]
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "/subscriptions/20ff7fc3-e762-44dd-bd96-b71116dcdc23/resourceGroups/SampleRG/providers/Microsoft.Devices/iotHubs/sampleiothub/providers/Microsoft.Security/deviceSecurityGroups/samplesecuritygroup",
        "name": "samplesecuritygroup",
        "type": "Microsoft.Security/deviceSecurityGroups",
        "properties": {
          "thresholdRules": [],
          "timeWindowRules": [
            {
              "ruleType": "ActiveConnectionsNotInAllowedRange",
              "displayName": "Number of active connections is not in allowed range",
              "description": "Get an alert when the number of active connections of a device in the time window is not in the allowed range",
              "isEnabled": true,
              "minThreshold": 0,
              "maxThreshold": 30,
              "timeWindowSize": "PT05M"
            },
            {
              "ruleType": "AmqpC2DMessagesNotInAllowedRange",
              "displayName": "Number of cloud to device messages (AMQP protocol) is not in allowed range",
              "description": "Get an alert when the number of cloud to device messages (AMQP protocol) in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "MqttC2DMessagesNotInAllowedRange",
              "displayName": "Number of cloud to device messages (MQTT protocol) is not in allowed range",
              "description": "Get an alert when the number of cloud to device messages (MQTT protocol) in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "HttpC2DMessagesNotInAllowedRange",
              "displayName": "Number of cloud to device messages (HTTP protocol) is not in allowed range",
              "description": "Get an alert when the number of cloud to device messages (HTTP protocol) in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "AmqpC2DRejectedMessagesNotInAllowedRange",
              "displayName": "Number of rejected cloud to device messages (AMQP protocol) is not in allowed range",
              "description": "Get an alert when the number of cloud to device messages (AMQP protocol) that were rejected by the device in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "MqttC2DRejectedMessagesNotInAllowedRange",
              "displayName": "Number of rejected cloud to device messages (MQTT protocol) is not in allowed range",
              "description": "Get an alert when the number of cloud to device messages (MQTT protocol) that were rejected by the device in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "HttpC2DRejectedMessagesNotInAllowedRange",
              "displayName": "Number of rejected cloud to device messages (HTTP protocol) is not in allowed range",
              "description": "Get an alert when the number of cloud to device messages (HTTP protocol) that were rejected by the device in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "AmqpD2CMessagesNotInAllowedRange",
              "displayName": "Number of device to cloud messages (AMQP protocol) is not in allowed range",
              "description": "Get an alert when the number of device to cloud messages (AMQP protocol) in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "MqttD2CMessagesNotInAllowedRange",
              "displayName": "Number of device to cloud messages (MQTT protocol) is not in allowed range",
              "description": "Get an alert when the number of device to cloud messages (MQTT protocol) in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "HttpD2CMessagesNotInAllowedRange",
              "displayName": "Number of device to cloud messages (HTTP protocol) is not in allowed range",
              "description": "Get an alert when the number of device to cloud messages (HTTP protocol) in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "DirectMethodInvokesNotInAllowedRange",
              "displayName": "Number of direct method invokes is not in allowed range",
              "description": "Get an alert when the number of direct method invokes in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "FailedLocalLoginsNotInAllowedRange",
              "displayName": "Number of failed local logins is not in allowed range",
              "description": "Get an alert when the number of failed local logins on the device in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "FileUploadsNotInAllowedRange",
              "displayName": "Number of file uploads is not in allowed range",
              "description": "Get an alert when the number of file uploads from the device to the cloud in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "QueuePurgesNotInAllowedRange",
              "displayName": "Number of device queue purges is not in allowed range",
              "description": "Get an alert when the number of device queue purges in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "TwinUpdatesNotInAllowedRange",
              "displayName": "Number of twin updates is not in allowed range",
              "description": "Get an alert when the number of twin updates (by the device or the service) in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "UnauthorizedOperationsNotInAllowedRange",
              "displayName": "Number of unauthorized operations is not in allowed range",
              "description": "Get an alert when the number unauthorized operations in the time window is not in the allowed range. Unauthorized operations are operations that affect the device (or done by it) that fail because of an unauthorized error",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            }
          ],
          "allowlistRules": [
            {
              "ruleType": "ConnectionToIpNotAllowed",
              "displayName": "Outbound connection to an ip that isn't allowed",
              "description": "Get an alert when an outbound connection is created between your device and an ip that isn't allowed",
              "isEnabled": false,
              "allowlistValues": []
            },
            {
              "ruleType": "LocalUserNotAllowed",
              "displayName": "Login by a local user that isn't allowed",
              "description": "Get an alert when a local user that isn't allowed logins to the device",
              "isEnabled": false,
              "allowlistValues": []
            },
            {
              "ruleType": "ProcessNotAllowed",
              "displayName": "Execution of a process that isn't allowed",
              "description": "Get an alert when a process that isn't allowed is executed",
              "isEnabled": false,
              "allowlistValues": []
            }
          ],
          "denylistRules": []
        }
      }
  - statusCode: "201"
    body: >-
      {
        "id": "/subscriptions/20ff7fc3-e762-44dd-bd96-b71116dcdc23/resourceGroups/SampleRG/providers/Microsoft.Devices/iotHubs/sampleiothub/providers/Microsoft.Security/deviceSecurityGroups/samplesecuritygroup",
        "name": "samplesecuritygroup",
        "type": "Microsoft.Security/deviceSecurityGroups",
        "properties": {
          "thresholdRules": [],
          "timeWindowRules": [
            {
              "ruleType": "ActiveConnectionsNotInAllowedRange",
              "displayName": "Number of active connections is not in allowed range",
              "description": "Get an alert when the number of active connections of a device in the time window is not in the allowed range",
              "isEnabled": true,
              "minThreshold": 0,
              "maxThreshold": 30,
              "timeWindowSize": "PT05M"
            },
            {
              "ruleType": "AmqpC2DMessagesNotInAllowedRange",
              "displayName": "Number of cloud to device messages (AMQP protocol) is not in allowed range",
              "description": "Get an alert when the number of cloud to device messages (AMQP protocol) in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "MqttC2DMessagesNotInAllowedRange",
              "displayName": "Number of cloud to device messages (MQTT protocol) is not in allowed range",
              "description": "Get an alert when the number of cloud to device messages (MQTT protocol) in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "HttpC2DMessagesNotInAllowedRange",
              "displayName": "Number of cloud to device messages (HTTP protocol) is not in allowed range",
              "description": "Get an alert when the number of cloud to device messages (HTTP protocol) in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "AmqpC2DRejectedMessagesNotInAllowedRange",
              "displayName": "Number of rejected cloud to device messages (AMQP protocol) is not in allowed range",
              "description": "Get an alert when the number of cloud to device messages (AMQP protocol) that were rejected by the device in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "MqttC2DRejectedMessagesNotInAllowedRange",
              "displayName": "Number of rejected cloud to device messages (MQTT protocol) is not in allowed range",
              "description": "Get an alert when the number of cloud to device messages (MQTT protocol) that were rejected by the device in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "HttpC2DRejectedMessagesNotInAllowedRange",
              "displayName": "Number of rejected cloud to device messages (HTTP protocol) is not in allowed range",
              "description": "Get an alert when the number of cloud to device messages (HTTP protocol) that were rejected by the device in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "AmqpD2CMessagesNotInAllowedRange",
              "displayName": "Number of device to cloud messages (AMQP protocol) is not in allowed range",
              "description": "Get an alert when the number of device to cloud messages (AMQP protocol) in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "MqttD2CMessagesNotInAllowedRange",
              "displayName": "Number of device to cloud messages (MQTT protocol) is not in allowed range",
              "description": "Get an alert when the number of device to cloud messages (MQTT protocol) in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "HttpD2CMessagesNotInAllowedRange",
              "displayName": "Number of device to cloud messages (HTTP protocol) is not in allowed range",
              "description": "Get an alert when the number of device to cloud messages (HTTP protocol) in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "DirectMethodInvokesNotInAllowedRange",
              "displayName": "Number of direct method invokes is not in allowed range",
              "description": "Get an alert when the number of direct method invokes in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "FailedLocalLoginsNotInAllowedRange",
              "displayName": "Number of failed local logins is not in allowed range",
              "description": "Get an alert when the number of failed local logins on the device in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "FileUploadsNotInAllowedRange",
              "displayName": "Number of file uploads is not in allowed range",
              "description": "Get an alert when the number of file uploads from the device to the cloud in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "QueuePurgesNotInAllowedRange",
              "displayName": "Number of device queue purges is not in allowed range",
              "description": "Get an alert when the number of device queue purges in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "TwinUpdatesNotInAllowedRange",
              "displayName": "Number of twin updates is not in allowed range",
              "description": "Get an alert when the number of twin updates (by the device or the service) in the time window is not in the allowed range",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            },
            {
              "ruleType": "UnauthorizedOperationsNotInAllowedRange",
              "displayName": "Number of unauthorized operations is not in allowed range",
              "description": "Get an alert when the number unauthorized operations in the time window is not in the allowed range. Unauthorized operations are operations that affect the device (or done by it) that fail because of an unauthorized error",
              "isEnabled": false,
              "minThreshold": 0,
              "maxThreshold": 0,
              "timeWindowSize": "PT15M"
            }
          ],
          "allowlistRules": [
            {
              "ruleType": "ConnectionToIpNotAllowed",
              "displayName": "Outbound connection to an ip that isn't allowed",
              "description": "Get an alert when an outbound connection is created between your device and an ip that isn't allowed",
              "isEnabled": false,
              "allowlistValues": []
            },
            {
              "ruleType": "LocalUserNotAllowed",
              "displayName": "Login by a local user that isn't allowed",
              "description": "Get an alert when a local user that isn't allowed logins to the device",
              "isEnabled": false,
              "allowlistValues": []
            },
            {
              "ruleType": "ProcessNotAllowed",
              "displayName": "Execution of a process that isn't allowed",
              "description": "Get an alert when a process that isn't allowed is executed",
              "isEnabled": false,
              "allowlistValues": []
            }
          ],
          "denylistRules": []
        }
      }
security:
- name: azure_auth
  type: oauth2
  description: Azure Active Directory OAuth2 Flow
  flow: implicit
  authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
  scopes:
  - name: user_impersonation
    description: impersonate your user account
errorCodes: []
