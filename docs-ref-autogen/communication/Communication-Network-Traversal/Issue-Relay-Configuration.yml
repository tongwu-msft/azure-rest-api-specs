### YamlMime:RESTOperation
uid: communication.communicationnetworktraversal.issuerelayconfiguration
name: Issue Relay Configuration
service: Communication
groupName: Communication Network Traversal
apiVersion: 2022-03-01-preview
summary: Issue a configuration for an STUN/TURN server.
consumes:
- application/json
produces:
- application/json
paths:
- content: POST {endpoint}/networkTraversal/:issueRelayConfiguration?api-version=2022-03-01-preview
uriParameters:
- name: endpoint
  in: path
  isRequired: true
  skipUrlEncoding: true
  description: The communication resource, for example https://my-resource.communication.azure.com
  types:
  - uid: string
- name: api-version
  in: query
  isRequired: true
  description: Version of API to invoke.
  types:
  - uid: string
responses:
- name: 200 OK
  description: Success
  types:
  - uid: CommunicationRelayConfiguration
- name: Other Status Codes
  description: Error
  types:
  - uid: CommunicationErrorResponse
requestBody:
- name: default
  parameters:
  - name: id
    in: body
    description: An identity to be associated with telemetry for data relayed using the returned credentials. Must be an existing ACS user identity. If not provided, the telemetry will not contain an associated identity value.
    types:
    - uid: string
  - name: routeType
    in: body
    description: Filter the routing methodology returned. If not provided, will return all route types in separate ICE servers.
    types:
    - uid: RouteType
  - name: ttl
    in: body
    description: The credential Time-To-Live (TTL), in seconds. The default value will be used if given value exceeds it.
    types:
    - uid: integer
requestHeader: []
definitions:
- name: CommunicationRelayConfiguration
  description: A relay configuration containing the STUN/TURN URLs and credentials.
  kind: object
  properties:
  - name: expiresOn
    description: The date for which the username and credentials are not longer valid. Will be 48 hours from request time.
    types:
    - uid: string
  - name: iceServers
    description: An array representing the credentials and the STUN/TURN server URLs for use in ICE negotiations.
    types:
    - uid: CommunicationIceServer
      isArray: true
- name: CommunicationErrorResponse
  description: The Communication Services error.
  kind: object
  properties:
  - name: error
    description: The Communication Services error.
    types:
    - uid: CommunicationError
- name: CommunicationRelayConfigurationRequest
  description: Request for a CommunicationRelayConfiguration.
  kind: object
  properties:
  - name: id
    description: An identity to be associated with telemetry for data relayed using the returned credentials. Must be an existing ACS user identity. If not provided, the telemetry will not contain an associated identity value.
    types:
    - uid: string
  - name: routeType
    description: Filter the routing methodology returned. If not provided, will return all route types in separate ICE servers.
    types:
    - uid: RouteType
  - name: ttl
    description: The credential Time-To-Live (TTL), in seconds. The default value will be used if given value exceeds it.
    types:
    - uid: integer
    defaultValue: 172800
- name: CommunicationIceServer
  description: An instance of a STUN/TURN server with credentials to be used for ICE negotiation.
  kind: object
  properties:
  - name: urls
    description: List of STUN/TURN server URLs.
    types:
    - uid: string
      isArray: true
  - name: username
    description: User account name which uniquely identifies the credentials.
    types:
    - uid: string
  - name: credential
    description: Credential for the server.
    types:
    - uid: string
  - name: routeType
    description: The routing methodology to where the ICE server will be located from the client. "any" will have higher reliability while "nearest" will have lower latency. It is recommended to default to use the "any" routing method unless there are specific scenarios which minimizing latency is critical.
    types:
    - uid: RouteType
- name: CommunicationError
  description: The Communication Services error.
  kind: object
  properties:
  - name: code
    description: The error code.
    types:
    - uid: string
  - name: message
    description: The error message.
    types:
    - uid: string
  - name: target
    isReadyOnly: true
    description: The error target.
    types:
    - uid: string
  - name: details
    isReadyOnly: true
    description: Further details about specific errors that led to this error.
    types:
    - uid: CommunicationError
      isArray: true
  - name: innererror
    isReadyOnly: true
    description: The inner error if any.
    types:
    - uid: CommunicationError
- name: RouteType
  description: The routing methodology to where the ICE server will be located from the client. "any" will have higher reliability while "nearest" will have lower latency. It is recommended to default to use the "any" routing method unless there are specific scenarios which minimizing latency is critical.
  kind: enum
  properties:
  - name: any
    types:
    - uid: string
  - name: nearest
    types:
    - uid: string
examples:
- name: Issue Relay Configuration
  request:
    uri: POST https://my-resource.communication.azure.com/networkTraversal/:issueRelayConfiguration?api-version=2022-03-01-preview
    body: >-
      {
        "id": "8:acs:2dee53b4-368b-45b4-ab52-8493fb117652_00000005-14a2-493b-8a72-5a3a0d000081",
        "ttl": 3600
      }
    codeTab: |+
      # [HTTP](#tab/HTTP)
      ``` http
      POST https://my-resource.communication.azure.com/networkTraversal/:issueRelayConfiguration?api-version=2022-03-01-preview

      {
        "id": "8:acs:2dee53b4-368b-45b4-ab52-8493fb117652_00000005-14a2-493b-8a72-5a3a0d000081",
        "ttl": 3600
      }

      ```

  responses:
  - statusCode: "200"
    body: >-
      {
        "expiresOn": "2022-03-01T21:39:39.3244584+00:00",
        "iceServers": [
          {
            "urls": [
              "turn:131.107.255.255:3478",
              "stun:131.107.255.255:3478"
            ],
            "username": "AgAAJNOeygwB1uVGvuwAVMHV4PLhYDgY66Fg1dUZvQ4AAAAEhXrhc8uJFjOK8lxEsZk3KIpWxc0=",
            "credential": "9rl8ablFWj6/aqSuPLgLykLZKqw=",
            "routeType": "any"
          }
        ]
      }
security: []
metadata:
  description: Learn more about Communication service - Issue a configuration for an STUN/TURN server.
errorCodes: []
