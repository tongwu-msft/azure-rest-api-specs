### YamlMime:RESTOperation
uid: management.azure.com.monitor.datacollectionrules.update
name: Update
service: Monitor
groupName: Data Collection Rules
apiVersion: 2019-11-01-preview
summary: Updates part of a data collection rule.
consumes:
- application/json
produces:
- application/json
paths:
- content: PATCH https://management.azure.com/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.Insights/dataCollectionRules/{dataCollectionRuleName}?api-version=2019-11-01-preview
uriParameters:
- name: subscriptionId
  in: path
  isRequired: true
  description: The ID of the target subscription.
  types:
  - uid: string
- name: resourceGroupName
  in: path
  isRequired: true
  description: The name of the resource group. The name is case insensitive.
  types:
  - uid: string
  pattern: ^[-\w\._\(\)]+$
- name: dataCollectionRuleName
  in: path
  isRequired: true
  description: The name of the data collection rule. The name is case insensitive.
  types:
  - uid: string
- name: api-version
  in: query
  isRequired: true
  description: The API version to use for this operation.
  types:
  - uid: string
responses:
- name: 200 OK
  description: Data collection rule was successfully updated
  types:
  - uid: DataCollectionRuleResource
- name: Other Status Codes
  description: Error
  types:
  - uid: ErrorResponse
requestBody:
- name: default
  parameters:
  - name: tags
    in: body
    description: Resource tags.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
requestHeader: []
definitions:
- name: DataCollectionRuleResource
  description: Definition of ARM tracked top level resource.
  kind: object
  properties:
  - name: location
    description: The geo-location where the resource lives.
    types:
    - uid: string
  - name: tags
    description: Resource tags.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
  - name: kind
    description: The kind of the resource.
    types:
    - uid: KnownDataCollectionRuleResourceKind
  - name: id
    isReadyOnly: true
    description: Fully qualified ID of the resource.
    types:
    - uid: string
  - name: name
    isReadyOnly: true
    description: The name of the resource.
    types:
    - uid: string
  - name: type
    isReadyOnly: true
    description: The type of the resource.
    types:
    - uid: string
  - name: etag
    isReadyOnly: true
    description: Resource entity tag (ETag).
    types:
    - uid: string
  - name: properties.description
    description: Description of the data collection rule.
    types:
    - uid: string
  - name: properties.immutableId
    isReadyOnly: true
    description: The immutable ID of this data collection rule. This property is READ-ONLY.
    types:
    - uid: string
  - name: properties.dataSources
    description: "The specification of data sources. \nThis property is optional and can be omitted if the rule is meant to be used via direct calls to the provisioned endpoint."
    types:
    - uid: DataSources
  - name: properties.destinations
    description: The specification of destinations.
    types:
    - uid: Destinations
  - name: properties.dataFlows
    description: The specification of data flows.
    types:
    - uid: DataFlow
      isArray: true
  - name: properties.provisioningState
    isReadyOnly: true
    description: The resource provisioning state.
    types:
    - uid: KnownDataCollectionRuleProvisioningState
- name: ErrorResponse
  description: Error response
  kind: object
  properties:
  - name: error
    description: The error object.
    types:
    - uid: ErrorDetail
- name: ResourceForUpdate
  description: Definition of ARM tracked top level resource properties for update operation.
  kind: object
  properties:
  - name: tags
    description: Resource tags.
    types:
    - uid: object
      isDictionary: true
      additionalTypes:
      - uid: string
      - uid: string
- name: KnownDataCollectionRuleResourceKind
  description: The kind of the resource.
  kind: enum
  properties:
  - name: Linux
    types:
    - uid: string
  - name: Windows
    types:
    - uid: string
- name: DataSources
  description: "The specification of data sources. \r\nThis property is optional and can be omitted if the rule is meant to be used via direct calls to the provisioned endpoint."
  kind: object
  properties:
  - name: performanceCounters
    description: The list of performance counter data source configurations.
    types:
    - uid: PerfCounterDataSource
      isArray: true
  - name: windowsEventLogs
    description: The list of Windows Event Log data source configurations.
    types:
    - uid: WindowsEventLogDataSource
      isArray: true
  - name: syslog
    description: The list of Syslog data source configurations.
    types:
    - uid: SyslogDataSource
      isArray: true
  - name: extensions
    description: The list of Azure VM extension data source configurations.
    types:
    - uid: ExtensionDataSource
      isArray: true
- name: Destinations
  description: The specification of destinations.
  kind: object
  properties:
  - name: logAnalytics
    description: List of Log Analytics destinations.
    types:
    - uid: LogAnalyticsDestination
      isArray: true
  - name: azureMonitorMetrics
    description: Azure Monitor Metrics destination.
    types:
    - uid: AzureMonitorMetrics
- name: DataFlow
  description: Definition of which streams are sent to which destinations.
  kind: object
  properties:
  - name: streams
    description: List of streams for this data flow.
    types:
    - uid: string
      isArray: true
  - name: destinations
    description: List of destinations for this data flow.
    types:
    - uid: string
      isArray: true
- name: KnownDataCollectionRuleProvisioningState
  description: The resource provisioning state.
  kind: enum
  properties:
  - name: Creating
    types:
    - uid: string
  - name: Updating
    types:
    - uid: string
  - name: Deleting
    types:
    - uid: string
  - name: Succeeded
    types:
    - uid: string
  - name: Failed
    types:
    - uid: string
- name: ErrorDetail
  description: The error detail.
  kind: object
  properties:
  - name: code
    isReadyOnly: true
    description: The error code.
    types:
    - uid: string
  - name: message
    isReadyOnly: true
    description: The error message.
    types:
    - uid: string
  - name: target
    isReadyOnly: true
    description: The error target.
    types:
    - uid: string
  - name: details
    isReadyOnly: true
    description: The error details.
    types:
    - uid: ErrorDetail
      isArray: true
  - name: additionalInfo
    isReadyOnly: true
    description: The error additional info.
    types:
    - uid: ErrorAdditionalInfo
      isArray: true
- name: PerfCounterDataSource
  description: >-
    Definition of which performance counters will be collected and how they will be collected by this data collection rule.

    Collected from both Windows and Linux machines where the counter is present.
  kind: object
  properties:
  - name: streams
    description: >-
      List of streams that this data source will be sent to.

      A stream indicates what schema will be used for this data and usually what table in Log Analytics the data will be sent to.
    types:
    - uid: string
      isArray: true
  - name: samplingFrequencyInSeconds
    description: The number of seconds between consecutive counter measurements (samples).
    types:
    - uid: integer
  - name: counterSpecifiers
    description: >-
      A list of specifier names of the performance counters you want to collect.

      Use a wildcard (*) to collect a counter for all instances.

      To get a list of performance counters on Windows, run the command 'typeperf'.
    types:
    - uid: string
      isArray: true
  - name: name
    description: "A friendly name for the data source. \nThis name should be unique across all data sources (regardless of type) within the data collection rule."
    types:
    - uid: string
- name: WindowsEventLogDataSource
  description: >-
    Definition of which Windows Event Log events will be collected and how they will be collected.

    Only collected from Windows machines.
  kind: object
  properties:
  - name: streams
    description: >-
      List of streams that this data source will be sent to.

      A stream indicates what schema will be used for this data and usually what table in Log Analytics the data will be sent to.
    types:
    - uid: string
      isArray: true
  - name: xPathQueries
    description: A list of Windows Event Log queries in XPATH format.
    types:
    - uid: string
      isArray: true
  - name: name
    description: "A friendly name for the data source. \nThis name should be unique across all data sources (regardless of type) within the data collection rule."
    types:
    - uid: string
- name: SyslogDataSource
  description: >-
    Definition of which syslog data will be collected and how it will be collected.

    Only collected from Linux machines.
  kind: object
  properties:
  - name: streams
    description: >-
      List of streams that this data source will be sent to.

      A stream indicates what schema will be used for this data and usually what table in Log Analytics the data will be sent to.
    types:
    - uid: string
      isArray: true
  - name: facilityNames
    description: The list of facility names.
    types:
    - uid: string
      isArray: true
  - name: logLevels
    description: The log levels to collect.
    types:
    - uid: string
      isArray: true
  - name: name
    description: "A friendly name for the data source. \nThis name should be unique across all data sources (regardless of type) within the data collection rule."
    types:
    - uid: string
- name: ExtensionDataSource
  description: >-
    Definition of which data will be collected from a separate VM extension that integrates with the Azure Monitor Agent.

    Collected from either Windows and Linux machines, depending on which extension is defined.
  kind: object
  properties:
  - name: streams
    description: >-
      List of streams that this data source will be sent to.

      A stream indicates what schema will be used for this data and usually what table in Log Analytics the data will be sent to.
    types:
    - uid: string
      isArray: true
  - name: extensionName
    description: The name of the VM extension.
    types:
    - uid: string
  - name: extensionSettings
    description: The extension settings. The format is specific for particular extension.
    types:
    - uid: object
  - name: inputDataSources
    description: The list of data sources this extension needs data from.
    types:
    - uid: string
      isArray: true
  - name: name
    description: "A friendly name for the data source. \nThis name should be unique across all data sources (regardless of type) within the data collection rule."
    types:
    - uid: string
- name: LogAnalyticsDestination
  description: Log Analytics destination.
  kind: object
  properties:
  - name: workspaceResourceId
    description: The resource ID of the Log Analytics workspace.
    types:
    - uid: string
  - name: workspaceId
    isReadyOnly: true
    description: The Customer ID of the Log Analytics workspace.
    types:
    - uid: string
  - name: name
    description: "A friendly name for the destination. \nThis name should be unique across all destinations (regardless of type) within the data collection rule."
    types:
    - uid: string
- name: AzureMonitorMetrics
  description: Azure Monitor Metrics destination.
  kind: object
  properties:
  - name: name
    description: "A friendly name for the destination. \nThis name should be unique across all destinations (regardless of type) within the data collection rule."
    types:
    - uid: string
- name: ErrorAdditionalInfo
  description: The resource management error additional info.
  kind: object
  properties:
  - name: type
    isReadyOnly: true
    description: The additional info type.
    types:
    - uid: string
  - name: info
    isReadyOnly: true
    description: The additional info.
    types:
    - uid: object
examples:
- name: Update data collection rule
  request:
    uri: PATCH https://management.azure.com/subscriptions/703362b3-f278-4e4b-9179-c76eaf41ffc2/resourceGroups/myResourceGroup/providers/Microsoft.Insights/dataCollectionRules/myCollectionRule?api-version=2019-11-01-preview
    body: >-
      {
        "tags": {
          "tag1": "A",
          "tag2": "B",
          "tag3": "C"
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "/subscriptions/703362b3-f278-4e4b-9179-c76eaf41ffc2/resourceGroups/myResourceGroup/providers/Microsoft.Insights/dataCollectionRules/myCollectionRule",
        "name": "myCollectionRule",
        "type": "Microsoft.Insights/dataCollectionRules",
        "location": "eastus",
        "tags": {
          "tag1": "A",
          "tag2": "B",
          "tag3": "C"
        },
        "properties": {
          "immutableId": "dcr-b74e0d383fc9415abaa584ec41adece3",
          "dataSources": {
            "performanceCounters": [
              {
                "name": "cloudTeamCoreCounters",
                "streams": [
                  "Microsoft-Perf"
                ],
                "samplingFrequencyInSeconds": 15,
                "counterSpecifiers": [
                  "\\Processor(_Total)\\% Processor Time",
                  "\\Memory\\Committed Bytes",
                  "\\LogicalDisk(_Total)\\Free Megabytes",
                  "\\PhysicalDisk(_Total)\\Avg. Disk Queue Length"
                ]
              },
              {
                "name": "appTeamExtraCounters",
                "streams": [
                  "Microsoft-Perf"
                ],
                "samplingFrequencyInSeconds": 30,
                "counterSpecifiers": [
                  "\\Process(_Total)\\Thread Count"
                ]
              }
            ],
            "windowsEventLogs": [
              {
                "name": "cloudSecurityTeamEvents",
                "streams": [
                  "Microsoft-WindowsEvent"
                ],
                "xPathQueries": [
                  "Security!"
                ]
              },
              {
                "name": "appTeam1AppEvents",
                "streams": [
                  "Microsoft-WindowsEvent"
                ],
                "xPathQueries": [
                  "System![System[(Level = 1 or Level = 2 or Level = 3)]]",
                  "Application!*[System[(Level = 1 or Level = 2 or Level = 3)]]"
                ]
              }
            ],
            "syslog": [
              {
                "name": "cronSyslog",
                "streams": [
                  "Microsoft-Syslog"
                ],
                "facilityNames": [
                  "cron"
                ],
                "logLevels": [
                  "Debug",
                  "Critical",
                  "Emergency"
                ]
              },
              {
                "name": "syslogBase",
                "streams": [
                  "Microsoft-Syslog"
                ],
                "facilityNames": [
                  "syslog"
                ],
                "logLevels": [
                  "Alert",
                  "Critical",
                  "Emergency"
                ]
              }
            ]
          },
          "destinations": {
            "logAnalytics": [
              {
                "workspaceResourceId": "/subscriptions/703362b3-f278-4e4b-9179-c76eaf41ffc2/resourceGroups/myResourceGroup/providers/Microsoft.OperationalInsights/workspaces/centralTeamWorkspace",
                "workspaceId": "9ba8bc53-bd36-4156-8667-e983e7ae0e4f",
                "name": "centralWorkspace"
              }
            ]
          },
          "dataFlows": [
            {
              "streams": [
                "Microsoft-Perf",
                "Microsoft-Syslog",
                "Microsoft-WindowsEvent"
              ],
              "destinations": [
                "centralWorkspace"
              ]
            }
          ]
        },
        "etag": "070057da-0000-0000-0000-5ba70d6c0000"
      }
security:
- name: azure_auth
  type: oauth2
  description: Azure Active Directory OAuth2 Flow
  flow: implicit
  authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
  scopes:
  - name: user_impersonation
    description: impersonate your user account
errorCodes: []
