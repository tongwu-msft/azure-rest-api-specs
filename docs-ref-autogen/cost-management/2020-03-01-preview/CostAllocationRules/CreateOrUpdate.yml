### YamlMime:RESTOperation
uid: management.azure.com.cost-management.2020-03-01-preview.costallocationrules.createorupdate
name: Create Or Update
service: Cost Management
groupName: Cost Allocation Rules
apiVersion: 2020-03-01-preview
summary: Create/Update a rule to allocate cost between different resources within a billing account or enterprise enrollment.
consumes:
- application/json
produces:
- application/json
paths:
- content: PUT https://management.azure.com/providers/Microsoft.Billing/billingAccounts/{billingAccountId}/providers/Microsoft.CostManagement/costAllocationRules/{ruleName}?api-version=2020-03-01-preview
uriParameters:
- name: billingAccountId
  in: path
  isRequired: true
  description: BillingAccount ID
  types:
  - uid: string
- name: ruleName
  in: path
  isRequired: true
  description: Cost allocation rule name. The name cannot include spaces or any non alphanumeric characters other than '_' and '-'. The max length is 260 characters.
  types:
  - uid: string
- name: api-version
  in: query
  isRequired: true
  description: Version of the API to be used with the client request (e.g. '2020-06-01').
  types:
  - uid: string
responses:
- name: 200 OK
  description: OK. The request has succeeded.
  types:
  - uid: CostAllocationRuleDefinition
- name: Other Status Codes
  description: Error response describing why the operation failed.
  types:
  - uid: ErrorResponse
requestBody:
- name: default
  parameters:
  - name: properties
    in: body
    description: Cost allocation rule properties
    types:
    - uid: CostAllocationRuleProperties
requestHeader: []
definitions:
- name: CostAllocationRuleProperties
  description: The properties of a cost allocation rule
  kind: object
  properties:
  - name: description
    description: Description of a cost allocation rule.
    types:
    - uid: string
  - name: details
    description: Resource information for the cost allocation rule
    types:
    - uid: CostAllocationRuleDetails
  - name: status
    description: Status of the rule
    types:
    - uid: RuleStatus
  - name: createdDate
    isReadyOnly: true
    description: Time at which the rule was created. Rules that change cost for the same resource are applied in order of creation.
    types:
    - uid: string
  - name: updatedDate
    isReadyOnly: true
    description: Time at which the rule was last updated.
    types:
    - uid: string
- name: CostAllocationRuleDefinition
  description: The cost allocation rule model definition
  kind: object
  properties:
  - name: id
    isReadyOnly: true
    description: Azure Resource Manager Id for the rule. This is a read ony value.
    types:
    - uid: string
  - name: name
    isReadyOnly: true
    description: Name of the rule. This is a read only value.
    types:
    - uid: string
  - name: type
    isReadyOnly: true
    description: Resource type of the rule. This is a read only value of Microsoft.CostManagement/CostAllocationRule.
    types:
    - uid: string
  - name: properties
    description: Cost allocation rule properties
    types:
    - uid: CostAllocationRuleProperties
- name: ErrorResponse
  description: "Error response indicates that the service is not able to process the incoming request. The reason is provided in the error message. \n\nSome Error responses: \n\n * 429 TooManyRequests - Request is throttled. Retry after waiting for the time specified in the \"x-ms-ratelimit-microsoft.consumption-retry-after\" header. \n\n * 503 ServiceUnavailable - Service is temporarily unavailable. Retry after waiting for the time specified in the \"Retry-After\" header."
  kind: object
  properties:
  - name: error
    description: The details of the error.
    types:
    - uid: ErrorDetails
- name: CostAllocationRuleDetails
  description: Resource details of the cost allocation rule
  kind: object
  properties:
  - name: sourceResources
    description: Source resources for cost allocation. At this time, this list can contain no more than one element.
    types:
    - uid: SourceCostAllocationResource
      isArray: true
  - name: targetResources
    description: Target resources for cost allocation. At this time, this list can contain no more than one element.
    types:
    - uid: TargetCostAllocationResource
      isArray: true
- name: RuleStatus
  description: Current status of the rule.
  kind: enum
  properties:
  - name: NotActive
    description: Rule is saved but not used to allocate costs.
    types:
    - uid: string
  - name: Active
    description: Rule is saved and impacting cost allocation.
    types:
    - uid: string
  - name: Processing
    description: Rule is saved and cost allocation is being updated. Readonly value that cannot be submitted in a put request.
    types:
    - uid: string
- name: ErrorDetails
  description: The details of the error.
  kind: object
  properties:
  - name: code
    isReadyOnly: true
    description: Error code.
    types:
    - uid: string
  - name: message
    isReadyOnly: true
    description: Error message indicating why the operation failed.
    types:
    - uid: string
- name: SourceCostAllocationResource
  description: Source resources for cost allocation
  kind: object
  properties:
  - name: resourceType
    description: Type of resources contained in this cost allocation rule
    types:
    - uid: CostAllocationResourceType
  - name: name
    description: If resource type is dimension, this must be either ResourceGroupName or SubscriptionId. If resource type is tag, this must be a valid Azure tag
    types:
    - uid: string
  - name: values
    description: Source Resources for cost allocation. This list cannot contain more than 25 values.
    types:
    - uid: string
      isArray: true
- name: TargetCostAllocationResource
  description: Target resources for cost allocation.
  kind: object
  properties:
  - name: resourceType
    description: Type of resources contained in this cost allocation rule
    types:
    - uid: CostAllocationResourceType
  - name: name
    description: If resource type is dimension, this must be either ResourceGroupName or SubscriptionId. If resource type is tag, this must be a valid Azure tag
    types:
    - uid: string
  - name: values
    description: Target resources for cost allocation. This list cannot contain more than 25 values.
    types:
    - uid: CostAllocationProportion
      isArray: true
  - name: policyType
    description: Method of cost allocation for the rule
    types:
    - uid: CostAllocationPolicyType
- name: CostAllocationResourceType
  description: Category of resource to use for allocation.
  kind: enum
  properties:
  - name: Dimension
    description: Indicates an Azure dimension such as a subscription id or resource group name is being used for allocation.
    types:
    - uid: string
  - name: Tag
    description: Allocates cost based on Azure Tag key value pairs.
    types:
    - uid: string
- name: CostAllocationProportion
  description: Target resources and allocation
  kind: object
  properties:
  - name: name
    description: Target resource for cost allocation
    types:
    - uid: string
  - name: percentage
    description: Percentage of source cost to allocate to this resource. This value can be specified to two decimal places and the total percentage of all resources in this rule must sum to 100.00.
    types:
    - uid: number
- name: CostAllocationPolicyType
  description: Method to use for allocating cost. FixedProportion indicates that cost will be split based on specified percentage values.
  kind: enum
  properties:
  - name: FixedProportion
    types:
    - uid: string
examples:
- name: CostAllocationRulesCreateResourceGroup
  request:
    uri: PUT https://management.azure.com/providers/Microsoft.Billing/billingAccounts/100/providers/Microsoft.CostManagement/costAllocationRules/testRule?api-version=2020-03-01-preview
    body: >-
      {
        "properties": {
          "description": "This is a testRule",
          "status": "Active",
          "details": {
            "sourceResources": [
              {
                "resourceType": "Dimension",
                "name": "ResourceGroupName",
                "values": [
                  "sampleRG",
                  "secondRG"
                ]
              }
            ],
            "targetResources": [
              {
                "resourceType": "Dimension",
                "policyType": "FixedProportion",
                "name": "ResourceGroupName",
                "values": [
                  {
                    "name": "destinationRG",
                    "percentage": 45
                  },
                  {
                    "name": "destinationRG2",
                    "percentage": 54
                  }
                ]
              }
            ]
          }
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "providers/Microsoft.Billing/billingAccounts/100/providers/Microsoft.CostManagement/costAllocationRules/testRule",
        "name": "testRule",
        "type": "Microsoft.CostManagement/costAllocationRules",
        "properties": {
          "description": "This is a testRule",
          "createdDate": "2020-06-18T22:21:51.1287144Z",
          "updatedDate": "2020-06-18T22:21:51.1287144Z",
          "status": "Creating",
          "details": {
            "sourceResources": [
              {
                "resourceType": "Dimension",
                "name": "ResourceGroupName",
                "values": [
                  "sampleRG"
                ]
              }
            ],
            "targetResources": [
              {
                "resourceType": "Dimension",
                "policyType": "FixedProportion",
                "name": "ResourceGroupName",
                "values": [
                  {
                    "name": "destinationRG",
                    "percentage": 50
                  },
                  {
                    "name": "destinationRG2",
                    "percentage": 50
                  }
                ]
              }
            ]
          }
        }
      }
- name: CostAllocationRulesCreateTag
  request:
    uri: PUT https://management.azure.com/providers/Microsoft.Billing/billingAccounts/100/providers/Microsoft.CostManagement/costAllocationRules/testRule?api-version=2020-03-01-preview
    body: >-
      {
        "properties": {
          "description": "This is a testRule",
          "status": "Active",
          "details": {
            "sourceResources": [
              {
                "resourceType": "Tag",
                "name": "category",
                "values": [
                  "devops"
                ]
              }
            ],
            "targetResources": [
              {
                "resourceType": "Dimension",
                "policyType": "FixedProportion",
                "name": "ResourceGroupName",
                "values": [
                  {
                    "name": "destinationRG",
                    "percentage": 33.33
                  },
                  {
                    "name": "destinationRG2",
                    "percentage": 33.33
                  },
                  {
                    "name": "destinationRG3",
                    "percentage": 33.34
                  }
                ]
              }
            ]
          }
        }
      }
  responses:
  - statusCode: "200"
    body: >-
      {
        "id": "providers/Microsoft.Billing/billingAccounts/100/providers/Microsoft.CostManagement/costAllocationRules/testRule",
        "name": "testRule",
        "type": "Microsoft.CostManagement/costAllocationRules",
        "properties": {
          "description": "This is a testRule",
          "createdDate": "2020-06-18T22:21:51.1287144Z",
          "updatedDate": "2020-06-18T22:21:51.1287144Z",
          "status": "Creating",
          "details": {
            "sourceResources": [
              {
                "resourceType": "Dimension",
                "name": "ResourceGroupName",
                "values": [
                  "sampleRG"
                ]
              }
            ],
            "targetResources": [
              {
                "resourceType": "Dimension",
                "policyType": "FixedProportion",
                "name": "ResourceGroupName",
                "values": [
                  {
                    "name": "destinationRG",
                    "percentage": 50
                  },
                  {
                    "name": "destinationRG2",
                    "percentage": 50
                  }
                ]
              }
            ]
          }
        }
      }
security:
- name: azure_auth
  type: oauth2
  description: Azure Active Directory OAuth2 Flow.
  flow: implicit
  authorizationUrl: https://login.microsoftonline.com/common/oauth2/authorize
  scopes:
  - name: user_impersonation
    description: impersonate your user account
errorCodes: []
