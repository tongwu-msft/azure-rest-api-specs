---
title: "Report the health of a partition"
ms.custom: ""
ms.date: "2017-02-03"
ms.prod: "azure"
ms.reviewer: ""
ms.service: "service-fabric"
ms.suite: ""
ms.tgt_pltfrm: ""
ms.topic: "reference"
applies_to: 
  - "Azure"
  - "Windows 10"
  - "Windows 8"
  - "Windows 8.1"
  - "Windows Server 2012 R2"
dev_langs: 
  - "CSharp"
helpviewer_keywords: 
  - "Service Fabric REST API Reference"
ms.assetid: 69961eac-0363-4ba8-b638-326444ad1879
caps.latest.revision: 15
author: "rwike77"
ms.author: "ryanwi"
manager: "timlt"
translation.priority.mt: 
  - "de-de"
  - "es-es"
  - "fr-fr"
  - "it-it"
  - "ja-jp"
  - "ko-kr"
  - "pt-br"
  - "ru-ru"
  - "zh-cn"
  - "zh-tw"
---
# Report the health of a partition
Reports the health state of the specified Service Fabric service partition.  
  
## Request  
 See [Partition](partition.md) for headers and parameters that are used by all requests related to partitions.  
  
|Method|Request URI|  
|------------|-----------------|  
|POST|`<URI>/Applications/{application-name}/$/GetServices/{service-name}/$/GetPartitions/{partition-id}/$/ReportHealth?api-version=1.0`|  
|POST|`<URI>/Services/{service-name}/$/GetPartitions/{partition-id}/$/ReportHealth?api-version=1.0`|  
|POST|`<URI>/Partitions/{partition-id}/$/ReportHealth?api-version=1.0`|  
  
```  
{  
    "SourceId": "RestClient",  
    "Property": "State",  
    "HealthState": 3,  
    "Description": "Sample health state description of partition health.",  
    "TimeToLiveInMilliSeconds": "0",  
    "SequenceNumber": "0",  
    "RemoveWhenExpired": true  
}  
```  
  
|Element name|Required|Type|Description|  
|------------------|--------------|----------|-----------------|  
|SourceId|Yes|String|The source ID of the health report.|  
|Property|Yes|String|The property being reported.|  
|HealthState|Yes|HealthState enumerated number|The health state.<br /><br /> Possible values are:<br /><br /> -   Invalid - Indicates an invalid health state. All Service Fabric enumerations have the invalid type. The value is zero.<br />-   Ok - Indicates the health state is okay. The value is 1.<br />-   Warning - Indicates the health status is at a warning level. The value is 2.<br />-   Indicated the health status is at an error level. The value is 3.<br />-   Unknown - Indicates an unknown health status. The value is 65535.|  
|Description|No|String|The health state description. The maximum string length for the description is 4096 characters.|  
|TimeToLiveInMilliSeconds|No|String|The time for this health report to be valid in milliseconds. If not specified, time to live defaults to infinite value. To explicitly set Infinite time to live, use value “922337203685477”.|  
|SequenceNumber|No|String|The sequence number for this health report as a numeric string. If not specified, a sequence number is auto-generated by the health client.|  
|RemoveWhenExpired|No|Boolean|Value of `true` to remove the health report after the time to live expires; `false` to keep the health event after the time to live expires. If not specified, the default is `false`.|  
  
## Response  
 A successful operation will return 200 OK. For information on error codes, see [Status and Error Codes](status-and-error-codes1.md).  
  
## Examples  
 The following example reports the health of a partition.  
  
```  
  
/// <summary>  
/// Class similar to HealthInformation. Designed for use with JavaScriptSerializer.  
/// </summary>  
public class HealthInformation2  
{  
    public string SourceId { get; set; }  
    public string Property { get; set; }  
    public HealthState HealthState { get; set; }  
    public string Description { get; set; }  
    public string TimeToLiveInMilliSeconds { get; set; }  
    public string SequenceNumber { get; set; }  
    public bool RemoveWhenExpired { get; set; }  
}  
  
/// <summary>  
/// Class similar to HealthInformation. Designed for use with JavaScriptSerializer.  
/// </summary>  
public class Partition2  
{  
    public ServiceKind ServiceKind { get; set; }  
    public ServicePartitionInformation2 PartitionInformation { get; set; }  
    public ServicePartitionStatus PartitionStatus { get; set; }  
    public HealthState HealthState { get; set; }  
    public long MinReplicaSetSize { get; set; }  
    public long TargetReplicaSetSize { get; set; }  
    public Epoch2 CurrentConfigurationEpoch { get; set; }  
    public long InstanceCount { get; set; }  
}  
  
/// <summary>  
/// Class similar to HealthInformation. Designed for use with JavaScriptSerializer.  
/// </summary>  
public class ServicePartitionInformation2  
{  
    public ServicePartitionKind ServicePartitionKind { get; set; }  
    public Guid Id { get; set; }  
}  
  
/// <summary>  
/// Class similar to HealthInformation. Designed for use with JavaScriptSerializer.  
/// </summary>  
public class Epoch2  
{  
    public string ConfigurationVersion { get; set; }  
    public string DataLossVersion { get; set; }  
}  
  
/// <summary>  
/// Reports the health of a partition.  
/// </summary>  
/// <remarks>  
/// Gets the list of partitions for WordCount.Service, then reports health of the first partition ID in the list.  
/// </remarks>  
/// <param name="clusterUri">The URI of the cluster.</param>  
/// <returns>Returns true if successful; otherwise false.</returns>  
public static bool ReportPartitionHealth(Uri clusterUri)  
{  
    // String to capture the response stream.  
    string responseString = string.Empty;  
  
    //  
    // Get Partitions.  
    //  
  
    // Create the request and add URL parameters.  
    Uri requestUri = new Uri(clusterUri,  
        string.Format("/Applications/{0}/$/GetServices/{1}/$/GetPartitions?api-version={2}",  
        "WordCount",                    // Application Name  
        "WordCount/WordCount.Service",  // Service Name  
        "1.0"));                        // api-version  
  
    HttpWebRequest request = (HttpWebRequest)WebRequest.Create(requestUri);  
    request.Method = "GET";  
  
    // Execute the request and obtain the response.  
    try  
    {  
        using (HttpWebResponse response = (HttpWebResponse)request.GetResponse())  
        {  
            using (StreamReader streamReader = new StreamReader(response.GetResponseStream(), true))  
            {  
                // Capture the response string.  
                responseString = streamReader.ReadToEnd();  
            }  
        }  
    }  
    catch (WebException e)  
    {  
        // If there is a web exception, display the error message.  
        Console.WriteLine("Error getting partitions:");  
        Console.WriteLine(e.Message);  
        if (e.InnerException != null)  
            Console.WriteLine(e.InnerException.Message);  
        return false;  
    }  
    catch (Exception e)  
    {  
        // If there is another kind of exception, throw it.  
        throw (e);  
    }  
  
    // Deserialize the response string.  
    JavaScriptSerializer jss = new JavaScriptSerializer();  
    List<Partition2> partitions = jss.Deserialize<List<Partition2>>(responseString);  
  
    // Verify that at least one partition was found.  
    if (partitions == null || partitions.Count == 0)  
    {  
        Console.WriteLine("Error: Zero partitions found for the application.");  
        return false;  
    }  
  
    Console.WriteLine("Reporting health for partition ID: " + partitions[0].PartitionInformation.Id);  
  
    //  
    // Report Partition Health.  
    //  
  
    // Stores the response status code.  
    HttpStatusCode statusCode;  
  
    // Create the request and add URL parameters.  
    requestUri = new Uri(clusterUri, string.Format("/Applications/{0}/$/GetServices/{1}/$/GetPartitions/{2}/$/ReportHealth?api-version={3}",  
        "WordCount",                            // Application Name  
        "WordCount.Service",                    // Service Name  
        partitions[0].PartitionInformation.Id,  // Partition Id  
        "1.0"));                                // api-version  
  
    request = (HttpWebRequest)WebRequest.Create(requestUri);  
    request.ContentType = "text/json";  
    request.Method = "POST";  
  
    // Create the Health Policy.  
    HealthInformation2 healthInformation = new HealthInformation2()  
    {  
        SourceId = "RestClient",  
        Property = "State",  
        HealthState = HealthState.Error,  
        Description = "Sample health state description of partition health.",  
        TimeToLiveInMilliSeconds = "0",  
        SequenceNumber = "0",  
        RemoveWhenExpired = true  
    };  
  
    // Serialize the health policy.  
    string requestBody = jss.Serialize(healthInformation);  
  
    // Create the byte array that will become the request body.  
    byte[] requestBodyBytes = Encoding.UTF8.GetBytes(requestBody);  
    request.ContentLength = requestBodyBytes.Length;  
  
    // Create the request body.  
    try  
    {  
        using (Stream requestStream = request.GetRequestStream())  
        {  
            requestStream.Write(requestBodyBytes, 0, requestBodyBytes.Length);  
            requestStream.Close();  
  
            // Execute the request and obtain the response.  
            using (HttpWebResponse response = (HttpWebResponse)request.GetResponse())  
            {  
                statusCode = response.StatusCode;  
            }  
        }  
    }  
    catch (WebException e)  
    {  
        // If there is a web exception, display the error message.  
        Console.WriteLine("Error reporting partition health:");  
        Console.WriteLine(e.Message);  
        if (e.InnerException != null)  
            Console.WriteLine(e.InnerException.Message);  
        return false;  
    }  
    catch (Exception e)  
    {  
        // If there is another kind of exception, throw it.  
        throw (e);  
    }  
  
    Console.WriteLine("Report Partition Health response status = " + statusCode.ToString());  
    return true;  
}  
  
/* This code produces output similar to the following:  
  
Report Partition Health response status = OK  
*/  
  
```